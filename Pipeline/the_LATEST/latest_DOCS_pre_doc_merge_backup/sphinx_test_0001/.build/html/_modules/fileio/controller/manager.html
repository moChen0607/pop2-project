






<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fileio.controller.manager &mdash; Portal: Origins [Part 2] 1.0.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/style.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../.static/style.css" type="text/css" />
  

  
    <link rel="top" title="Portal: Origins [Part 2] 1.0.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Portal: Origins [Part 2]
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../userguide.html">The Definitive User Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../administration.html">Administrative Portal</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Portal: Origins [Part 2]</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>fileio.controller.manager</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fileio.controller.manager</h1><div class="highlight"><pre>
<span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. Project::</span>
<span class="sd"> Portal Origins: Part Two</span>
<span class="sd">.. Description::</span>
<span class="sd"> Manager inits the specific methods from checkout to use for fileIO operations</span>
<span class="sd">.. Notes::</span>
<span class="sd"> sys.exit() has an interesting role in this module. Instead of exitting Maya altogether,</span>
<span class="sd"> sys.exit() just stops the beforeSaveCheck and immediatelly executes the save command.</span>
<span class="sd"> If the script instructs Maya to block the save command, the save will fail and vice versa.</span>
<span class="sd">.. Author::</span>
<span class="sd"> Colin Kennedy</span>
<span class="sd">.. TODO::</span>
<span class="sd"> Create extensive test cases for these open/save modules</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># IMPORT STANDARD LIBRARIES</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="c1"># IMPORT THIRD PARTY LIBRARIES</span>
<span class="k">try</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">maya.OpenMaya</span> <span class="kn">as</span> <span class="nn">om</span>
	<span class="kn">import</span> <span class="nn">maya.cmds</span> <span class="kn">as</span> <span class="nn">cmds</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">nuke</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
	<span class="k">pass</span>

<span class="c1"># IMPORT LOCAL LIBRARIES</span>
<span class="kn">from</span> <span class="nn">constants.model</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">consts</span>
<span class="kn">import</span> <span class="nn">logger.common.loggingServices</span> <span class="kn">as</span> <span class="nn">loggingservices</span>
<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">loggingservices</span><span class="o">.</span><span class="n">init_logger</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">network.controller.network</span> <span class="kn">import</span> <span class="n">NetworkManager</span>
<span class="kn">import</span> <span class="nn">fileio.view.fileproof</span> <span class="kn">as</span> <span class="nn">fileproof</span>
<span class="kn">import</span> <span class="nn">checkout</span>
<span class="kn">import</span> <span class="nn">paths</span>
<span class="c1"># import metadatamaya as metamaya</span>
<span class="kn">from</span> <span class="nn">pysix</span> <span class="kn">import</span> <span class="n">six</span>


<span class="n">GLOB_ERROR_MSG</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>


<div class="viewcode-block" id="nuke_get_path_from_write_node"><a class="viewcode-back" href="../../../fileio.html#fileio.controller.manager.nuke_get_path_from_write_node">[docs]</a><span class="k">def</span> <span class="nf">nuke_get_path_from_write_node</span><span class="p">(</span><span class="n">inputH</span><span class="p">,</span> <span class="n">knob</span><span class="o">=</span><span class="s2">&quot;file&quot;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Gets a file path from a specified node/input</span>

<span class="sd">	This function normalizes and attempts to make absolute all paths,</span>
<span class="sd">	whether the input is originally absolute or relative</span>

<span class="sd">    .. Considerations::</span>
<span class="sd">     This method was originally written simply for Nuke objects and getting</span>
<span class="sd">     their knobs but it was eventually adopted to take strings with parseable</span>
<span class="sd">     text (such as %04d, $F4, ####) and an integer as knob in order to return</span>
<span class="sd">     a specific frame number in a sequence. Sorry this method got shoe-horned</span>
<span class="sd">     in so poorly</span>

<span class="sd">    Exmaple Use #1:</span>
<span class="sd">     &gt;&gt;&gt; nukeObject = nuke.toNode(&quot;Write1&quot;)</span>
<span class="sd">     &gt;&gt;&gt; fileKnobName = &quot;file&quot;</span>
<span class="sd">     &gt;&gt;&gt; nuke_get_path_from_write_node(nukeObject, fileKnobName)</span>
<span class="sd">     &quot;/whatever/is/nuke/node/file/knob/filename_####.tiff&quot;</span>

<span class="sd">    Example Use #2:</span>
<span class="sd">     &gt;&gt;&gt; filename = r&quot;/some/path/filename_####.tiff&quot;</span>
<span class="sd">     &gt;&gt;&gt; indexNumber = 8</span>
<span class="sd">     &gt;&gt;&gt; nuke_get_path_from_write_node(filename, indexNumber)</span>
<span class="sd">     &quot;/some/path/filename_0008.tiff&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        inputH (Nuke object or str): The input node or string to get the full</span>
<span class="sd">                                     path from</span>
<span class="sd">        knob (str or int): A string to a Nuke object knob or an integer for</span>
<span class="sd">                           parsed text</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The actual filename to save</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># LOGGER.info(&#39;string inputH:&#39; + str(inputH))</span>
	<span class="c1"># LOGGER.info(&#39;string knob:&#39; + str(knob))</span>
	<span class="c1"># LOGGER.info(&#39;string inputH:&#39; + str(type(inputH)))</span>
	<span class="c1"># LOGGER.info(&#39;string knob:&#39; + str(type(knob)))</span>
	<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;INPUT fileToSave:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">inputH</span><span class="p">))</span>

	<span class="c1"># replace anjy parseable text with a number sequence with padding</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">knob</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">paths</span><span class="o">.</span><span class="n">is_parseable</span><span class="p">(</span><span class="n">inputH</span><span class="p">)</span> \
			<span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputH</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
		<span class="n">fileToSave</span> <span class="o">=</span> <span class="n">paths</span><span class="o">.</span><span class="n">get_expanded_str_from_index</span><span class="p">(</span><span class="n">inputH</span><span class="p">,</span> <span class="n">knob</span><span class="p">)</span>
		<span class="n">fileToSave</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">inputH</span><span class="p">),</span> <span class="n">fileToSave</span><span class="p">)</span>
	<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">knob</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputH</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
		<span class="n">fileToSave</span> <span class="o">=</span> <span class="n">inputH</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">fileToSave</span> <span class="o">=</span> <span class="n">inputH</span><span class="p">[</span><span class="n">knob</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
	<span class="c1"># get absolute path of file</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">fileToSave</span><span class="p">):</span>
		<span class="n">fileToSave</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">fileToSave</span><span class="p">)</span>  <span class="c1"># redundant but just in case</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">baseDir</span> <span class="o">=</span> <span class="n">nuke</span><span class="o">.</span><span class="n">Root</span><span class="p">()[</span><span class="s1">&#39;project_directory&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">baseDir</span> <span class="o">==</span> <span class="s1">&#39;[python {nuke.script_directory()}]&#39;</span><span class="p">:</span>
			<span class="c1"># :::TO DO::: potentially vulnerable.</span>
			<span class="c1"># perhaps process with regex or as TCL and get/run the result?</span>
			<span class="c1">#</span>
			<span class="n">baseDir</span> <span class="o">=</span> <span class="n">nuke</span><span class="o">.</span><span class="n">script_directory</span><span class="p">()</span>
		<span class="n">fileToSave</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">baseDir</span><span class="p">,</span> <span class="n">fileToSave</span><span class="p">)</span>
		<span class="n">fileToSave</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">fileToSave</span><span class="p">)</span>
	<span class="c1"># LOGGER.info(&#39;string inputH:&#39; + str(inputH))</span>
	<span class="c1"># LOGGER.info(&#39;string knob:&#39; + str(knob))</span>
	<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;string fileToSave:&#39;</span> <span class="o">+</span> <span class="n">fileToSave</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">fileToSave</span></div>
<span class="c1"># end nuke_get_path_from_write_node</span>


<div class="viewcode-block" id="checkout_nuke_write_render_before"><a class="viewcode-back" href="../../../fileio.html#fileio.controller.manager.checkout_nuke_write_render_before">[docs]</a><span class="k">def</span> <span class="nf">checkout_nuke_write_render_before</span><span class="p">(</span><span class="n">fileIO</span><span class="p">,</span> <span class="n">filePath</span><span class="p">,</span> <span class="n">forceSave</span><span class="o">=</span><span class="n">consts</span><span class="o">.</span><span class="n">FORCE_SAVE</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Standard implementation of writing files. Originally built for Nuke but</span>
<span class="sd">    later implements Exceptions in order to make the function agnostic. In</span>
<span class="sd">    every implementation of each software, this function is wrapped in a</span>
<span class="sd">    try/except block which, upon exception, will then handle the issue of</span>
<span class="sd">    blocking or allowing saves. This was an alternative to subclassing out</span>
<span class="sd">    and maintaining separate classes for each application.</span>

<span class="sd">    For a full list of the checks that this function undergoes,</span>
<span class="sd">    see :ref:`fileio#checks_to_allow_access`</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    The function is used in mayamanager :ref:`mayamanager`, nukemanager</span>
<span class="sd">    :ref:`nukemanager`, and houdinimanager :ref:`houmanager`</span>

<span class="sd">    fileIO: The FileIO class the be passed and instantiated within</span>
<span class="sd">                   the function</span>
<span class="sd">     .. Note::</span>
<span class="sd">      This has been largely deprecated because, instead of using subclasses</span>
<span class="sd">      PASsed directly into the function, this function remains generic and</span>
<span class="sd">      simply uses exceptions to escape the script mid-execution when a file is</span>
<span class="sd">      allowed/disallowed access permissions. These exceptions are built</span>
<span class="sd">      directly in to one of the base classes from within fileio. For more</span>
<span class="sd">      information, see: the fileio.controller.checkout module :ref:`fileio`,</span>
<span class="sd">      and the fileio.controller.globerror module for the list of exceptions</span>
<span class="sd">      :ref:`exceptions`</span>

<span class="sd">    Args:</span>
<span class="sd">        fileIO (&lt;FileIO object&gt;): fileIO base object (and be any class as long</span>
<span class="sd">                                  as it inherits from FileIO)</span>
<span class="sd">        filePath (str): The full path to a file location. This location is where</span>
<span class="sd">                        read/write access permission is determined</span>
<span class="sd">        forceSave (bool): Ignores the entire save method and lets the user save</span>
<span class="sd">        .. note::</span>
<span class="sd">        	Using this method does NOT lock the file during save, and is thus unsafe</span>

<span class="sd">    Returns:</span>
<span class="sd">        &lt;IOValidationError or IOValidationPassedError&gt; Technically nothing but</span>
<span class="sd">                                                       will almost always raise</span>
<span class="sd">                                                       some sort of error for</span>
<span class="sd">                                                       exception handling</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># Null - replace later</span>
	<span class="c1"># fileToSave = r&quot;C:\Users\korinkite\Dropbox\Private\my_PROJECT\proj_POP2\Pipeline\the_LATEST_pre_maya_open_close_edits_0001\sys_PY\py_MODULES\fileio\test\test_nuke_project\output\s001_ckenne24_010_MODEL_someDescription.0001.ma&quot;</span>
	<span class="n">fileToSave</span> <span class="o">=</span> <span class="n">filePath</span>  <span class="c1"># ::TO DO:: &quot;fileToSave&quot; is redundant. search/replace all in this function to &quot;filePath&quot;</span>
	<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">([</span><span class="s1">&#39;AIE1601&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">fileToSave</span><span class="p">})</span>
	<span class="k">global</span> <span class="n">GLOB_ERROR_MSG</span>
	<span class="n">fileIO</span> <span class="o">=</span> <span class="n">fileIO</span><span class="p">(</span><span class="n">fileToSave</span><span class="p">)</span>
	<span class="c1"># fileIO.allow_save = True  # by default, let the user save</span>
	<span class="c1"># if consts.USERNAME == &quot;kerfuffle&quot;:</span>
	<span class="c1"># 	LOGGER.info(&quot;FILECHECKOUT: Got the value of true and is going to throw the pass error&quot;)</span>
	<span class="c1"># 	LOGGER.info(&quot;ALLOW SAVE WILL SOON BE TRUE&quot;)</span>
	<span class="c1"># 	fileIO.allow_save = True</span>
	<span class="k">if</span> <span class="n">forceSave</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c1"># exit the script and set the save status</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">is_registered</span><span class="p">:</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">([</span><span class="s1">&#39;AIE7700&#39;</span><span class="p">,</span> <span class="s1">&#39;match_false&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">(),</span>
												  <span class="s1">&#39;proj&#39;</span><span class="p">:</span> <span class="n">consts</span><span class="o">.</span><span class="n">PROJECT_NAME_LONG</span><span class="p">})</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;You are not currently registered on the project</span><span class="se">\n\n</span><span class="s2">&quot;</span>\
						   <span class="s2">&quot;Please contact admin {admins} to get &quot;</span>\
						   <span class="s2">&quot;started!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">admins</span><span class="o">=</span><span class="n">consts</span><span class="o">.</span><span class="n">ADMIN_CONTACT_INFO</span><span class="p">)</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span> <span class="o">=</span> <span class="bp">False</span>

	<span class="n">networkManager</span> <span class="o">=</span> <span class="n">NetworkManager</span><span class="p">()</span>
	<span class="n">networkManager</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">fileToSave</span>

	<span class="c1"># DEPRECATED - I&#39;m placing this in the consts file, instead</span>
	<span class="c1"># if not networkManager.is_allowed_application():</span>
	<span class="c1"># 	LOGGER.warning([&#39;6900&#39;, &#39;match_false&#39;], {&#39;app&#39;: os.environ[&#39;APP_EXECUTABLE&#39;], &#39;proj&#39;: consts.PROJECT_NAME_LONG})</span>
	<span class="c1"># 	fileIO.allow_save = False</span>

	<span class="k">if</span> <span class="n">networkManager</span><span class="o">.</span><span class="n">is_local</span><span class="p">():</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">([</span><span class="s1">&#39;AIE1200&#39;</span><span class="p">])</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">([</span><span class="s1">&#39;AIE1201&#39;</span><span class="p">])</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span> <span class="o">=</span> <span class="bp">True</span>
	<span class="k">elif</span> <span class="n">networkManager</span><span class="o">.</span><span class="n">is_remote</span><span class="p">():</span>
		<span class="c1"># ::TO DO:: You will need to add a FTP protocol here. Or change some variable here</span>
		<span class="c1"># to be used in a future method later</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">critical</span><span class="p">([</span><span class="s1">&#39;AIE1201&#39;</span><span class="p">])</span>
		<span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Remote access is disabled. Must be on SCAD network in order to work&quot;</span>
		<span class="n">GLOB_ERROR_MSG</span> <span class="o">=</span> <span class="n">msg</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">error_msg</span> <span class="o">=</span> <span class="n">msg</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">([</span><span class="s1">&#39;AIE7201&#39;</span><span class="p">,</span> <span class="s1">&#39;match_false&#39;</span><span class="p">],</span>
					 <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())})</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span> <span class="o">=</span> <span class="bp">False</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">networkManager</span><span class="o">.</span><span class="n">has_access</span><span class="p">():</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">([</span><span class="s2">&quot;AIE5601&quot;</span><span class="p">,</span> <span class="s1">&#39;match_false&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">fullPath</span><span class="p">})</span>
		<span class="n">contactInfo</span> <span class="o">=</span> <span class="n">networkManager</span><span class="o">.</span><span class="n">read_contact_info_from_locked_file</span><span class="p">()</span>
		<span class="n">isContInfoMissing</span> <span class="o">=</span> <span class="n">networkManager</span><span class="o">.</span><span class="n">is_incomplete_read_contact_info</span><span class="p">(</span><span class="n">contactInfo</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">isContInfoMissing</span><span class="p">:</span>
			<span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Attempted to get contact info from:</span><span class="se">\n\n</span><span class="s2">{loc}</span><span class="se">\n\n</span><span class="s2">but the user &quot;</span>\
				  <span class="s2">&quot;has bad credentials.</span><span class="se">\n\n</span><span class="s2">Save this: {dict}</span><span class="se">\n\n</span><span class="s2">&quot;</span>\
				  <span class="s2">&quot;Please notify admin</span><span class="se">\n\n</span><span class="s2">{bug}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">fileToSave</span><span class="p">,</span>
				  					   				    <span class="nb">dict</span><span class="o">=</span><span class="n">contactInfo</span><span class="p">,</span>
				  										<span class="n">bug</span><span class="o">=</span><span class="n">consts</span><span class="o">.</span><span class="n">BUG_REPORT_PAGE</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Save Location:</span><span class="se">\n\n</span><span class="s2">{loc}</span><span class="se">\n\n</span><span class="s2">is lacking permissions for &quot;</span>\
				  <span class="s2">&quot;current account.</span><span class="se">\n</span><span class="s2">The current owner of the file is</span><span class="se">\n</span><span class="s2">&quot;</span>\
				  <span class="s2">&quot;username: {username}</span><span class="se">\n\n</span><span class="s2">&quot;</span>\
				  <span class="s2">&quot;name: {name}</span><span class="se">\n\n</span><span class="s2">&quot;</span>\
				  <span class="s2">&quot;ip: {ip}</span><span class="se">\n</span><span class="s2">&quot;</span>\
				  <span class="s2">&quot;room number: {roomnumber}</span><span class="se">\n</span><span class="s2">&quot;</span>\
				  <span class="s2">&quot;machine: {machinenumber}</span><span class="se">\n</span><span class="s2">&quot;</span>\
				  <span class="s2">&quot;time locked: {time}</span><span class="se">\n</span><span class="s2">&quot;</span>\
				  <span class="s2">&quot;date locked: {date}</span><span class="se">\n</span><span class="s2">&quot;</span>\
				  <span class="s2">&quot;e-mail: {email}</span><span class="se">\n</span><span class="s2">&quot;</span>\
				  <span class="s2">&quot;phone number: {phonenumber}</span><span class="se">\n\n</span><span class="s2">&quot;</span>\
				  <span class="s2">&quot;IMPORTANT: IF THIS IS YOU - Please send a bug report &quot;</span>\
				  <span class="s2">&quot;to the admin immediately.</span><span class="se">\n\n</span><span class="s2">{bug}</span><span class="se">\n\n</span><span class="s2">If it isn&#39;t you and &quot;</span>\
				  <span class="s2">&quot;you&#39;re in the computer labs, their room number is above. &quot;</span>\
				  <span class="s2">&quot;Otherwise, you can just call them, &quot;</span>\
				  <span class="s2">&quot;too.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">fileToSave</span><span class="p">,</span>
				  		 	    <span class="n">name</span><span class="o">=</span><span class="n">contactInfo</span><span class="p">[</span><span class="s2">&quot;USERFULLNAME&quot;</span><span class="p">],</span>
				  				<span class="n">username</span><span class="o">=</span><span class="n">contactInfo</span><span class="p">[</span><span class="s2">&quot;USERNAME&quot;</span><span class="p">],</span>
				  				<span class="n">ip</span><span class="o">=</span><span class="n">contactInfo</span><span class="p">[</span><span class="s2">&quot;IP&quot;</span><span class="p">],</span>
				  				<span class="n">roomnumber</span><span class="o">=</span><span class="n">contactInfo</span><span class="p">[</span><span class="s1">&#39;ROOM&#39;</span><span class="p">],</span>
				  				<span class="n">machinenumber</span><span class="o">=</span><span class="n">contactInfo</span><span class="p">[</span><span class="s2">&quot;MACHINE&quot;</span><span class="p">],</span>
				  				<span class="n">time</span><span class="o">=</span><span class="n">contactInfo</span><span class="p">[</span><span class="s2">&quot;TIME&quot;</span><span class="p">],</span>
				  				<span class="n">date</span><span class="o">=</span><span class="n">contactInfo</span><span class="p">[</span><span class="s2">&quot;DATE&quot;</span><span class="p">],</span>
				  				<span class="n">email</span><span class="o">=</span><span class="n">contactInfo</span><span class="p">[</span><span class="s1">&#39;EMAIL&#39;</span><span class="p">],</span>
				  				<span class="n">phonenumber</span><span class="o">=</span><span class="n">contactInfo</span><span class="p">[</span><span class="s2">&quot;PHONENUMBER&quot;</span><span class="p">],</span>
				 				<span class="n">bug</span><span class="o">=</span><span class="n">consts</span><span class="o">.</span><span class="n">BUG_REPORT_PAGE</span><span class="p">)</span>
		<span class="n">GLOB_ERROR_MSG</span> <span class="o">=</span> <span class="n">msg</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">error_msg</span> <span class="o">=</span> <span class="n">msg</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">([</span><span class="s1">&#39;AIE9002&#39;</span><span class="p">,</span> <span class="s1">&#39;match_false&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">fileToSave</span><span class="p">})</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span> <span class="o">=</span> <span class="bp">False</span>

	<span class="k">if</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">check_naming_convention</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">consts</span><span class="o">.</span><span class="n">RE_FILENAME_MATCH</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">([</span><span class="s2">&quot;AIE6601&quot;</span><span class="p">,</span> <span class="s1">&#39;match_false&#39;</span><span class="p">],</span>
					   <span class="p">{</span><span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">fileIO</span><span class="o">.</span><span class="n">fullPath</span><span class="p">,</span> <span class="s1">&#39;convention&#39;</span><span class="p">:</span> <span class="n">consts</span><span class="o">.</span><span class="n">MATCH_RE</span><span class="p">})</span>

		<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">consts</span><span class="o">.</span><span class="n">FILE_CONVENTION_EXAMPLE</span><span class="p">[</span><span class="s1">&#39;Nuke&#39;</span><span class="p">]:</span>
			<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">([</span><span class="s1">&#39;AIE5605&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">})</span>
		<span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;File: {f} does not match any possible naming &quot;</span>\
			  <span class="s2">&quot;conventions&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">fileToSave</span><span class="p">)</span>
		<span class="n">GLOB_ERROR_MSG</span> <span class="o">=</span> <span class="n">msg</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">error_msg</span> <span class="o">=</span> <span class="n">msg</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span> <span class="o">=</span> <span class="bp">False</span>

	<span class="k">if</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">is_character_limit</span><span class="p">():</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">([</span><span class="s1">&#39;AIE6500&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">fullPath</span><span class="p">,</span> <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">_sys_character_limit</span><span class="p">})</span>
		<span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Path: </span><span class="se">\&quot;</span><span class="s2">{path}</span><span class="se">\&quot;</span><span class="s2"> exceeds character limit </span><span class="se">\&quot;</span><span class="s2">{limit}</span><span class="se">\&quot;</span><span class="s2">. Please shorten your file&quot;</span><span class="p">,</span>
		<span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">FileIO</span><span class="o">.</span><span class="n">fullPath</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">FileIO</span><span class="o">.</span><span class="n">_sys_character_limit</span><span class="p">)</span>
		<span class="n">GLOB_ERROR_MSG</span> <span class="o">=</span> <span class="n">msg</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">error_msg</span> <span class="o">=</span> <span class="n">msg</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span> <span class="o">=</span> <span class="bp">False</span>

	<span class="k">if</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">is_farm_character_limit</span><span class="p">():</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">([</span><span class="s1">&#39;AIE6500&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">fullPath</span><span class="p">,</span> <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">_farm_character_limit</span><span class="p">})</span>
		<span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Path: </span><span class="se">\&quot;</span><span class="s2">{path}</span><span class="se">\&quot;</span><span class="s2"> exceeds character limit </span><span class="se">\&quot;</span><span class="s2">{limit}</span><span class="se">\&quot;</span><span class="s2">. Please shorten your file&quot;</span><span class="p">,</span>
		<span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">FileIO</span><span class="o">.</span><span class="n">fullPath</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">FileIO</span><span class="o">.</span><span class="n">_farm_character_limit</span><span class="p">)</span>
		<span class="n">GLOB_ERROR_MSG</span> <span class="o">=</span> <span class="n">msg</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">error_msg</span> <span class="o">=</span> <span class="n">msg</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span> <span class="o">=</span> <span class="bp">False</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span><span class="p">:</span>
		<span class="c1"># just in case for some reason the script failed to exit, one last check</span>
		<span class="n">GLOB_ERROR_MSG</span> <span class="o">=</span> <span class="n">msg</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">([</span><span class="s1">&#39;AIE9700&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">fileToSave</span><span class="p">})</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">set_save</span> <span class="o">=</span> <span class="bp">False</span>

	<span class="c1"># File survived all check conditions</span>
	<span class="c1"># Lock the file in preparation for saving if it is not already</span>
	<span class="c1"># (if it is already, we presume it&#39;s because they&#39;re an admin)</span>
	<span class="c1"># (or they are the user that locked it)</span>
	<span class="c1">#</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">networkManager</span><span class="o">.</span><span class="n">is_locked</span><span class="p">:</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;fileToSave&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileToSave</span><span class="p">))</span>
		<span class="c1"># create the nested folder structure for the file</span>
		<span class="n">folderToSaveInto</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fileToSave</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">folderToSaveInto</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">networkManager</span><span class="o">.</span><span class="n">is_local</span><span class="p">():</span>
				<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">([</span><span class="s1">&#39;AIE5606&#39;</span><span class="p">,</span> <span class="s1">&#39;match_false&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;folder&#39;</span><span class="p">:</span> <span class="n">folderToSaveInto</span><span class="p">})</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">([</span><span class="s1">&#39;NET5606&#39;</span><span class="p">,</span> <span class="s1">&#39;match_false&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;folder&#39;</span><span class="p">:</span> <span class="n">folderToSaveInto</span><span class="p">})</span>
			<span class="n">paths</span><span class="o">.</span><span class="n">mkdir_p</span><span class="p">(</span><span class="n">folderToSaveInto</span><span class="p">)</span>

		<span class="n">networkManager</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c1"># lock the file from external editting</span>
		<span class="n">lockedUserInfo</span> <span class="o">=</span> <span class="n">networkManager</span><span class="o">.</span><span class="n">collect_contact_info</span><span class="p">()</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">([</span><span class="s1">&#39;AIE1202&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;full_name&quot;</span><span class="p">:</span> <span class="n">lockedUserInfo</span><span class="p">[</span><span class="s1">&#39;USERFULLNAME&#39;</span><span class="p">],</span>
								  <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">lockedUserInfo</span><span class="p">[</span><span class="s1">&#39;USERNAME&#39;</span><span class="p">],</span>
								  <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="n">lockedUserInfo</span><span class="p">[</span><span class="s1">&#39;IP&#39;</span><span class="p">],</span>
								  <span class="s2">&quot;machine&quot;</span><span class="p">:</span> <span class="n">lockedUserInfo</span><span class="p">[</span><span class="s1">&#39;MACHINE&#39;</span><span class="p">],</span>
								  <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">lockedUserInfo</span><span class="p">[</span><span class="s1">&#39;EMAIL&#39;</span><span class="p">],</span>
								  <span class="s2">&quot;phone&quot;</span><span class="p">:</span> <span class="n">lockedUserInfo</span><span class="p">[</span><span class="s1">&#39;PHONENUMBER&#39;</span><span class="p">]})</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">([</span><span class="s1">&#39;AIE1203&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="n">fileToSave</span><span class="p">})</span>
	<span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c1"># exit the script and set the save status</span></div>
<span class="c1"># end checkout_nuke_write_render_before</span>


<div class="viewcode-block" id="checkout_maya_open_check"><a class="viewcode-back" href="../../../fileio.html#fileio.controller.manager.checkout_maya_open_check">[docs]</a><span class="k">def</span> <span class="nf">checkout_maya_open_check</span><span class="p">(</span><span class="n">retCode</span><span class="p">,</span> <span class="n">clientData</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Standard implementation of checking out a file in Maya</span>

<span class="sd">	WIP Procedure</span>
<span class="sd">	- determine if maya file</span>
<span class="sd">	- is the file the proper naming convention?</span>
<span class="sd">	- determine if local</span>
<span class="sd">	- determine if remote</span>
<span class="sd">	- determine if a registered user</span>
<span class="sd">	- is the queried file+folder path over the OS&#39;s character limit?</span>
<span class="sd">	- is the root folder+filename too long for the farm?</span>

<span class="sd">	.. AUTHORNOTE::</span>
<span class="sd">	 Is that currently even a restriction right now?</span>

<span class="sd">	- if in maya, use the maya open command with a file open GUI</span>
<span class="sd">	- if in the command shell, use a command shell call method, instead</span>
<span class="sd">	- open the file</span>

<span class="sd">	- check the open. If open was successful, lock the file</span>
<span class="sd">	- init maya with a callback for opening/saving</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># fileToOpen = &#39;/home/ckenne24/mount/stuhome/s001_ckenne24_069_exampleProject.0001.ma&#39;  # ::TO DO:: remove</span>
	<span class="n">fileToOpen</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MfileIO</span><span class="o">.</span><span class="n">beforeOpenFilename</span><span class="p">()</span>

	<span class="n">fileIO</span> <span class="o">=</span> <span class="n">checkout</span><span class="o">.</span><span class="n">FileCheckoutMaya</span><span class="p">(</span><span class="n">fileToOpen</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">fileName</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s1">&#39;untitled.ma&#39;</span><span class="p">,</span> <span class="s1">&#39;untitled.mb&#39;</span><span class="p">)):</span>
		<span class="k">return</span> <span class="bp">True</span>  <span class="c1"># pass thru for the default maya session</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">is_maya_file_fast</span><span class="p">():</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">([</span><span class="s1">&#39;MYA5702&#39;</span><span class="p">,</span> <span class="s1">&#39;match_false&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">fullPath</span><span class="p">})</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">consts</span><span class="o">.</span><span class="n">SCRIPTEXIT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">__file__</span><span class="p">)))</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">check_naming_convention</span><span class="p">(</span><span class="n">consts</span><span class="o">.</span><span class="n">RE_FILENAME_MATCH</span><span class="p">):</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">([</span><span class="s1">&#39;AIE6601&#39;</span><span class="p">,</span> <span class="s1">&#39;match_false&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">fullPath</span><span class="p">,</span>
												 <span class="s1">&#39;convention&#39;</span><span class="p">:</span> <span class="n">consts</span><span class="o">.</span><span class="n">MATCH_RE</span><span class="p">,</span>
												 <span class="s1">&#39;match&#39;</span><span class="p">:</span> <span class="n">consts</span><span class="o">.</span><span class="n">RE_FILENAME_MATCH</span><span class="p">})</span>
		<span class="c1"># ::AUTHORNOTE:: ::TO DO:: have a print-out of all maya-related name conventions</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">consts</span><span class="o">.</span><span class="n">SCRIPTEXIT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">__file__</span><span class="p">)))</span>

	<span class="n">networkManager</span> <span class="o">=</span> <span class="n">NetworkManager</span><span class="p">()</span>
	<span class="n">networkManager</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">fileToOpen</span>

	<span class="k">if</span> <span class="n">networkManager</span><span class="o">.</span><span class="n">is_local</span><span class="p">():</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">([</span><span class="s1">&#39;AIE1200&#39;</span><span class="p">])</span>
	<span class="k">elif</span> <span class="n">networkManager</span><span class="o">.</span><span class="n">is_remote</span><span class="p">():</span>
		<span class="c1"># ::TO DO:: You will need to add a FTP protocol here.</span>
		<span class="c1"># Or change some variable here to be used in a future method later</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">([</span><span class="s1">&#39;AIE1201&#39;</span><span class="p">])</span>
		<span class="c1"># ::TO DO:: Value is set to False to not allow any FTP work currently.</span>
		<span class="c1"># Once I have a method for this remove</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span> <span class="o">=</span> <span class="bp">False</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">is_registered</span><span class="p">:</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">critical</span><span class="p">([</span><span class="s1">&#39;AIE9001&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">consts</span><span class="o">.</span><span class="n">USERNAME</span><span class="p">})</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span> <span class="o">=</span> <span class="bp">False</span>
	<span class="k">if</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">is_character_limit</span> <span class="ow">or</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">is_farm_character_limit</span><span class="p">:</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">([</span><span class="s1">&#39;MYA5603&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">fileName</span><span class="p">,</span>
								   <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">filePath</span><span class="p">})</span>
		<span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span> <span class="o">=</span> <span class="bp">False</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span><span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">consts</span><span class="o">.</span><span class="n">SCRIPTEXIT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">__file__</span><span class="p">)))</span>

	<span class="k">if</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">open_file</span><span class="p">():</span>
		<span class="n">networkManager</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="bp">True</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">critical</span><span class="p">([</span><span class="s1">&#39;AIE9002&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">fileName</span><span class="p">})</span></div>
<span class="c1"># end open_checkout_maya</span>


<div class="viewcode-block" id="cancel_save_maya"><a class="viewcode-back" href="../../../fileio.html#fileio.controller.manager.cancel_save_maya">[docs]</a><span class="k">def</span> <span class="nf">cancel_save_maya</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Customize the canceled save window</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">allowSave</span> <span class="o">=</span> <span class="n">fileIO</span><span class="o">.</span><span class="n">allow_save</span>

	<span class="n">string_key</span> <span class="o">=</span> <span class="s2">&quot;s_TfileIOStrings.rFileOpCancelledByUser&quot;</span>
	<span class="n">string_default</span> <span class="o">=</span> <span class="s2">&quot;File operation cancelled by user supplied callback.&quot;</span>
	<span class="n">string_error</span> <span class="o">=</span> <span class="n">msg</span>
	<span class="n">message</span> <span class="o">=</span> <span class="n">string_error</span> <span class="k">if</span> <span class="n">allowSave</span> <span class="k">else</span> <span class="n">string_default</span>
	<span class="n">cmds</span><span class="o">.</span><span class="n">displayString</span><span class="p">(</span><span class="n">string_key</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">message</span><span class="p">)</span></div>
<span class="c1"># end cancel_save_maya</span>


<div class="viewcode-block" id="checkout_maya_close_check"><a class="viewcode-back" href="../../../fileio.html#fileio.controller.manager.checkout_maya_close_check">[docs]</a><span class="k">def</span> <span class="nf">checkout_maya_close_check</span><span class="p">(</span><span class="n">retCode</span><span class="p">,</span> <span class="n">clientData</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Method to run when Maya has successfully exitted/closed</span>

<span class="sd">	- If file was not locked upon closing - send warning that the file was</span>
<span class="sd">	unlocked and could have been editted by another user</span>
<span class="sd">	- If the file is locked, unlock it</span>
<span class="sd">	- deinitialize the entire Maya session</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">fileToClose</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># current file</span>

	<span class="k">if</span> <span class="n">fileToClose</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s1">&#39;untitled.ma&#39;</span><span class="p">,</span> <span class="s1">&#39;untitled.mb&#39;</span><span class="p">)):</span>
		<span class="k">return</span> <span class="bp">True</span>  <span class="c1"># pass thru any temporary files</span>

	<span class="n">networkManager</span> <span class="o">=</span> <span class="n">NetworkManager</span><span class="p">()</span>
	<span class="n">networkManager</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">fileToClose</span>

	<span class="k">if</span> <span class="n">networkManager</span><span class="o">.</span><span class="n">is_locked</span><span class="p">:</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">([</span><span class="s1">&#39;NET5501&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">fileToClose</span><span class="p">})</span>
		<span class="n">networkManager</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># remove locked file</span>

	<span class="n">clear_all</span><span class="p">()</span>  <span class="c1"># clear the current session</span></div>
<span class="c1"># end checkout_maya_close_check</span>


<div class="viewcode-block" id="clear_all"><a class="viewcode-back" href="../../../fileio.html#fileio.controller.manager.clear_all">[docs]</a><span class="k">def</span> <span class="nf">clear_all</span><span class="p">():</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Clean-up method to ensure that Maya boots from an initial state between sessions</span>

<span class="sd">	The method clears:</span>
<span class="sd">	- local environment variables</span>
<span class="sd">	- variables specific to the Maya session</span>
<span class="sd">	- Maya scriptJobs/callbacks (if applicable)</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">([</span><span class="s1">&#39;AIE4800&#39;</span><span class="p">])</span>

	<span class="c1"># Delete all constants and env vars</span>
	<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">consts</span><span class="o">.</span><span class="n">ENV_VARS_MA</span><span class="p">:</span>
		<span class="k">del</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>

	<span class="c1"># Delete all project constants</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">PROJECT_PATH_LINUX</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">PROJECT_PATH_WINDOWS</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">HOSTNAME</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">IPADDRESS</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">NETWORKNAME</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">PROJECT_DIR</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">SYSTEM</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">ROOT_DIR</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">DEV_DIR</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">PUBLISH_DIR</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">CONFIG_DIR</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">MATCH_RE</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">RE_FILENAME_MATCH</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">LOCKED_NOTIFIER</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">SUPPORTED_PLUGINS_MAYA</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">SUPPORTED_APPLICATIONS</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">REGISTERED_ADMINS</span>
	<span class="k">del</span> <span class="n">consts</span><span class="o">.</span><span class="n">FILETYPES_MAYA</span></div>

	<span class="c1"># Delete scriptJobs/callbacks</span>
	<span class="c1"># del CB_BSC</span>
<span class="c1"># end clear_all</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
	<span class="c1"># checkout_maya_open_check()</span>
	<span class="c1"># checkout_maya_save_check()</span>
	<span class="c1"># checkout_maya_close_check()</span>
	<span class="c1"># print(__doc__)</span>
	<span class="n">checkout_nuke_write_check</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Colin Kennedy.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>