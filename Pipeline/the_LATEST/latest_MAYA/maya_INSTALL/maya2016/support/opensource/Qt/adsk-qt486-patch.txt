diff -rau qt-everywhere-opensource-src-4.8.6/configure qt-adsk-4.8.6/configure
--- qt-everywhere-opensource-src-4.8.6/configure	2014-04-11 02:37:08.000000000 +0800
+++ qt-adsk-4.8.6/configure	2014-05-06 04:23:09.000000000 +0800
@@ -5009,8 +5009,8 @@
                 # Avoid overriding the default configuration settings when building with clang/libc++
                 ;;
             *)
-                # For all other configurations require a minimum of 10.5
-                echo "export MACOSX_DEPLOYMENT_TARGET = 10.5" >> "$mkfile"
+                # For all other configurations require a minimum of 10.8
+                echo "export MACOSX_DEPLOYMENT_TARGET = 10.8" >> "$mkfile"
                 ;;
             esac
 
@@ -7225,7 +7225,7 @@
     ;;
 macx*,yes)
     # Cocoa
-    QMakeVar set QMAKE_MACOSX_DEPLOYMENT_TARGET 10.5
+    QMakeVar set QMAKE_MACOSX_DEPLOYMENT_TARGET 10.8.
     ;;
 macx*,no)
     # gcc, Carbon
@@ -7971,7 +7971,7 @@
 fi
 
 # On Mac, set the minimum deployment target for the different architechtures 
-# using the Xarch compiler option when supported (10.5 and up).  On 10.4 the
+# using the Xarch compiler option when supported (10.8 and up).  On 10.4 the
 # deployment version is set to 10.4 globally using the QMAKE_MACOSX_DEPLOYMENT_TARGET
 # env. variable.
 if [ "$PLATFORM_MAC" = "yes" ] && [ "$CFG_MAC_XARCH" != "no" ]; then
@@ -7993,10 +7993,10 @@
             QMakeVar add QMAKE_OBJECTIVE_CFLAGS_PPC "-arch ppc -Xarch_ppc -mmacosx-version-min=10.4"
         fi
         if echo "$CFG_MAC_ARCHS" | grep '\<x86_64\>' > /dev/null 2>&1; then
-            QMakeVar add QMAKE_CFLAGS "-Xarch_x86_64 -mmacosx-version-min=10.5"
-            QMakeVar add QMAKE_CXXFLAGS "-Xarch_x86_64 -mmacosx-version-min=10.5"
-            QMakeVar add QMAKE_LFLAGS "-Xarch_x86_64 -mmacosx-version-min=10.5"
-            QMakeVar add QMAKE_OBJECTIVE_CFLAGS_X86_64 "-arch x86_64 -Xarch_x86_64 -mmacosx-version-min=10.5"
+            QMakeVar add QMAKE_CFLAGS "-Xarch_x86_64 -mmacosx-version-min=10.8"
+            QMakeVar add QMAKE_CXXFLAGS "-Xarch_x86_64 -mmacosx-version-min=10.8"
+            QMakeVar add QMAKE_LFLAGS "-Xarch_x86_64 -mmacosx-version-min=10.8"
+            QMakeVar add QMAKE_OBJECTIVE_CFLAGS_X86_64 "-arch x86_64 -Xarch_x86_64 -mmacosx-version-min=10.8"
         fi
         if echo "$CFG_MAC_ARCHS" | grep '\<ppc64\>' > /dev/null 2>&1; then
             QMakeVar add QMAKE_CFLAGS "-Xarch_ppc64 -mmacosx-version-min=10.5"
diff -rau qt-everywhere-opensource-src-4.8.6/mkspecs/common/gcc-base.conf qt-adsk-4.8.6/mkspecs/common/gcc-base.conf
--- qt-everywhere-opensource-src-4.8.6/mkspecs/common/gcc-base.conf	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/mkspecs/common/gcc-base.conf	2014-05-06 04:23:09.000000000 +0800
@@ -35,7 +35,7 @@
 QMAKE_CFLAGS_DEPS           += -M
 QMAKE_CFLAGS_WARN_ON        += -Wall -W
 QMAKE_CFLAGS_WARN_OFF       += -w
-QMAKE_CFLAGS_RELEASE        += -O2
+QMAKE_CFLAGS_RELEASE        += -O2 -g
 QMAKE_CFLAGS_DEBUG          += -g
 QMAKE_CFLAGS_SHLIB          += -fPIC
 QMAKE_CFLAGS_STATIC_LIB     += -fPIC
diff -rau qt-everywhere-opensource-src-4.8.6/mkspecs/common/gcc-base-unix.conf qt-adsk-4.8.6/mkspecs/common/gcc-base-unix.conf
--- qt-everywhere-opensource-src-4.8.6/mkspecs/common/gcc-base-unix.conf	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/mkspecs/common/gcc-base-unix.conf	2014-05-06 04:23:09.000000000 +0800
@@ -10,6 +10,10 @@
 
 include(gcc-base.conf)
 
+# Autodesk change to use relative RPATH linking, used in QMAKE_LFLAGS below
+DOLLAR = $
+QMAKE_LFLAGS        += -Wl,--enable-new-dtags,-rpath,\\$${DOLLAR}$${DOLLAR}\\ORIGIN:\\$${DOLLAR}$${DOLLAR}\\ORIGIN/../lib:\\$${DOLLAR}$${DOLLAR}\\ORIGIN/../../lib
+
 QMAKE_LFLAGS_SHLIB  += -shared
 QMAKE_LFLAGS_PLUGIN += $$QMAKE_LFLAGS_SHLIB
 QMAKE_LFLAGS_SONAME += -Wl,-soname,
diff -rau qt-everywhere-opensource-src-4.8.6/mkspecs/common/g++-macx.conf qt-adsk-4.8.6/mkspecs/common/g++-macx.conf
--- qt-everywhere-opensource-src-4.8.6/mkspecs/common/g++-macx.conf	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/mkspecs/common/g++-macx.conf	2014-05-06 04:23:09.000000000 +0800
@@ -16,8 +16,8 @@
 
 QMAKE_LFLAGS_STATIC_LIB += -all_load
 
-QMAKE_CFLAGS_X86_64 += -Xarch_x86_64 -mmacosx-version-min=10.5
-QMAKE_CFLAGS_PPC_64 += -Xarch_ppc64 -mmacosx-version-min=10.5
+QMAKE_CFLAGS_X86_64 += -Xarch_x86_64 -mmacosx-version-min=10.8 -g
+QMAKE_CFLAGS_PPC_64 += -Xarch_ppc64 -mmacosx-version-min=10.8
 
 QMAKE_CXXFLAGS_X86_64         = $$QMAKE_CFLAGS_X86_64
 QMAKE_CXXFLAGS_PPC_64         = $$QMAKE_CFLAGS_PPC_64
diff -rau qt-everywhere-opensource-src-4.8.6/mkspecs/common/mac.conf qt-adsk-4.8.6/mkspecs/common/mac.conf
--- qt-everywhere-opensource-src-4.8.6/mkspecs/common/mac.conf	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/mkspecs/common/mac.conf	2014-05-06 04:23:09.000000000 +0800
@@ -38,7 +38,8 @@
 QMAKE_DEL_DIR		= rmdir
 QMAKE_CHK_DIR_EXISTS	= test -d
 QMAKE_MKDIR		= mkdir -p
-QMAKE_MACOSX_DEPLOYMENT_TARGET = 10.4 # overridden to 10.5 for Cocoa on the compiler command line
+QMAKE_MACOSX_DEPLOYMENT_TARGET = 10.8 # overridden to 10.5 for Cocoa on the compiler command line
 
+DEFINES                 += QT_NO_IMPORT_QT47_QML
 
 include(unix.conf)
diff -rau qt-everywhere-opensource-src-4.8.6/mkspecs/unsupported/macx-clang-libc++/qmake.conf qt-adsk-4.8.6/mkspecs/unsupported/macx-clang-libc++/qmake.conf
--- qt-everywhere-opensource-src-4.8.6/mkspecs/unsupported/macx-clang-libc++/qmake.conf	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/mkspecs/unsupported/macx-clang-libc++/qmake.conf	2014-05-06 04:23:09.000000000 +0800
@@ -13,7 +13,7 @@
 include(../../common/gcc-base-macx.conf)
 include(../../common/clang.conf)
 
-QMAKE_MACOSX_DEPLOYMENT_TARGET = 10.7 # Libc++ is available from 10.7 onwards
+QMAKE_MACOSX_DEPLOYMENT_TARGET = 10.8 # Libc++ is available from 10.7 onwards
 
 QMAKE_CFLAGS += -mmacosx-version-min=$$QMAKE_MACOSX_DEPLOYMENT_TARGET
 QMAKE_CXXFLAGS += -stdlib=libc++ -mmacosx-version-min=$$QMAKE_MACOSX_DEPLOYMENT_TARGET
diff -rau qt-everywhere-opensource-src-4.8.6/mkspecs/win32-msvc2008/qmake.conf qt-adsk-4.8.6/mkspecs/win32-msvc2008/qmake.conf
--- qt-everywhere-opensource-src-4.8.6/mkspecs/win32-msvc2008/qmake.conf	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/mkspecs/win32-msvc2008/qmake.conf	2014-05-06 04:23:09.000000000 +0800
@@ -3,6 +3,8 @@
 #
 # Written for Microsoft Visual C++ 2008
 #
+# Modified Autodesk build changes
+#   enable debug symbols for release build
 
 MAKEFILE_GENERATOR      = MSVC.NET
 TEMPLATE                = app
@@ -19,7 +21,7 @@
 QMAKE_CFLAGS            = -nologo -Zm200 -Zc:wchar_t-
 QMAKE_CFLAGS_WARN_ON    = -W3
 QMAKE_CFLAGS_WARN_OFF   = -W0
-QMAKE_CFLAGS_RELEASE    = -O2 -MD
+QMAKE_CFLAGS_RELEASE    = -O2 -MD -Zi
 QMAKE_CFLAGS_RELEASE_WITH_DEBUGINFO += -O2 -MD -Zi
 QMAKE_CFLAGS_DEBUG      = -Zi -MDd
 QMAKE_CFLAGS_YACC       =
diff -rau qt-everywhere-opensource-src-4.8.6/mkspecs/win32-msvc2010/qmake.conf qt-adsk-4.8.6/mkspecs/win32-msvc2010/qmake.conf
--- qt-everywhere-opensource-src-4.8.6/mkspecs/win32-msvc2010/qmake.conf	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/mkspecs/win32-msvc2010/qmake.conf	2014-05-06 04:23:09.000000000 +0800
@@ -16,10 +16,10 @@
 QMAKE_LEXFLAGS          =
 QMAKE_YACC              = byacc
 QMAKE_YACCFLAGS         = -d
-QMAKE_CFLAGS            = -nologo -Zm200 -Zc:wchar_t-
+QMAKE_CFLAGS            = -nologo -Zm200 -Zc:wchar_t
 QMAKE_CFLAGS_WARN_ON    = -W3
 QMAKE_CFLAGS_WARN_OFF   = -W0
-QMAKE_CFLAGS_RELEASE    = -O2 -MD
+QMAKE_CFLAGS_RELEASE    = -O2 -MD -Zi
 QMAKE_CFLAGS_RELEASE_WITH_DEBUGINFO += -O2 -MD -Zi
 QMAKE_CFLAGS_DEBUG      = -Zi -MDd
 QMAKE_CFLAGS_YACC       =
@@ -56,7 +56,7 @@
 
 QMAKE_LINK              = link
 QMAKE_LFLAGS            = /NOLOGO /DYNAMICBASE /NXCOMPAT
-QMAKE_LFLAGS_RELEASE    = /INCREMENTAL:NO
+QMAKE_LFLAGS_RELEASE    = /INCREMENTAL:NO /DEBUG
 QMAKE_LFLAGS_RELEASE_WITH_DEBUGINFO = /DEBUG /OPT:REF
 QMAKE_LFLAGS_DEBUG      = /DEBUG
 QMAKE_LFLAGS_CONSOLE    = /SUBSYSTEM:CONSOLE
diff -rau qt-everywhere-opensource-src-4.8.6/mkspecs/win32-msvc2012/qmake.conf qt-adsk-4.8.6/mkspecs/win32-msvc2012/qmake.conf
--- qt-everywhere-opensource-src-4.8.6/mkspecs/win32-msvc2012/qmake.conf	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/mkspecs/win32-msvc2012/qmake.conf	2014-05-06 04:23:09.000000000 +0800
@@ -8,7 +8,7 @@
 TEMPLATE                = app
 CONFIG                  += qt warn_on release incremental flat link_prl precompile_header autogen_precompile_source copy_dir_files debug_and_release debug_and_release_target embed_manifest_dll embed_manifest_exe
 QT                      += core gui
-DEFINES                 += UNICODE WIN32
+DEFINES                 += UNICODE WIN32 QT_NO_IMPORT_QT47_QML
 QMAKE_COMPILER_DEFINES  += _MSC_VER=1700 WIN32
 
 QMAKE_CC                = cl
@@ -16,10 +16,10 @@
 QMAKE_LEXFLAGS          =
 QMAKE_YACC              = byacc
 QMAKE_YACCFLAGS         = -d
-QMAKE_CFLAGS            = -nologo -Zm200 -Zc:wchar_t-
+QMAKE_CFLAGS            = -nologo -Zm200 -Zc:wchar_t
 QMAKE_CFLAGS_WARN_ON    = -W3
 QMAKE_CFLAGS_WARN_OFF   = -W0
-QMAKE_CFLAGS_RELEASE    = -O2 -MD
+QMAKE_CFLAGS_RELEASE    = -O2 -MD -Zi
 QMAKE_CFLAGS_RELEASE_WITH_DEBUGINFO += -O2 -MD -Zi
 QMAKE_CFLAGS_DEBUG      = -Zi -MDd
 QMAKE_CFLAGS_YACC       =
@@ -56,7 +56,7 @@
 
 QMAKE_LINK              = link
 QMAKE_LFLAGS            = /NOLOGO /DYNAMICBASE /NXCOMPAT
-QMAKE_LFLAGS_RELEASE    = /INCREMENTAL:NO
+QMAKE_LFLAGS_RELEASE    = /INCREMENTAL:NO /DEBUG
 QMAKE_LFLAGS_RELEASE_WITH_DEBUGINFO = /DEBUG /OPT:REF
 QMAKE_LFLAGS_DEBUG      = /DEBUG
 QMAKE_LFLAGS_CONSOLE    = /SUBSYSTEM:CONSOLE
diff -rau qt-everywhere-opensource-src-4.8.6/qmake/generators/win32/winmakefile.cpp qt-adsk-4.8.6/qmake/generators/win32/winmakefile.cpp
--- qt-everywhere-opensource-src-4.8.6/qmake/generators/win32/winmakefile.cpp	2014-04-11 02:37:13.000000000 +0800
+++ qt-adsk-4.8.6/qmake/generators/win32/winmakefile.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -458,6 +458,7 @@
         ts << "\t\t\t\tVALUE \"LegalCopyright\", \"" << copyright << "\\0\"" << endl;
         ts << "\t\t\t\tVALUE \"OriginalFilename\", \"" << originalName << "\\0\"" << endl;
         ts << "\t\t\t\tVALUE \"ProductName\", \"" << productName << "\\0\"" << endl;
+	ts << "\t\t\t\tVALUE \"ProductVersion\", \"" << versionString << "\\0\"" << endl;
         ts << "\t\t\tEND" << endl;
         ts << "\t\tEND" << endl;
         ts << "\t\tBLOCK \"VarFileInfo\"" << endl;
diff -rau qt-everywhere-opensource-src-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/bytecompiler/BytecodeGenerator.cpp qt-adsk-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/bytecompiler/BytecodeGenerator.cpp
--- qt-everywhere-opensource-src-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/bytecompiler/BytecodeGenerator.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/bytecompiler/BytecodeGenerator.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -1835,9 +1835,9 @@
 RegisterID* BytecodeGenerator::emitCatch(RegisterID* targetRegister, Label* start, Label* end)
 {
 #if ENABLE(JIT)
-    HandlerInfo info = { start->bind(0, 0), end->bind(0, 0), instructions().size(), m_dynamicScopeDepth + m_baseScopeDepth, CodeLocationLabel() };
+    HandlerInfo info = { (uint32_t)start->bind(0, 0), (uint32_t)end->bind(0, 0), (uint32_t)instructions().size(), (uint32_t)(m_dynamicScopeDepth + m_baseScopeDepth), CodeLocationLabel() };
 #else
-    HandlerInfo info = { start->bind(0, 0), end->bind(0, 0), instructions().size(), m_dynamicScopeDepth + m_baseScopeDepth };
+    HandlerInfo info = { (uint32_t)start->bind(0, 0), (uint32_t)end->bind(0, 0), (uint32_t)instructions().size(), (uint32_t)(m_dynamicScopeDepth + m_baseScopeDepth) };
 #endif
 
     m_codeBlock->addExceptionHandler(info);
@@ -1889,7 +1889,7 @@
 
 void BytecodeGenerator::beginSwitch(RegisterID* scrutineeRegister, SwitchInfo::SwitchType type)
 {
-    SwitchInfo info = { instructions().size(), type };
+    SwitchInfo info = { (uint32_t)instructions().size(), type };
     switch (type) {
         case SwitchInfo::SwitchImmediate:
             emitOpcode(op_switch_imm);
diff -rau qt-everywhere-opensource-src-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/bytecompiler/BytecodeGenerator.h qt-adsk-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/bytecompiler/BytecodeGenerator.h
--- qt-everywhere-opensource-src-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/bytecompiler/BytecodeGenerator.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/bytecompiler/BytecodeGenerator.h	2014-05-06 04:23:09.000000000 +0800
@@ -176,7 +176,7 @@
             // Node::emitCode assumes that dst, if provided, is either a local or a referenced temporary.
             ASSERT(!dst || dst == ignoredResult() || !dst->isTemporary() || dst->refCount());
             if (!m_codeBlock->numberOfLineInfos() || m_codeBlock->lastLineInfo().lineNumber != n->lineNo()) {
-                LineInfo info = { instructions().size(), n->lineNo() };
+                LineInfo info = { (uint32_t)instructions().size(), n->lineNo() };
                 m_codeBlock->addLineInfo(info);
             }
             if (m_emitNodeDepth >= s_maxEmitNodeDepth)
@@ -195,7 +195,7 @@
         void emitNodeInConditionContext(ExpressionNode* n, Label* trueTarget, Label* falseTarget, bool fallThroughMeansTrue)
         {
             if (!m_codeBlock->numberOfLineInfos() || m_codeBlock->lastLineInfo().lineNumber != n->lineNo()) {
-                LineInfo info = { instructions().size(), n->lineNo() };
+                LineInfo info = { (uint32_t)instructions().size(), n->lineNo() };
                 m_codeBlock->addLineInfo(info);
             }
             if (m_emitNodeDepth >= s_maxEmitNodeDepth)
diff -rau qt-everywhere-opensource-src-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/runtime/Identifier.cpp qt-adsk-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/runtime/Identifier.cpp
--- qt-everywhere-opensource-src-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/runtime/Identifier.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/runtime/Identifier.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -195,7 +195,7 @@
         UString::Rep::empty().hash();
         return &UString::Rep::empty();
     }
-    UCharBuffer buf = {s, length}; 
+    UCharBuffer buf = {s, (unsigned int)length}; 
     pair<HashSet<UString::Rep*>::iterator, bool> addResult = globalData->identifierTable->add<UCharBuffer, UCharBufferTranslator>(buf);
 
     // If the string is newly-translated, then we need to adopt it.
diff -rau qt-everywhere-opensource-src-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/runtime/Structure.cpp qt-adsk-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/runtime/Structure.cpp
--- qt-everywhere-opensource-src-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/runtime/Structure.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/runtime/Structure.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -157,7 +157,7 @@
 {
     if (m_previous) {
         if (m_nameInPrevious)
-            m_previous->table.remove(StructureTransitionTableHash::Key(RefPtr<UString::Rep>(m_nameInPrevious.get()), m_attributesInPrevious), m_specificValueInPrevious);
+            m_previous->table.remove(StructureTransitionTableHash::Key(RefPtr<UString::Rep>(m_nameInPrevious.get()), +m_attributesInPrevious), m_specificValueInPrevious);
         else
             m_previous->table.removeAnonymousSlotTransition(m_anonymousSlotsInPrevious);
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/runtime/Structure.h qt-adsk-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/runtime/Structure.h
--- qt-everywhere-opensource-src-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/runtime/Structure.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/runtime/Structure.h	2014-05-06 04:23:09.000000000 +0800
@@ -317,7 +317,7 @@
         TransitionTable* transitionTable = new TransitionTable;
         setTransitionTable(transitionTable);
         if (existingTransition)
-            add(StructureTransitionTableHash::Key(RefPtr<UString::Rep>(existingTransition->m_nameInPrevious.get()), existingTransition->m_attributesInPrevious), existingTransition, existingTransition->m_specificValueInPrevious);
+            add(StructureTransitionTableHash::Key(RefPtr<UString::Rep>(existingTransition->m_nameInPrevious.get()), +existingTransition->m_attributesInPrevious), existingTransition, existingTransition->m_specificValueInPrevious);
     }
 } // namespace JSC
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/wtf/Threading.h qt-adsk-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/wtf/Threading.h
--- qt-everywhere-opensource-src-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/wtf/Threading.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/3rdparty/javascriptcore/JavaScriptCore/wtf/Threading.h	2014-05-06 04:23:09.000000000 +0800
@@ -71,18 +71,10 @@
 
 #if OS(WINDOWS) && !OS(WINCE)
 #include <windows.h>
-#elif OS(DARWIN)
-#include <libkern/OSAtomic.h>
 #elif OS(ANDROID)
 #include <cutils/atomic.h>
 #elif OS(QNX)
 #include <atomic.h>
-#elif COMPILER(GCC) && !OS(SYMBIAN)
-#if (__GNUC__ > 4) || ((__GNUC__ == 4) && (__GNUC_MINOR__ >= 2))
-#include <ext/atomicity.h>
-#else
-#include <bits/atomicity.h>
-#endif
 #endif
 
 #if USE(PTHREADS)
@@ -230,12 +222,6 @@
 inline int atomicDecrement(int volatile* addend) { return InterlockedDecrement(reinterpret_cast<long volatile*>(addend)); }
 #endif
 
-#elif OS(DARWIN)
-#define WTF_USE_LOCKFREE_THREADSAFESHARED 1
-
-inline int atomicIncrement(int volatile* addend) { return OSAtomicIncrement32Barrier(const_cast<int*>(addend)); }
-inline int atomicDecrement(int volatile* addend) { return OSAtomicDecrement32Barrier(const_cast<int*>(addend)); }
-
 #elif OS(ANDROID)
 
 inline int atomicIncrement(int volatile* addend) { return android_atomic_inc(addend); }
diff -rau qt-everywhere-opensource-src-4.8.6/src/3rdparty/libpng/pngconf.h qt-adsk-4.8.6/src/3rdparty/libpng/pngconf.h
--- qt-everywhere-opensource-src-4.8.6/src/3rdparty/libpng/pngconf.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/3rdparty/libpng/pngconf.h	2014-05-06 04:23:09.000000000 +0800
@@ -270,6 +270,11 @@
 #    define PNG_IMPEXP PNG_DLL_IMPORT
 #  endif
 
+/* Avoid exporting libpng symbols from Qt DLL on Windows */
+# if defined (_MSC_VER) && defined(PNG_IMPEXP)
+# undef PNG_IMPEXP
+# endif
+
 #  ifndef PNG_IMPEXP
 #    define PNG_IMPEXP
 #  endif
diff -rau qt-everywhere-opensource-src-4.8.6/src/3rdparty/webkit/Source/JavaScriptCore/wtf/HashSet.h qt-adsk-4.8.6/src/3rdparty/webkit/Source/JavaScriptCore/wtf/HashSet.h
--- qt-everywhere-opensource-src-4.8.6/src/3rdparty/webkit/Source/JavaScriptCore/wtf/HashSet.h	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/3rdparty/webkit/Source/JavaScriptCore/wtf/HashSet.h	2014-05-06 04:23:09.000000000 +0800
@@ -175,10 +175,18 @@
     }
 
     template<typename T, typename U, typename V>
-    inline pair<typename HashSet<T, U, V>::iterator, bool> HashSet<T, U, V>::add(const ValueType& value)
+#if defined(_WIN32)
+    inline pair<typename HashSet<T, U, V>::const_iterator, bool> HashSet<T, U, V>::add(const ValueType &value)
+	{
+        auto p= m_impl.add(value);
+        return make_pair(typename HashSet<T,U,V>::const_iterator(p.first), p.second);
+	}
+#else
+    inline pair<typename HashSet<T, U, V>::iterator, bool> HashSet<T, U, V>::add(const ValueType &value)
     {
         return m_impl.add(value);
     }
+#endif
 
     template<typename Value, typename HashFunctions, typename Traits>
     template<typename T, typename HashTranslator>
@@ -186,7 +194,13 @@
     HashSet<Value, HashFunctions, Traits>::add(const T& value)
     {
         typedef HashSetTranslatorAdapter<ValueType, ValueTraits, T, HashTranslator> Adapter;
+#if defined(_WIN32)
+        typedef typename HashSet<Value, HashFunctions, Traits>::iterator iter_type;
+        auto& temp = m_impl.template addPassingHashCode<T, T, Adapter>(value, value);
+        return make_pair((iter_type)temp.first, temp.second);
+#else
         return m_impl.template addPassingHashCode<T, T, Adapter>(value, value);
+#endif
     }
 
     template<typename T, typename U, typename V>
diff -rau qt-everywhere-opensource-src-4.8.6/src/3rdparty/webkit/Source/WebCore/platform/DefaultLocalizationStrategy.cpp qt-adsk-4.8.6/src/3rdparty/webkit/Source/WebCore/platform/DefaultLocalizationStrategy.cpp
--- qt-everywhere-opensource-src-4.8.6/src/3rdparty/webkit/Source/WebCore/platform/DefaultLocalizationStrategy.cpp	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/3rdparty/webkit/Source/WebCore/platform/DefaultLocalizationStrategy.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -324,7 +324,7 @@
     RetainPtr<CFStringRef> selectedCFString(AdoptCF, truncatedStringForLookupMenuItem(selectedString).createCFString());
     return formatLocalizedString(WEB_UI_STRING("Look Up “%@”", "Look Up context menu item with selected word"), selectedCFString.get());
 #else
-    return WEB_UI_STRING("Look Up “<selection>”", "Look Up context menu item with selected word").replace("<selection>", truncatedStringForLookupMenuItem(selectedString));
+    return WEB_UI_STRING("Look Up \"<selection>\"", "Look Up context menu item with selected word").replace("<selection>", truncatedStringForLookupMenuItem(selectedString));
 #endif
 #endif
 }
diff -rau qt-everywhere-opensource-src-4.8.6/src/3rdparty/webkit/Source/WebCore/platform/text/TextEncodingRegistry.cpp qt-adsk-4.8.6/src/3rdparty/webkit/Source/WebCore/platform/text/TextEncodingRegistry.cpp
--- qt-everywhere-opensource-src-4.8.6/src/3rdparty/webkit/Source/WebCore/platform/text/TextEncodingRegistry.cpp	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/3rdparty/webkit/Source/WebCore/platform/text/TextEncodingRegistry.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -74,11 +74,20 @@
         char c1;
         char c2;
         do {
+#if defined(_MSC_VER) && _MSC_VER == 1700
+            // Workaround for a bug in the VS2012 Update1 and Update2 optimizer, remove once the fix is released.
+            // https://connect.microsoft.com/VisualStudio/feedback/details/781189/vs2012-update-ctp4-c-optimizing-bug
+            c1 = toASCIILower(*s1++);
+            c2 = toASCIILower(*s2++);
+            if (c1 != c2)
+                return false;
+#else
             c1 = *s1++;
             c2 = *s2++;
             if (toASCIILower(c1) != toASCIILower(c2))
                 return false;
-        } while (c1 && c2);
+#endif
+	} while (c1 && c2);
         return !c1 && !c2;
     }
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/3rdparty/webkit/Source/WebKit/qt/ChangeLog qt-adsk-4.8.6/src/3rdparty/webkit/Source/WebKit/qt/ChangeLog
--- qt-everywhere-opensource-src-4.8.6/src/3rdparty/webkit/Source/WebKit/qt/ChangeLog	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/3rdparty/webkit/Source/WebKit/qt/ChangeLog	2014-05-06 04:23:09.000000000 +0800
@@ -1,3 +1,17 @@
+2012-05-17  Tsarko Yaroslav  <eriktsarko@googlemail.com>
+
+        Reviewed by NOBODY (OOPS!).
+
+        Bug 71271: [Qt] Web Inspector: local inspector client UI becomes unresponsive on debugger pause during
+        https://bugs.webkit.org/show_bug.cgi?id=71271
+
+        Web Inspector should not belong to any other page groups since it is a specialized debugger window.
+        The reason for this change is when debugger pauses web page it pauses all the pages in the page group of debuggee.
+        This leads that Web Inspector front-end is paused too leading to locked Web Inspector GUI (bugzilla ticket 71271).
+
+        * WebCoreSupport/InspectorClientQt.cpp:
+        (WebCore::InspectorClientQt::openInspectorFrontend):
+
 2012-04-02  Casper van Donderen  <casper.vandonderen@nokia.com>
 
         Qt: Doc: Fix typo which marks document to be printed in console font.
diff -rau qt-everywhere-opensource-src-4.8.6/src/3rdparty/webkit/Source/WebKit/qt/WebCoreSupport/InspectorClientQt.cpp qt-adsk-4.8.6/src/3rdparty/webkit/Source/WebKit/qt/WebCoreSupport/InspectorClientQt.cpp
--- qt-everywhere-opensource-src-4.8.6/src/3rdparty/webkit/Source/WebKit/qt/WebCoreSupport/InspectorClientQt.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/3rdparty/webkit/Source/WebKit/qt/WebCoreSupport/InspectorClientQt.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -235,6 +235,9 @@
     m_frontendClient = new InspectorFrontendClientQt(m_inspectedWebPage, inspectorView, this);
     inspectorView->page()->d->page->inspectorController()->setInspectorFrontendClient(m_frontendClient);
     m_frontendWebPage = inspectorPage;
+
+	// Web Inspector should not belong to any other page groups since it is a specialized debugger window.
+	m_frontendWebPage->handle()->page->setGroupName("__WebInspectorPageGroup__");
 #endif
 }
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/global/qglobal.cpp qt-adsk-4.8.6/src/corelib/global/qglobal.cpp
--- qt-everywhere-opensource-src-4.8.6/src/corelib/global/qglobal.cpp	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/global/qglobal.cpp	2014-05-06 23:28:43.000000000 +0800
@@ -1818,6 +1818,8 @@
             winver = QSysInfo::WV_WINDOWS7;
         else if (override == "WINDOWS8")
             winver = QSysInfo::WV_WINDOWS8;
+        else if (override == "WINDOWS8_1")
+            winver = QSysInfo::WV_WINDOWS8_1;
     }
 #endif
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/global/qglobal.h qt-adsk-4.8.6/src/corelib/global/qglobal.h
--- qt-everywhere-opensource-src-4.8.6/src/corelib/global/qglobal.h	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/global/qglobal.h	2014-05-06 04:23:09.000000000 +0800
@@ -58,6 +58,8 @@
 
 #define QT_PACKAGE_TAG "68a911862e05400ced87971c43fb27fb5d5d8ebd"
 
+#define QT_BUILD_INTERNAL
+
 #if !defined(QT_BUILD_MOC)
 #include <QtCore/qconfig.h>
 #endif
@@ -791,6 +793,11 @@
 #  error "Qt has not been tested with this compiler - talk to qt-bugs@trolltech.com"
 #endif
 
+    // ADSK  Check for Intel support of c++0x is wrong comment it out so it doesn't cause more problems
+    // Qt for Maya is currently built with gcc 4.1.2 which doesn't support these C++0x features,
+    // comment out so files compiled with Intel using Qt don't assume Qt supports these
+    // plus the #if  #elif check is backwards >= 1200 will never get checked but that is Nokia's problem
+    // should probably be a #if #endif,  then 2nd  #if  #endif
 
 #ifdef Q_CC_INTEL
 #  if __INTEL_COMPILER < 1200
@@ -798,9 +805,9 @@
 #  endif
 #  if defined(__GXX_EXPERIMENTAL_CXX0X__) || defined(__GXX_EXPERIMENTAL_CPP0X__)
 #    if __INTEL_COMPILER >= 1100
-#      define Q_COMPILER_RVALUE_REFS
-#      define Q_COMPILER_EXTERN_TEMPLATES
-#      define Q_COMPILER_DECLTYPE
+//#      define Q_COMPILER_RVALUE_REFS
+//#      define Q_COMPILER_EXTERN_TEMPLATES
+//#      define Q_COMPILER_DECLTYPE
 #    elif __INTEL_COMPILER >= 1200
 #      define Q_COMPILER_VARIADIC_TEMPLATES
 #      define Q_COMPILER_AUTO_TYPE
@@ -2196,8 +2203,8 @@
      Q_DECLARE_SHARED(type);
 
    where 'type' is the name of the type to specialize.  NOTE: shared
-   types must declare a 'bool isDetached(void) const;' member for this
-   to work.
+   types must define a member-swap, and be defined in the same
+   namespace as Qt for this to work.
 */
 #ifdef QT_NO_STL
 #define Q_DECLARE_SHARED_STL(TYPE)
@@ -2206,7 +2213,7 @@
 QT_END_NAMESPACE \
 namespace std { \
     template<> inline void swap<QT_PREPEND_NAMESPACE(TYPE)>(QT_PREPEND_NAMESPACE(TYPE) &value1, QT_PREPEND_NAMESPACE(TYPE) &value2) \
-    { swap(value1.data_ptr(), value2.data_ptr()); } \
+    { value1.swap(value2); } \
 } \
 QT_BEGIN_NAMESPACE
 #endif
@@ -2214,7 +2221,7 @@
 #define Q_DECLARE_SHARED(TYPE)                                          \
 template <> inline bool qIsDetached<TYPE>(TYPE &t) { return t.isDetached(); } \
 template <> inline void qSwap<TYPE>(TYPE &value1, TYPE &value2) \
-{ qSwap(value1.data_ptr(), value2.data_ptr()); } \
+{ value1.swap(value2); } \
 Q_DECLARE_SHARED_STL(TYPE)
 
 /*
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/global/qnamespace.h qt-adsk-4.8.6/src/corelib/global/qnamespace.h
--- qt-everywhere-opensource-src-4.8.6/src/corelib/global/qnamespace.h	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/global/qnamespace.h	2014-05-06 04:23:09.000000000 +0800
@@ -547,6 +547,7 @@
         AA_S60DisablePartialScreenInputMode = 9,
         AA_X11InitThreads = 10,
         AA_CaptureMultimediaKeys = 11,
+        AA_UseHighDpiPixmaps = 12,
 
         // Add new attributes before this line
         AA_AttributeCount
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/global/qnamespace.qdoc qt-adsk-4.8.6/src/corelib/global/qnamespace.qdoc
--- qt-everywhere-opensource-src-4.8.6/src/corelib/global/qnamespace.qdoc	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/global/qnamespace.qdoc	2014-05-06 04:23:09.000000000 +0800
@@ -180,6 +180,14 @@
             be set before QApplication is constructed. This attribute is only supported in Symbian 
             platform.
 
+    \value AA_UseHighDpiPixmaps Make QIcon::pixmap() generate high-dpi pixmaps
+          that can be larger than the requested size. Such pixmaps will have
+          devicePixelRatio set to a value higher than 1.
+
+          After setting this attribute application code that uses pixmap
+          sizes in layout geometry calculations should typically divide by
+          QPixmap::devicePixelRatio() to get device-independent layout geometry.
+
     \omitvalue AA_AttributeCount
 */
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/io/qfilesystementry_p.h qt-adsk-4.8.6/src/corelib/io/qfilesystementry_p.h
--- qt-everywhere-opensource-src-4.8.6/src/corelib/io/qfilesystementry_p.h	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/io/qfilesystementry_p.h	2014-05-06 04:23:09.000000000 +0800
@@ -62,7 +62,7 @@
 
 QT_BEGIN_NAMESPACE
 
-class QFileSystemEntry
+class Q_AUTOTEST_EXPORT QFileSystemEntry
 {
 public:
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/io/qprocess_unix.cpp qt-adsk-4.8.6/src/corelib/io/qprocess_unix.cpp
--- qt-everywhere-opensource-src-4.8.6/src/corelib/io/qprocess_unix.cpp	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/io/qprocess_unix.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -158,13 +158,6 @@
     }
 }
 
-static inline void add_fd(int &nfds, int fd, fd_set *fdset)
-{
-    FD_SET(fd, fdset);
-    if ((fd) > nfds)
-        nfds = fd;
-}
-
 struct QProcessInfo {
     QProcess *process;
     int deathPipe;
@@ -256,9 +249,9 @@
 void QProcessManager::run()
 {
     forever {
-        fd_set readset;
-        FD_ZERO(&readset);
-        FD_SET(qt_qprocess_deadChild_pipe[0], &readset);
+	pollfd fd;
+	fd.fd = qt_qprocess_deadChild_pipe[0];
+	fd.events = POLLIN;
 
 #if defined (QPROCESS_DEBUG)
         qDebug() << "QProcessManager::run() waiting for children to die";
@@ -267,8 +260,8 @@
         // block forever, or until activity is detected on the dead child
         // pipe. the only other peers are the SIGCHLD signal handler, and the
         // QProcessManager destructor.
-        int nselect = select(qt_qprocess_deadChild_pipe[0] + 1, &readset, 0, 0, 0);
-        if (nselect < 0) {
+        int ret = qt_safe_poll(&fd, 1, -1, /* retry_eintr */ false);
+        if (ret < 0) {
             if (errno == EINTR)
                 continue;
             break;
@@ -1027,17 +1020,6 @@
         ::kill(pid_t(pid), SIGKILL);
 }
 
-static int select_msecs(int nfds, fd_set *fdread, fd_set *fdwrite, int timeout)
-{
-    if (timeout < 0)
-        return qt_safe_select(nfds, fdread, fdwrite, 0, 0);
-
-    struct timeval tv;
-    tv.tv_sec = timeout / 1000;
-    tv.tv_usec = (timeout % 1000) * 1000;
-    return qt_safe_select(nfds, fdread, fdwrite, 0, &tv);
-}
-
 /*
    Returns the difference between msecs and elapsed. If msecs is -1,
    however, -1 is returned.
@@ -1060,10 +1042,10 @@
 	   childStartedPipe[0]);
 #endif
 
-    fd_set fds;
-    FD_ZERO(&fds);
-    FD_SET(childStartedPipe[0], &fds);
-    if (select_msecs(childStartedPipe[0] + 1, &fds, 0, msecs) == 0) {
+    pollfd fd;
+    fd.fd = childStartedPipe[0];
+    fd.events = POLLIN;
+    if (qt_safe_poll(&fd, 1, msecs) == 0) {
         processError = QProcess::Timedout;
         q->setErrorString(QProcess::tr("Process operation timed out"));
 #if defined (QPROCESS_DEBUG)
@@ -1079,6 +1061,47 @@
     return startedEmitted;
 }
 
+class QProcessFDSet {
+    pollfd fds[5];
+
+    const size_t size()
+    {
+	return sizeof(fds)/sizeof(fds[0]);
+    }
+
+public:
+    QProcessFDSet(QProcessPrivate &proc)
+    {
+	for (size_t i = 0; i < size(); ++i) {
+	    fds[i].fd = -1;
+	    fds[i].events = POLLIN;
+	}
+	death().fd = proc.deathPipe[0];
+
+        if (proc.processState == QProcess::Starting)
+	    started().fd = proc.childStartedPipe[0];
+
+	stdout().fd = proc.stdoutChannel.pipe[0];
+	stderr().fd = proc.stderrChannel.pipe[0];
+
+        if (!proc.writeBuffer.isEmpty()) {
+	    stdin().fd = proc.stdinChannel.pipe[1];
+	    stdin().events = POLLOUT;
+	}
+    }
+
+    int poll(int timeout)
+    {
+	return qt_safe_poll(fds, size(), timeout);
+    }
+
+    pollfd &death() { return fds[0]; }
+    pollfd &started() { return fds[1]; }
+    pollfd &stdout() { return fds[2]; }
+    pollfd &stderr() { return fds[3]; }
+    pollfd &stdin() { return fds[4]; }
+};
+
 bool QProcessPrivate::waitForReadyRead(int msecs)
 {
     Q_Q(QProcess);
@@ -1090,28 +1113,9 @@
     stopWatch.start();
 
     forever {
-        fd_set fdread;
-        fd_set fdwrite;
-
-        FD_ZERO(&fdread);
-        FD_ZERO(&fdwrite);
-
-        int nfds = deathPipe[0];
-        FD_SET(deathPipe[0], &fdread);
-
-        if (processState == QProcess::Starting)
-            add_fd(nfds, childStartedPipe[0], &fdread);
-
-        if (stdoutChannel.pipe[0] != -1)
-            add_fd(nfds, stdoutChannel.pipe[0], &fdread);
-        if (stderrChannel.pipe[0] != -1)
-            add_fd(nfds, stderrChannel.pipe[0], &fdread);
-
-        if (!writeBuffer.isEmpty() && stdinChannel.pipe[1] != -1)
-            add_fd(nfds, stdinChannel.pipe[1], &fdwrite);
-
+	QProcessFDSet fdset(*this);
         int timeout = qt_timeout_value(msecs, stopWatch.elapsed());
-        int ret = select_msecs(nfds + 1, &fdread, &fdwrite, timeout);
+        int ret = fdset.poll(timeout);
         if (ret < 0) {
             break;
         }
@@ -1121,18 +1125,18 @@
 	    return false;
 	}
 
-	if (childStartedPipe[0] != -1 && FD_ISSET(childStartedPipe[0], &fdread)) {
+	if (qt_readable(fdset.started())) {
             if (!_q_startupNotification())
                 return false;
 	}
 
         bool readyReadEmitted = false;
-	if (stdoutChannel.pipe[0] != -1 && FD_ISSET(stdoutChannel.pipe[0], &fdread)) {
+	if (qt_readable(fdset.stdout())) {
 	    bool canRead = _q_canReadStandardOutput();
             if (processChannel == QProcess::StandardOutput && canRead)
                 readyReadEmitted = true;
 	}
-	if (stderrChannel.pipe[0] != -1 && FD_ISSET(stderrChannel.pipe[0], &fdread)) {
+	if (qt_readable(fdset.stderr())) {
 	    bool canRead = _q_canReadStandardError();
             if (processChannel == QProcess::StandardError && canRead)
                 readyReadEmitted = true;
@@ -1140,13 +1144,13 @@
         if (readyReadEmitted)
             return true;
 
-	if (stdinChannel.pipe[1] != -1 && FD_ISSET(stdinChannel.pipe[1], &fdwrite))
+	if (qt_writable(fdset.stdin()))
 	    _q_canWrite();
 
-	if (deathPipe[0] == -1 || FD_ISSET(deathPipe[0], &fdread)) {
+	if (qt_readable(fdset.death())) {
             if (_q_processDied())
                 return false;
-        }
+	}
     }
     return false;
 }
@@ -1162,29 +1166,9 @@
     stopWatch.start();
 
     while (!writeBuffer.isEmpty()) {
-        fd_set fdread;
-        fd_set fdwrite;
-
-        FD_ZERO(&fdread);
-        FD_ZERO(&fdwrite);
-
-        int nfds = deathPipe[0];
-        FD_SET(deathPipe[0], &fdread);
-
-        if (processState == QProcess::Starting)
-            add_fd(nfds, childStartedPipe[0], &fdread);
-
-        if (stdoutChannel.pipe[0] != -1)
-            add_fd(nfds, stdoutChannel.pipe[0], &fdread);
-        if (stderrChannel.pipe[0] != -1)
-            add_fd(nfds, stderrChannel.pipe[0], &fdread);
-
-
-        if (!writeBuffer.isEmpty() && stdinChannel.pipe[1] != -1)
-            add_fd(nfds, stdinChannel.pipe[1], &fdwrite);
-
+	QProcessFDSet fdset(*this);
 	int timeout = qt_timeout_value(msecs, stopWatch.elapsed());
-	int ret = select_msecs(nfds + 1, &fdread, &fdwrite, timeout);
+	int ret = fdset.poll(timeout);
         if (ret < 0) {
             break;
         }
@@ -1195,24 +1179,24 @@
 	    return false;
 	}
 
-	if (childStartedPipe[0] != -1 && FD_ISSET(childStartedPipe[0], &fdread)) {
+	if (qt_readable(fdset.started())) {
 	    if (!_q_startupNotification())
 		return false;
 	}
 
-	if (stdinChannel.pipe[1] != -1 && FD_ISSET(stdinChannel.pipe[1], &fdwrite))
+	if (qt_writable(fdset.stdin()))
 	    return _q_canWrite();
 
-	if (stdoutChannel.pipe[0] != -1 && FD_ISSET(stdoutChannel.pipe[0], &fdread))
+	if (qt_readable(fdset.stdout()))
 	    _q_canReadStandardOutput();
 
-	if (stderrChannel.pipe[0] != -1 && FD_ISSET(stderrChannel.pipe[0], &fdread))
+	if (qt_readable(fdset.stderr()))
 	    _q_canReadStandardError();
 
-	if (deathPipe[0] == -1 || FD_ISSET(deathPipe[0], &fdread)) {
-            if (_q_processDied())
-                return false;
-        }
+	if (qt_readable(fdset.death())) {
+	    if (_q_processDied())
+		return false;
+	}
     }
 
     return false;
@@ -1229,29 +1213,9 @@
     stopWatch.start();
 
     forever {
-        fd_set fdread;
-        fd_set fdwrite;
-        int nfds = -1;
-
-        FD_ZERO(&fdread);
-        FD_ZERO(&fdwrite);
-
-        if (processState == QProcess::Starting)
-            add_fd(nfds, childStartedPipe[0], &fdread);
-
-        if (stdoutChannel.pipe[0] != -1)
-            add_fd(nfds, stdoutChannel.pipe[0], &fdread);
-        if (stderrChannel.pipe[0] != -1)
-            add_fd(nfds, stderrChannel.pipe[0], &fdread);
-
-        if (processState == QProcess::Running)
-            add_fd(nfds, deathPipe[0], &fdread);
-
-        if (!writeBuffer.isEmpty() && stdinChannel.pipe[1] != -1)
-            add_fd(nfds, stdinChannel.pipe[1], &fdwrite);
-
+	QProcessFDSet fdset(*this);
 	int timeout = qt_timeout_value(msecs, stopWatch.elapsed());
-	int ret = select_msecs(nfds + 1, &fdread, &fdwrite, timeout);
+	int ret = fdset.poll(timeout);
         if (ret < 0) {
             break;
         }
@@ -1261,20 +1225,20 @@
 	    return false;
 	}
 
-	if (childStartedPipe[0] != -1 && FD_ISSET(childStartedPipe[0], &fdread)) {
+	if (qt_readable(fdset.started())) {
 	    if (!_q_startupNotification())
 		return false;
 	}
-	if (stdinChannel.pipe[1] != -1 && FD_ISSET(stdinChannel.pipe[1], &fdwrite))
+	if (qt_writable(fdset.stdin()))
 	    _q_canWrite();
 
-	if (stdoutChannel.pipe[0] != -1 && FD_ISSET(stdoutChannel.pipe[0], &fdread))
+	if (qt_readable(fdset.stdout()))
 	    _q_canReadStandardOutput();
 
-	if (stderrChannel.pipe[0] != -1 && FD_ISSET(stderrChannel.pipe[0], &fdread))
+	if (qt_readable(fdset.stderr()))
 	    _q_canReadStandardError();
 
-	if (deathPipe[0] == -1 || FD_ISSET(deathPipe[0], &fdread)) {
+	if (qt_readable(fdset.death())) {
             if (_q_processDied())
                 return true;
 	}
@@ -1284,10 +1248,10 @@
 
 bool QProcessPrivate::waitForWrite(int msecs)
 {
-    fd_set fdwrite;
-    FD_ZERO(&fdwrite);
-    FD_SET(stdinChannel.pipe[1], &fdwrite);
-    return select_msecs(stdinChannel.pipe[1] + 1, 0, &fdwrite, msecs < 0 ? 0 : msecs) == 1;
+    pollfd fd;
+    fd.fd = stdinChannel.pipe[1];
+    fd.events = POLLIN;
+    return qt_safe_poll(&fd, 1, msecs);
 }
 
 void QProcessPrivate::findExitCode()
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/kernel/qcore_unix.cpp qt-adsk-4.8.6/src/corelib/kernel/qcore_unix.cpp
--- qt-everywhere-opensource-src-4.8.6/src/corelib/kernel/qcore_unix.cpp	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/kernel/qcore_unix.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -99,4 +99,138 @@
     }
 }
 
+#ifndef Q_OS_VXWORKS
+
+int qt_safe_poll(struct pollfd *fds, int nfds, int timeout_ms, bool retry_eintr)
+{
+    timeval previous = qt_gettime();
+    timeval deadline = previous;
+    deadline.tv_sec += timeout_ms / 1000;
+    deadline.tv_usec += (timeout_ms % 1000) * 1000;
+    if (deadline.tv_usec >= 1000000) {
+	++deadline.tv_sec;
+	deadline.tv_usec -= 1000000;
+    }
+    int remaining = timeout_ms;
+
+    // Retry on ret == 0 if the deadline has not yet passed because
+    // Linux can return early from the syscall, without setting EINTR.
+    forever {
+	int ret = ::poll(fds, nfds, remaining);
+	if (ret > 0)
+	    return ret;
+	timeval now = qt_gettime();
+	if ((now.tv_sec > deadline.tv_sec // past deadline
+	     || (now.tv_sec == deadline.tv_sec
+		 && now.tv_usec >= deadline.tv_usec))
+	    || (now.tv_sec < previous.tv_sec // time warp
+		|| (now.tv_sec == previous.tv_sec
+		    && now.tv_usec < previous.tv_usec))
+	    || (ret < 0 && (errno != EINTR || !retry_eintr))) // other error
+	    return ret;
+	if (ret == 0 && !retry_eintr) {
+	    errno = EINTR;
+	    return -1;
+	}
+        remaining = (deadline.tv_sec - now.tv_sec) * 1000
+		     + (deadline.tv_usec - now.tv_usec) / 1000;
+	previous = now;
+    }
+}
+
+#else
+
+// Poll emulation for VxWorks.
+
+static int mark_bad_descriptors(pollfd *fds, int nfds)
+{
+    fd_set r;
+    FD_ZERO(&r);
+    struct timeval tv;
+    tv.tv_sec = 0;
+    tv.tv_usec = 0;
+    int ret = 0;
+
+    // Check each descriptor invidually for badness.
+    for (int i = 0; i < nfds; ++i) {
+        pollfd &fd(fds[i]);
+        if (fd.fd >= 0) {
+            FD_SET(fd.fd, &r);
+            int ret = qt_safe_select(fd.fd + 1, &r, NULL, NULL, &tv);
+            FD_CLR(fd.fd, &r);
+            if (ret < 0 && errno == EBADF) {
+                fd.revents = POLLNVAL;
+                ++ret;
+            }
+        }
+    }
+    Q_ASSERT(ret > 0);
+    return ret;
+}
+
+int qt_safe_poll(pollfd *fds, int nfds, int timeout, bool retry_eintr)
+{
+    fd_set r, w;
+    FD_ZERO(&r);
+    FD_ZERO(&w);
+    int maxfd = -1;
+
+    // Extract the watched descriptors.
+    for (int i = 0; i < nfds; ++i) {
+        pollfd &fd(fds[i]);
+        if (fd.fd >= 0 && fd.fd < FD_SETSIZE) {
+            if (fd.events & POLLIN) {
+                FD_SET(fd.fd, &r);
+                if (fd.fd > maxfd)
+                    maxfd = fd.fd;
+            }
+            if (fd.events & POLLOUT) {
+                FD_SET(fd.fd, &w);
+                if (fd.fd > maxfd)
+                    maxfd = fd.fd;
+            }
+        }
+    }
+
+    // If timeout is negative, wait indefinitely for activity.
+    timeval tv;
+    timeval *ptv;
+    if (timeout >= 0) {
+        tv.tv_sec = timeout / 1000;
+        tv.tv_usec = (timeout % 1000) * 1000;
+        ptv = &tv;
+    } else
+        ptv = NULL;
+
+    int ret;
+    if (retry_eintr)
+        ret = qt_safe_select(maxfd + 1, &r, &w, NULL, ptv);
+    else
+        ret = ::select(maxfd + 1, &r, &w, NULL, ptv);
+    if (ret < 0 && errno == EBADF) {
+        return mark_bad_descriptors(fds, nfds);
+    }
+    if (ret <= 0)
+        return ret;
+
+    // Set the revents flags.
+    ret = 0;
+    for (int i = 0; i < nfds; ++i) {
+        pollfd &fd(fds[i]);
+        fd.revents = 0;
+        if (fd.fd >= 0 && fd.fd < FD_SETSIZE) {
+            if ((fd.events & POLLIN) && FD_ISSET(fd.fd, &r))
+                fd.revents |= POLLIN;
+            if ((fd.events & POLLOUT) && FD_ISSET(fd.fd, &w))
+                fd.revents |= POLLOUT;
+            if (fd.revents)
+                ++ret;
+        }
+    }
+    Q_ASSERT(ret > 0);
+    return ret;
+}
+
+#endif
+
 QT_END_NAMESPACE
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/kernel/qcore_unix_p.h qt-adsk-4.8.6/src/corelib/kernel/qcore_unix_p.h
--- qt-everywhere-opensource-src-4.8.6/src/corelib/kernel/qcore_unix_p.h	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/kernel/qcore_unix_p.h	2014-05-06 04:23:09.000000000 +0800
@@ -345,9 +345,42 @@
 
 timeval qt_gettime(); // in qelapsedtimer_mac.cpp or qtimestamp_unix.cpp
 
+// Deprecated due to FD_SETSIZE limitation, use qt_safe_poll instead.
 Q_CORE_EXPORT int qt_safe_select(int nfds, fd_set *fdread, fd_set *fdwrite, fd_set *fdexcept,
                                  const struct timeval *tv);
 
+#ifndef Q_OS_VXWORKS
+#include <poll.h>
+#else
+
+// Poll emulation for VxWorks.
+
+struct pollfd {
+  int fd;
+  short events;
+  short revents;
+};
+
+#define POLLIN 1
+#define POLLOUT 2
+#define POLLERR 4
+#define POLLHUP 8
+#define POLLNVAL 16
+#endif
+
+inline bool qt_readable(const pollfd &fd)
+{
+  return fd.fd >= 0 && (fd.revents & (POLLIN | POLLHUP | POLLERR | POLLNVAL)) != 0;
+}
+
+inline bool qt_writable(const pollfd &fd)
+{
+  return fd.fd >= 0 && (fd.revents & (POLLOUT | POLLHUP | POLLERR | POLLNVAL)) != 0;
+}
+
+Q_CORE_EXPORT int qt_safe_poll(pollfd *fds, int nfds, int timeout,
+                               bool retry_eintr = true);
+
 // according to X/OPEN we have to define semun ourselves
 // we use prefix as on some systems sem.h will have it
 struct semid_ds;
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/kernel/qobject.cpp qt-adsk-4.8.6/src/corelib/kernel/qobject.cpp
--- qt-everywhere-opensource-src-4.8.6/src/corelib/kernel/qobject.cpp	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/kernel/qobject.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -130,6 +130,11 @@
 
 QObjectData::~QObjectData() {}
 
+//ADSK: hash of names to objects which have names. Object objects with
+//      names are added to the hash
+
+QMultiHash<QString, QObject*> *QObjectPrivate::namedObjects = 0;
+
 QObjectPrivate::QObjectPrivate(int version)
     : threadData(0), connectionLists(0), senders(0), currentSender(0), currentChildBeingDeleted(0)
 {
@@ -427,7 +432,8 @@
         more = true;
     }
     if (!more)
-        QObjectPrivate::get(*ptr)->hasGuards = false;
+        if (QObjectPrivate::get(*ptr))
+            QObjectPrivate::get(*ptr)->hasGuards = false;
 }
 
 /*!\internal
@@ -457,7 +463,8 @@
             more = true;
         }
         if (!more)
-            QObjectPrivate::get(*ptr)->hasGuards = false;
+            if (QObjectPrivate::get(*ptr))
+                QObjectPrivate::get(*ptr)->hasGuards = false;
     }
     *ptr = o;
 }
@@ -865,6 +872,10 @@
             delete d->sharedRefcount;
     }
 
+    //ADSK: keep hash up to date
+    if (QObjectPrivate::namedObjects) {
+        QObjectPrivate::namedObjects->remove(d->objectName, this);
+    }
 
     if (d->isSignalConnected(0)) {
         QT_TRY {
@@ -1100,6 +1111,12 @@
     Q_D(QObject);
     bool objectNameChanged = d->declarativeData && d->objectName != name;
 
+    //ADSK: update hash table
+    if (QObjectPrivate::namedObjects) {
+        QObjectPrivate::namedObjects->remove(d->objectName, this);
+        QObjectPrivate::namedObjects->insert(name, this);
+    }
+
     d->objectName = name;
 
     if (objectNameChanged) 
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/kernel/qobject_p.h qt-adsk-4.8.6/src/corelib/kernel/qobject_p.h
--- qt-everywhere-opensource-src-4.8.6/src/corelib/kernel/qobject_p.h	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/kernel/qobject_p.h	2014-05-06 04:23:09.000000000 +0800
@@ -220,6 +220,7 @@
 #ifdef QT_JAMBI_BUILD
     int *deleteWatch;
 #endif
+    static QMultiHash<QString, QObject*> *namedObjects;
 };
 
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/tools/qalgorithms.h qt-adsk-4.8.6/src/corelib/tools/qalgorithms.h
--- qt-everywhere-opensource-src-4.8.6/src/corelib/tools/qalgorithms.h	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/tools/qalgorithms.h	2014-05-06 04:23:09.000000000 +0800
@@ -337,8 +337,15 @@
 namespace QAlgorithmsPrivate {
 
 template <typename RandomAccessIterator, typename T, typename LessThan>
+#ifndef QT_NO_STL
+Q_OUTOFLINE_TEMPLATE void qSortHelper(RandomAccessIterator start, RandomAccessIterator end, const T & , LessThan lessThan)
+#else
 Q_OUTOFLINE_TEMPLATE void qSortHelper(RandomAccessIterator start, RandomAccessIterator end, const T &t, LessThan lessThan)
+#endif
 {
+#ifndef QT_NO_STL
+    std::sort(start, end, lessThan);
+#else
 top:
     int span = int(end - start);
     if (span < 2)
@@ -387,6 +394,7 @@
     start = low + 1;
     ++end;
     goto top;
+#endif
 }
 
 template <typename RandomAccessIterator, typename T>
@@ -447,8 +455,15 @@
 }
 
 template <typename RandomAccessIterator, typename T, typename LessThan>
+#ifndef QT_NO_STL
+Q_OUTOFLINE_TEMPLATE void qStableSortHelper(RandomAccessIterator begin, RandomAccessIterator end, const T & , LessThan lessThan)
+#else 
 Q_OUTOFLINE_TEMPLATE void qStableSortHelper(RandomAccessIterator begin, RandomAccessIterator end, const T &t, LessThan lessThan)
+#endif
 {
+#ifndef QT_NO_STL
+    std::stable_sort(begin, end, lessThan);
+#else 
     const int span = end - begin;
     if (span < 2)
        return;
@@ -457,6 +472,7 @@
     qStableSortHelper(begin, middle, t, lessThan);
     qStableSortHelper(middle, end, t, lessThan);
     qMerge(begin, middle, end, t, lessThan);
+#endif
 }
 
 template <typename RandomAccessIterator, typename T>
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/tools/qbytearray.h qt-adsk-4.8.6/src/corelib/tools/qbytearray.h
--- qt-everywhere-opensource-src-4.8.6/src/corelib/tools/qbytearray.h	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/tools/qbytearray.h	2014-05-06 04:23:09.000000000 +0800
@@ -39,6 +39,11 @@
 **
 ****************************************************************************/
 
+
+// Autodesk modified names of parameters to avoid defined name conflicts
+// aSize => asize
+// aPos  => apos
+
 #ifndef QBYTEARRAY_H
 #define QBYTEARRAY_H
 
@@ -439,8 +444,8 @@
 inline QByteArray::QByteArray(const QByteArray &a) : d(a.d)
 { d->ref.ref(); }
 #ifdef QT3_SUPPORT
-inline QByteArray::QByteArray(int aSize) : d(&shared_null)
-{ d->ref.ref(); if (aSize > 0) fill('\0', aSize); }
+inline QByteArray::QByteArray(int asize) : d(&shared_null)
+{ d->ref.ref(); if (asize > 0) fill('\0', asize); }
 #endif
 
 inline int QByteArray::capacity() const
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/tools/qlist.h qt-adsk-4.8.6/src/corelib/tools/qlist.h
--- qt-everywhere-opensource-src-4.8.6/src/corelib/tools/qlist.h	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/tools/qlist.h	2014-05-06 04:23:09.000000000 +0800
@@ -369,8 +369,15 @@
 template <typename T>
 Q_INLINE_TEMPLATE void QList<T>::node_construct(Node *n, const T &t)
 {
-    if (QTypeInfo<T>::isLarge || QTypeInfo<T>::isStatic) n->v = new T(t);
-    else if (QTypeInfo<T>::isComplex) new (n) T(t);
+	if (QTypeInfo<T>::isLarge || QTypeInfo<T>::isStatic) 
+	{
+		void *memory = qMallocAligned(sizeof(T), 16);
+		n->v = new (memory) T(t);
+	}
+    else if (QTypeInfo<T>::isComplex) 
+	{
+		new (n) T(t);
+	}
 #if (defined(__GNUC__) || defined(__INTEL_COMPILER) || defined(__IBMCPP__)) && !defined(__OPTIMIZE__)
     // This violates pointer aliasing rules, but it is known to be safe (and silent)
     // in unoptimized GCC builds (-fno-strict-aliasing). The other compilers which
@@ -385,8 +392,12 @@
 template <typename T>
 Q_INLINE_TEMPLATE void QList<T>::node_destruct(Node *n)
 {
-    if (QTypeInfo<T>::isLarge || QTypeInfo<T>::isStatic) delete reinterpret_cast<T*>(n->v);
-    else if (QTypeInfo<T>::isComplex) reinterpret_cast<T*>(n)->~T();
+	if (QTypeInfo<T>::isLarge || QTypeInfo<T>::isStatic) 
+	{
+		reinterpret_cast<T*>(n->v)->~T();
+		qFreeAligned(n->v);
+	}
+	else if (QTypeInfo<T>::isComplex) reinterpret_cast<T*>(n)->~T();
 }
 
 template <typename T>
@@ -395,14 +406,22 @@
     Node *current = from;
     if (QTypeInfo<T>::isLarge || QTypeInfo<T>::isStatic) {
         QT_TRY {
-            while(current != to) {
-                current->v = new T(*reinterpret_cast<T*>(src->v));
+			while(current != to) 
+			{
+				void *memory = qMallocAligned(sizeof(T), 16);
+
+                current->v = new (memory) T(*reinterpret_cast<T*>(src->v));
+				
                 ++current;
                 ++src;
             }
         } QT_CATCH(...) {
             while (current-- != from)
-                delete reinterpret_cast<T*>(current->v);
+			{
+				reinterpret_cast<T*>(current->v)->~T();
+				qFreeAligned(current->v);
+			}
+					
             QT_RETHROW;
         }
 
@@ -428,7 +447,14 @@
 Q_INLINE_TEMPLATE void QList<T>::node_destruct(Node *from, Node *to)
 {
     if (QTypeInfo<T>::isLarge || QTypeInfo<T>::isStatic)
-        while(from != to) --to, delete reinterpret_cast<T*>(to->v);
+	{
+        while(from != to) 
+		{
+			--to;
+			reinterpret_cast<T*>(to->v)->~T();
+			qFreeAligned(to->v);
+		}
+	}
     else if (QTypeInfo<T>::isComplex)
         while (from != to) --to, reinterpret_cast<T*>(to)->~T();
 }
diff -rau qt-everywhere-opensource-src-4.8.6/src/corelib/tools/qstring.h qt-adsk-4.8.6/src/corelib/tools/qstring.h
--- qt-everywhere-opensource-src-4.8.6/src/corelib/tools/qstring.h	2014-04-11 02:37:11.000000000 +0800
+++ qt-adsk-4.8.6/src/corelib/tools/qstring.h	2014-05-06 04:23:09.000000000 +0800
@@ -39,6 +39,11 @@
 **
 ****************************************************************************/
 
+
+// Autodesk modified names of parameters to avoid defined name conflicts
+// aSize => asize
+// aPos  => apos
+
 #ifndef QSTRING_H
 #define QSTRING_H
 
@@ -563,8 +568,8 @@
     inline QT3_SUPPORT QString upper() const { return toUpper(); }
     inline QT3_SUPPORT QString stripWhiteSpace() const { return trimmed(); }
     inline QT3_SUPPORT QString simplifyWhiteSpace() const { return simplified(); }
-    inline QT3_SUPPORT QString &setUnicodeCodes(const ushort *unicode_as_ushorts, int aSize)
-    { return setUtf16(unicode_as_ushorts, aSize); }
+    inline QT3_SUPPORT QString &setUnicodeCodes(const ushort *unicode_as_ushorts, int asize)
+    { return setUtf16(unicode_as_ushorts, asize); }
     inline QT3_SUPPORT const ushort *ucs2() const { return utf16(); }
     inline static QT3_SUPPORT QString fromUcs2(const ushort *unicode, int size = -1)
     { return fromUtf16(unicode, size); }
@@ -1085,8 +1090,8 @@
 class QConstString : public QString
 {
 public:
-    inline QT3_SUPPORT_CONSTRUCTOR QConstString(const QChar *aUnicode, int aSize)
-        :QString(aUnicode, aSize){} // cannot use fromRawData() due to changed semantics
+    inline QT3_SUPPORT_CONSTRUCTOR QConstString(const QChar *aUnicode, int asize)
+        :QString(aUnicode, asize){} // cannot use fromRawData() due to changed semantics
     inline QT3_SUPPORT const QString &string() const { return *this; }
 };
 #endif
@@ -1193,8 +1198,8 @@
 inline QStringRef &QStringRef::operator=(const QString *aString)
 { m_string = aString; m_position = 0; m_size = aString?aString->size():0; return *this; }
 
-inline QStringRef::QStringRef(const QString *aString, int aPosition, int aSize)
-        :m_string(aString), m_position(aPosition), m_size(aSize){}
+inline QStringRef::QStringRef(const QString *aString, int aposition, int asize)
+        :m_string(aString), m_position(aposition), m_size(asize){}
 
 inline QStringRef::QStringRef(const QString *aString)
     :m_string(aString), m_position(0), m_size(aString?aString->size() : 0){}
diff -rau qt-everywhere-opensource-src-4.8.6/src/declarative/qml/qdeclarativeprivate.h qt-adsk-4.8.6/src/declarative/qml/qdeclarativeprivate.h
--- qt-everywhere-opensource-src-4.8.6/src/declarative/qml/qdeclarativeprivate.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/declarative/qml/qdeclarativeprivate.h	2014-05-06 04:23:09.000000000 +0800
@@ -239,7 +239,7 @@
     };
 
     struct RegisterComponent {
-        const QUrl &url;
+        QUrl url;
         const char *uri;
         const char *typeName;
         int majorVersion;
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/dialogs/qfiledialog.cpp qt-adsk-4.8.6/src/gui/dialogs/qfiledialog.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/dialogs/qfiledialog.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/dialogs/qfiledialog.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -58,6 +58,8 @@
 #include <qdebug.h>
 #include <qapplication.h>
 #include <qstylepainter.h>
+#include "qmimedata.h"
+#include "qclipboard.h"
 #include <itemviews/qfileiconprovider_p.h>
 #if !defined(Q_WS_WINCE) && !defined(Q_OS_SYMBIAN)
 #include "ui_qfiledialog.h"
@@ -314,6 +316,25 @@
 #endif
 QT_END_INCLUDE_NAMESPACE
 
+const char *qt_file_dialog_wildcard_symbols = 
+	"[\\?\\*]";
+
+//const char *qt_file_dialog_filter_reg_exp =
+//    "^([^()]*)\\(([a-zA-Z0-9_.*? +;#\\-\\[\\]@\\{\\}/!<>\\$%&=^~:\\|]*)\\)$";
+const char *qt_file_dialog_filter_reg_exp =
+"^(.*)\\(([a-zA-Z0-9_.*? +;#\\-\\[\\]@\\{\\}/!<>\\$%&=^~:\\|]*)\\)$";
+
+// Makes a list of filters from a normal filter string "Image Files (*.png *.jpg)"
+QStringList qt_clean_filter_list(const QString &filter)
+{
+    QRegExp regexp(QString::fromLatin1(qt_file_dialog_filter_reg_exp));
+    QString f = filter;
+    int i = regexp.indexIn(f);
+    if (i >= 0)
+        f = regexp.cap(2);
+    return f.split(QLatin1Char(' '), QString::SkipEmptyParts);
+}
+
 /*!
     \fn QFileDialog::QFileDialog(QWidget *parent, Qt::WindowFlags flags)
 
@@ -405,9 +426,6 @@
 
 static const qint32 QFileDialogMagic = 0xbe;
 
-const char *qt_file_dialog_filter_reg_exp =
-"^(.*)\\(([a-zA-Z0-9_.*? +;#\\-\\[\\]@\\{\\}/!<>\\$%&=^~:\\|]*)\\)$";
-
 /*!
     \since 4.3
     Saves the state of the dialog's layout, history and current directory.
@@ -587,6 +605,8 @@
     }
 
     /* MENU ACTIONS */
+    	copyAction->setText(QFileDialog::tr("&Copy"));
+	pasteAction->setText(QFileDialog::tr("&Paste"));
     renameAction->setText(QFileDialog::tr("&Rename"));
     deleteAction->setText(QFileDialog::tr("&Delete"));
     showHiddenAction->setText(QFileDialog::tr("Show &hidden files"));
@@ -682,6 +702,8 @@
         bool ro = (options & ReadOnly);
         d->model->setReadOnly(ro);
         d->qFileDialogUi->newFolderButton->setEnabled(!ro);
+        d->copyAction->setEnabled(!ro);
+        d->pasteAction->setEnabled(!ro);
         d->renameAction->setEnabled(!ro);
         d->deleteAction->setEnabled(!ro);
     }
@@ -973,22 +995,33 @@
     QStringList files;
     for (int i=0; i<filesToFix.size(); ++i) {
         QString name = toInternal(filesToFix.at(i));
-        QFileInfo info(name);
-        // if the filename has no suffix, add the default suffix
-        if (!defaultSuffix.isEmpty() && !info.isDir() && name.lastIndexOf(QLatin1Char('.')) == -1)
-            name += QLatin1Char('.') + defaultSuffix;
-        if (info.isAbsolute()) {
+
+        // ADSK modification
+        // if name starts with  \\ or // , don't search it from shared files , because it takes too much time 
+        if (name.startsWith(QLatin1String("\\\\")) || name.startsWith(QLatin1String("//")))
+        {
             files.append(name);
-        } else {
-            // at this point the path should only have Qt path separators.
-            // This check is needed since we might be at the root directory
-            // and on Windows it already ends with slash.
-            QString path = rootPath();
+            continue;
+        }
+
+        // use absolute name to detect whether it is directory or file 
+        QString path=name;
+        QFileInfo info(path);
+
+        if(!info.isAbsolute())
+        {
+            path = rootPath();
             if (!path.endsWith(QLatin1Char('/')))
                 path += QLatin1Char('/');
             path += name;
-            files.append(path);
+            info.setFile(path);
         }
+
+        if (!defaultSuffix.isEmpty() && !info.isDir() && path.lastIndexOf(QLatin1Char('.')) == -1)
+        {
+            path +=QLatin1Char('.') + defaultSuffix;
+        }
+        files.append(path);
     }
     return files;
 }
@@ -2170,6 +2203,18 @@
         d->qFileDialogUi->fileNameEdit->blockSignals(block);
         return;
     }
+	
+	QRegExp wildcardRegExp(QString::fromLatin1(qt_file_dialog_wildcard_symbols));
+	if (lineEditText.contains(wildcardRegExp))
+	{
+		QRegExp re(lineEditText, Qt::CaseInsensitive, QRegExp::Wildcard);
+		if (re.isValid())
+		{
+			QStringList newNameFilters = qt_clean_filter_list(lineEditText);
+			d->model->setNameFilters(newNameFilters);
+			return;
+		}
+	}
 
     switch (d->fileMode) {
     case DirectoryOnly:
@@ -2585,7 +2630,17 @@
     QObject::connect(goToParent, SIGNAL(triggered()), q, SLOT(_q_navigateToParent()));
     q->addAction(goToParent);
 
-    renameAction = new QAction(q);
+	copyAction = new QAction(q);
+    copyAction->setEnabled(false);
+    copyAction->setObjectName(QLatin1String("qt_copy_action"));
+    QObject::connect(copyAction, SIGNAL(triggered()), q, SLOT(_q_copyCurrent()));
+
+    pasteAction = new QAction(q);
+    pasteAction->setEnabled(false);
+    pasteAction->setObjectName(QLatin1String("qt_paste_action"));
+    QObject::connect(pasteAction, SIGNAL(triggered()), q, SLOT(_q_pasteFromClipboard()));
+
+	renameAction = new QAction(q);
     renameAction->setEnabled(false);
     renameAction->setObjectName(QLatin1String("qt_rename_action"));
     QObject::connect(renameAction, SIGNAL(triggered()), q, SLOT(_q_renameCurrent()));
@@ -2761,12 +2816,23 @@
     if (index.isValid()) {
         // file context menu
         QFile::Permissions p(index.parent().data(QFileSystemModel::FilePermissions).toInt());
+		copyAction->setEnabled(p & QFile::ReadUser);
+		menu.addAction(copyAction);
         renameAction->setEnabled(p & QFile::WriteUser);
         menu.addAction(renameAction);
         deleteAction->setEnabled(p & QFile::WriteUser);
         menu.addAction(deleteAction);
         menu.addSeparator();
     }
+
+	QClipboard * clipboard = QApplication::clipboard();
+	const QMimeData *mimeData = clipboard->mimeData();
+	if (mimeData && mimeData->hasUrls())
+	{
+		pasteAction->setEnabled(true); 
+		menu.addAction(pasteAction);
+	}
+
     menu.addAction(showHiddenAction);
     if (qFileDialogUi->newFolderButton->isVisible()) {
         newFolderAction->setEnabled(qFileDialogUi->newFolderButton->isEnabled());
@@ -2779,6 +2845,52 @@
 /*!
     \internal
 */
+
+void QFileDialogPrivate::_q_copyCurrent()
+{
+    QModelIndex index = qFileDialogUi->listView->currentIndex();
+
+	QModelIndexList indexList;
+	indexList << index;
+
+	QClipboard * clipboard = QApplication::clipboard();
+	clipboard->setMimeData(model->mimeData(indexList));
+}
+
+void QFileDialogPrivate::_q_pasteFromClipboard()
+{
+	QClipboard * clipboard = QApplication::clipboard();
+	const QMimeData *mimeData = clipboard->mimeData();
+
+	if (mimeData && mimeData->hasUrls()) 
+	{
+		QDir currentDir = model->rootDirectory();
+
+		QUrl url;
+		QList<QUrl> urlList = mimeData->urls();
+		foreach (url, urlList)
+		{
+			QFileInfo toCopyInfo(url.toLocalFile());
+			if (toCopyInfo.isFile() && toCopyInfo.isReadable())
+			{
+				int i = 1;
+				QString fileName = toCopyInfo.fileName();
+				QFileInfo toPasteInfo(currentDir, fileName);
+				while (toPasteInfo.exists())
+				{
+					QString generatedName(toCopyInfo.baseName() + QLatin1String("_") + QString::number(i) + 
+											QLatin1String(".") + toCopyInfo.completeSuffix());
+
+					toPasteInfo.setFile(currentDir, generatedName);
+					i++;
+				}
+
+				QFile::copy(toCopyInfo.absoluteFilePath(), toPasteInfo.absoluteFilePath());
+			}
+		}
+	}
+}
+
 void QFileDialogPrivate::_q_renameCurrent()
 {
     Q_Q(QFileDialog);
@@ -3053,17 +3165,6 @@
     }
 }
 
-// Makes a list of filters from a normal filter string "Image Files (*.png *.jpg)"
-QStringList qt_clean_filter_list(const QString &filter)
-{
-    QRegExp regexp(QString::fromLatin1(qt_file_dialog_filter_reg_exp));
-    QString f = filter;
-    int i = regexp.indexIn(f);
-    if (i >= 0)
-        f = regexp.cap(2);
-    return f.split(QLatin1Char(' '), QString::SkipEmptyParts);
-}
-
 /*!
     \internal
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/dialogs/qfiledialog.h qt-adsk-4.8.6/src/gui/dialogs/qfiledialog.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/dialogs/qfiledialog.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/dialogs/qfiledialog.h	2014-05-06 04:23:09.000000000 +0800
@@ -297,6 +297,8 @@
     Q_PRIVATE_SLOT(d_func(), void _q_showListView())
     Q_PRIVATE_SLOT(d_func(), void _q_showDetailsView())
     Q_PRIVATE_SLOT(d_func(), void _q_showContextMenu(const QPoint &))
+	Q_PRIVATE_SLOT(d_func(), void _q_copyCurrent())
+	Q_PRIVATE_SLOT(d_func(), void _q_pasteFromClipboard())
     Q_PRIVATE_SLOT(d_func(), void _q_renameCurrent())
     Q_PRIVATE_SLOT(d_func(), void _q_deleteCurrent())
     Q_PRIVATE_SLOT(d_func(), void _q_showHidden())
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/dialogs/qfiledialog_p.h qt-adsk-4.8.6/src/gui/dialogs/qfiledialog_p.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/dialogs/qfiledialog_p.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/dialogs/qfiledialog_p.h	2014-05-06 04:23:09.000000000 +0800
@@ -210,6 +210,8 @@
     void _q_showListView();
     void _q_showDetailsView();
     void _q_showContextMenu(const QPoint &position);
+	void _q_copyCurrent();
+    void _q_pasteFromClipboard();
     void _q_renameCurrent();
     void _q_deleteCurrent();
     void _q_showHidden();
@@ -247,6 +249,8 @@
     QStringList currentHistory;
     int currentHistoryLocation;
 
+	QAction *copyAction;
+    QAction *pasteAction;
     QAction *renameAction;
     QAction *deleteAction;
     QAction *showHiddenAction;
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/image/qicon.cpp qt-adsk-4.8.6/src/gui/image/qicon.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/image/qicon.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/image/qicon.cpp	2014-12-17 10:12:14.000000000 +0800
@@ -115,6 +115,35 @@
     qtIconCache()->clear();
 }
 
+/*! \internal
+ 
+    Returns the effective device pixel ratio.
+    New public API should set a QWindow pointer, and will get the
+    the devicePixelRatio for that window.
+
+    Old API won't have a window pointer and qApp->devicePixelRatio()
+    will be used, if Qt::AA_UseHighDpiPixmaps is set to prevent
+    breaking old code.
+*/
+static qreal qt_effective_device_pixel_ratio()
+{
+    bool enableHighdpi = !qgetenv("QT_HIGHDPI_AWARE").isEmpty();
+    static bool hasWarned = false;
+    if (!hasWarned && enableHighdpi) {
+        qWarning("QT_HIGHDPI_AWARE is deprecated, use qApp->setAttribute(Qt::AA_UseHighDpiPixmaps) instead.");
+        hasWarned = true;
+    }
+
+#ifdef Q_WS_MAC
+    if (enableHighdpi || qApp->testAttribute(Qt::AA_UseHighDpiPixmaps)) {
+        extern CGFloat qt_mac_get_scalefactor(QWidget *);
+        return qt_mac_get_scalefactor(0);
+    }
+#endif
+
+    return qreal(1.0);
+}
+                             
 QIconPrivate::QIconPrivate()
     : engine(0), ref(1),
     serialNum(serialNumCounter.fetchAndAddRelaxed(1)),
@@ -139,11 +168,8 @@
 
 void QPixmapIconEngine::paint(QPainter *painter, const QRect &rect, QIcon::Mode mode, QIcon::State state)
 {
-    QSize pixmapSize = rect.size();
-#if defined(Q_WS_MAC)
-    pixmapSize *= qt_mac_get_scalefactor();
-#endif
-    painter->drawPixmap(rect, pixmap(pixmapSize, mode, state));
+    QSize targetRectSize = rect.size();
+    painter->drawPixmap(rect, pixmap(targetRectSize, mode, state));
 }
 
 static inline int area(const QSize &s) { return s.width() * s.height(); }
@@ -238,9 +264,14 @@
     return pe;
 }
 
-QPixmap QPixmapIconEngine::pixmap(const QSize &size, QIcon::Mode mode, QIcon::State state)
+QPixmap QPixmapIconEngine::pixmap(const QSize &inSize, QIcon::Mode mode, QIcon::State state)
 {
     QPixmap pm;
+    QSize size = inSize;
+#ifdef Q_WS_MAC
+    size *= qt_effective_device_pixel_ratio();
+#endif
+    
     QPixmapIconEngineEntry *pe = bestMatch(size, mode, state, false);
     if (pe)
         pm = pe->pixmap;
@@ -294,11 +325,20 @@
         }
         QPixmapCache::insert(key % HexString<uint>(mode), pm);
     }
+    
+#ifdef Q_WS_MAC
+    if (qt_effective_device_pixel_ratio() > 1 && pm.size().width() > inSize.width()) // detect high-dpi pixmap
+        pm.setDevicePixelRatio(qMax(qreal(1.0), qreal(pm.size().width()) / qreal(inSize.width())));
+#endif
     return pm;
 }
 
-QSize QPixmapIconEngine::actualSize(const QSize &size, QIcon::Mode mode, QIcon::State state)
+QSize QPixmapIconEngine::actualSize(const QSize &inSize, QIcon::Mode mode, QIcon::State state)
 {
+    QSize size = inSize;
+#ifdef Q_WS_MAC
+    size *= qt_effective_device_pixel_ratio();
+#endif
     QSize actualSize;
     if (QPixmapIconEngineEntry *pe = bestMatch(size, mode, state, true))
         actualSize = pe->size;
@@ -343,6 +383,9 @@
                 }
                 if (pe->size == QSize() && pe->pixmap.isNull()) {
                     pe->pixmap = QPixmap(pe->fileName);
+                    // Reset the devicePixelRatio. The pixmap may be loaded from a @2x file,
+                    // but be used as a 1x pixmap by QIcon.
+                    pe->pixmap.setDevicePixelRatio(1.0);
                     pe->size = pe->pixmap.size();
                 }
                 if(pe->size == size) {
@@ -672,16 +715,23 @@
 
 /*!
   Returns a pixmap with the requested \a size, \a mode, and \a
-  state, generating one if necessary. The pixmap might be smaller than
-  requested, but never larger.
+  state, generating one if necessary.
+ 
+  This function has two modes. By default, the returned pixmap might
+  be smaller than requested, but never larger. Setting the Qt::AA_UseHighDpiPixmaps
+  application attributes enables support for high-dpi pixmaps and this function
+  may then return pixmaps that are larger than the requested size,
+  with a corresponding dpi scale factor.
 
-  \sa actualSize(), paint()
+  \sa actualSize(), paint(), QPixmap::devicePixelRatio()
 */
 QPixmap QIcon::pixmap(const QSize &size, Mode mode, State state) const
 {
     if (!d)
         return QPixmap();
-    return d->engine->pixmap(size, mode, state);
+    
+    QPixmap pm = d->engine->pixmap(size, mode, state);
+    return pm;
 }
 
 /*!
@@ -691,6 +741,10 @@
 
     Returns a pixmap of size QSize(\a w, \a h). The pixmap might be smaller than
     requested, but never larger.
+ 
+    Setting the Qt::AA_UseHighDpiPixmaps application attribute enables this
+    function to return pixmaps that are larger than the requested size. Such
+    images will have a devicePixelRation larger than 1.
 */
 
 /*!
@@ -700,12 +754,20 @@
 
     Returns a pixmap of size QSize(\a extent, \a extent). The pixmap might be smaller
     than requested, but never larger.
+ 
+    Setting the Qt::AA_UseHighDpiPixmaps application attribute enables this
+    function to return pixmaps that are larger than the requested size. Such
+    images will have a devicePixelRation larger than 1.
 */
 
-/*!  Returns the actual size of the icon for the requested \a size, \a
+/*!
+  Returns the actual size of the icon for the requested \a size, \a
   mode, and \a state. The result might be smaller than requested, but
   never larger.
 
+  Setting the Qt::AA_UseHighDpiPixmaps application attributes enables this
+  function to return sizes that are larger than the requested size.
+ 
   \sa pixmap(), paint()
 */
 QSize QIcon::actualSize(const QSize &size, Mode mode, State state) const
@@ -726,7 +788,16 @@
 {
     if (!d || !painter)
         return;
-    QRect alignedRect = QStyle::alignedRect(painter->layoutDirection(), alignment, d->engine->actualSize(rect.size(), mode, state), rect);
+    
+    QSize actualSize = d->engine->actualSize(rect.size(), mode, state);
+#ifdef Q_WS_MAC
+    // High-dpi pixmaps do not need alignment. Clamp actualSize to the
+    // passed in destination rect.
+    actualSize.setWidth(qMin(rect.width(), actualSize.width()));
+    actualSize.setHeight(qMin(rect.width(), actualSize.height()));
+#endif
+    QRect alignedRect = QStyle::alignedRect(painter->layoutDirection(), alignment, actualSize, rect);
+    
     d->engine->paint(painter, alignedRect, mode, state);
 }
 
@@ -1161,7 +1232,8 @@
     int i = 0;
     if (which == QIcon::Large)
         i = 1;
-    return QSize(widths[i], heights[i]);
+    return QSize(widths[i] * qt_effective_device_pixel_ratio(),
+                heights[i] * qt_effective_device_pixel_ratio());
 }
 
 /*!
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/image/qimage.cpp qt-adsk-4.8.6/src/gui/image/qimage.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/image/qimage.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/image/qimage.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -127,7 +127,7 @@
 QBasicAtomicInt qimage_serial_number = Q_BASIC_ATOMIC_INITIALIZER(1);
 
 QImageData::QImageData()
-    : ref(0), width(0), height(0), depth(0), nbytes(0), data(0),
+    : ref(0), width(0), height(0), depth(0), nbytes(0), devicePixelRatio(1.0), data(0),
 #ifdef QT3_SUPPORT
       jumptable(0),
 #endif
@@ -1500,6 +1500,7 @@
 
     image.d->dpmx = dotsPerMeterX();
     image.d->dpmy = dotsPerMeterY();
+    image.d->devicePixelRatio = devicePixelRatio();
     image.d->offset = offset();
     image.d->has_alpha_clut = d->has_alpha_clut;
 #ifndef QT_NO_IMAGE_TEXT
@@ -1728,6 +1729,48 @@
     return d ? d->colortable : QVector<QRgb>();
 }
 
+/*!
+    Returns the current dpi scale factor for the image.
+ 
+    Common values for the scale factor is 1.0(the default),
+    and 2.0 for images intended for display on High DPI displayes.
+ 
+    Use this function when calculating layouts based on the
+    image size. Layout size is pixel size divided by the scale
+    factor.
+ 
+    \sa setScaleFactor()
+*/
+qreal QImage::devicePixelRatio() const
+{
+    if (!d)
+        return qreal(1.0);
+    return d->devicePixelRatio;
+}
+
+/*!
+    Sets the dpi scale factor for the image.
+ 
+    The scale factor is typically set to 2.0 when producing
+    images for high-dpi displays. This informs layout code
+    paths in Qt which use the image size that the image is
+    a high-resolution image. and not a large image.
+ 
+    Qt supports using the "@2x" suffix when loading
+    images from files. Loading "myicon@2x.png" will result
+    in an image with a 2x scale factor.
+ 
+    Setting the scale factor will also change the dpi information
+    returned by QPaintDevice::metric(): Physical dpi will logical dpi
+    multiplied by the scale factor.
+ 
+    \sa scaleFactor()
+*/
+void QImage::setDevicePixelRatio(qreal scale)
+{
+    detach();
+    d->devicePixelRatio = scale;
+}
 
 /*!
     \obsolete
@@ -3894,6 +3937,7 @@
 
         image.setDotsPerMeterY(dotsPerMeterY());
         image.setDotsPerMeterX(dotsPerMeterX());
+        image.setDevicePixelRatio(devicePixelRatio());
 
 #if !defined(QT_NO_IMAGE_TEXT)
         image.d->text = d->text;
@@ -3944,6 +3988,7 @@
     QImage dest(src.size(), format);
     QIMAGE_SANITYCHECK_MEMORY(dest);
     dest.setColorTable(clut);
+    dest.setDevicePixelRatio(src.devicePixelRatio());
 
 #if !defined(QT_NO_IMAGE_TEXT)
     QString textsKeys = src.text();
@@ -4305,8 +4350,8 @@
 
     image.setDotsPerMeterX(dotsPerMeterX());
     image.setDotsPerMeterY(dotsPerMeterY());
-
     image.d->colortable = d->colortable;
+    image.setDevicePixelRatio(devicePixelRatio());
     return image;
 }
 #endif
@@ -4802,6 +4847,7 @@
 
     result.d->colortable = d->colortable;
     result.d->has_alpha_clut = d->has_alpha_clut;
+    result.d->devicePixelRatio = d->devicePixelRatio;
 
     if (depth() == 1)
         w = (w+7)/8;
@@ -5845,11 +5891,11 @@
         break;
 
     case PdmPhysicalDpiX:
-        return qRound(d->dpmx * 0.0254);
+        return qRound(d->dpmx * 0.0254 * d->devicePixelRatio);
         break;
 
     case PdmPhysicalDpiY:
-        return qRound(d->dpmy * 0.0254);
+        return qRound(d->dpmy * 0.0254 * d->devicePixelRatio);
         break;
 
     default:
@@ -6642,6 +6688,7 @@
 
     dImage.d->dpmx = dotsPerMeterX();
     dImage.d->dpmy = dotsPerMeterY();
+    dImage.d->devicePixelRatio = devicePixelRatio();
 
     switch (bpp) {
         // initizialize the data
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/image/qimage.h qt-adsk-4.8.6/src/gui/image/qimage.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/image/qimage.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/image/qimage.h	2014-05-06 04:23:09.000000000 +0800
@@ -215,6 +215,9 @@
     QVector<QRgb> colorTable() const;
     void setColorTable(const QVector<QRgb> colors);
 
+    qreal devicePixelRatio() const;
+    void setDevicePixelRatio(qreal scale);
+    
     void fill(uint pixel);
     void fill(const QColor &color);
     void fill(Qt::GlobalColor color);
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/image/qimage_p.h qt-adsk-4.8.6/src/gui/image/qimage_p.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/image/qimage_p.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/image/qimage_p.h	2014-05-06 04:23:09.000000000 +0800
@@ -77,6 +77,7 @@
     int height;
     int depth;
     int nbytes;               // number of bytes data
+    qreal devicePixelRatio;
     QVector<QRgb> colortable;
     uchar *data;
 #ifdef QT3_SUPPORT
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/image/qimagepixmapcleanuphooks.cpp qt-adsk-4.8.6/src/gui/image/qimagepixmapcleanuphooks.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/image/qimagepixmapcleanuphooks.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/image/qimagepixmapcleanuphooks.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -125,8 +125,14 @@
 
 void QImagePixmapCleanupHooks::executeImageHooks(qint64 key)
 {
-    for (int i = 0; i < qt_image_and_pixmap_cleanup_hooks()->imageHooks.count(); ++i)
-        qt_image_and_pixmap_cleanup_hooks()->imageHooks[i](key);
+    QImagePixmapCleanupHooks *h = qt_image_and_pixmap_cleanup_hooks();
+    // the global destructor for the pixmap and image hooks might have
+    // been called already if the app is "leaking" global
+    // pixmaps/images
+    if (!h)
+        return;
+    for (int i = 0; i < h->imageHooks.count(); ++i)
+        h->imageHooks[i](key);
 
     if (qt_image_cleanup_hook_64)
         qt_image_cleanup_hook_64(key);
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/image/qimagereader.cpp qt-adsk-4.8.6/src/gui/image/qimagereader.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/image/qimagereader.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/image/qimagereader.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -128,6 +128,7 @@
 #include <qsize.h>
 #include <qcolor.h>
 #include <qvariant.h>
+#include <qdebug.h>
 
 // factory loader
 #include <qcoreapplication.h>
@@ -1263,6 +1264,10 @@
         }
     }
 
+    // successful read; check for "@2x" suffix and set scale factor
+    if (QFileInfo(fileName()).baseName().endsWith("@2x")) {
+        image->setDevicePixelRatio(2.0);
+    }
     return true;
 }
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/image/qnativeimage.cpp qt-adsk-4.8.6/src/gui/image/qnativeimage.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/image/qnativeimage.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/image/qnativeimage.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -117,11 +117,25 @@
     Q_ASSERT(bitmap);
     Q_ASSERT(bits);
 
-    null_bitmap = (HBITMAP)SelectObject(hdc, bitmap);
-    image = QImage(bits, width, height, format);
-
-    Q_ASSERT(image.paintEngine()->type() == QPaintEngine::Raster);
-    static_cast<QRasterPaintEngine *>(image.paintEngine())->setDC(hdc);
+    if (bitmap && bits)
+    {
+        null_bitmap = (HBITMAP)SelectObject(hdc, bitmap);
+        image = QImage(bits, width, height, format);
+        
+        Q_ASSERT(image.paintEngine()->type() == QPaintEngine::Raster);
+        static_cast<QRasterPaintEngine *>(image.paintEngine())->setDC(hdc);
+    }
+    //Add code to handle fail case of CreateDIBSection.
+    else
+    {
+        if (hdc)
+        {
+            if (null_bitmap)
+                SelectObject(hdc, null_bitmap);
+            DeleteDC(hdc);
+            hdc = 0;
+        }
+    }
 
 #ifndef Q_WS_WINCE
     GdiFlush();
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmap.cpp qt-adsk-4.8.6/src/gui/image/qpixmap.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmap.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/image/qpixmap.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -779,6 +779,49 @@
     data->setMask(mask);
 }
 
+/*!
+    Returns the current dpi scale factor for the pixmap.
+ 
+    common values for the scale factor is 1.0(the default),
+    and 2.0 for images intended for display on High DPI displays.
+ 
+    Use this function when calculating layouts based on the
+    pixmap size. Layout size is pixel size divided by the scale
+    factor.
+ 
+    \sa setScaleFactor(), QIcon::pixmap()
+*/
+qreal QPixmap::devicePixelRatio() const
+{
+    if (!data)
+        return qreal(1.0);
+    return data->devicePixelRatio;
+}
+
+/*!
+    Sets the dpi scale factor for the pixmap.
+ 
+    The scale factor is typically set to 2.0 when producing
+    pixmap for high-dpi displays. This informs ayout code
+    paths in Qt which use the image size that the image is
+    a high-resolution image, and not a large image.
+ 
+    Qt supports using the "@2x" suffix when loading
+    pixmap from files. Loading "myicon@2x.png" will result
+    in an image with a 2x scale factor.
+ 
+    Setting the scale factor will also change the dpi information
+    returned by QPaintDevice::metric(): Physical dpi is logical dpi
+    multiplied by the scale factor.
+ 
+    \sa scaleFactor();
+*/
+void QPixmap::setDevicePixelRatio(qreal scaleFactor)
+{
+    detach();
+    data->devicePixelRatio = scaleFactor;
+}
+
 #ifndef QT_NO_IMAGE_HEURISTIC_MASK
 /*!
     Creates and returns a heuristic mask for this pixmap.
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmapdata.cpp qt-adsk-4.8.6/src/gui/image/qpixmapdata.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmapdata.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/image/qpixmapdata.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -70,6 +70,7 @@
       h(0),
       d(0),
       is_null(true),
+      devicePixelRatio(1.0),
       ref(0),
       detach_no(0),
       type(pixelType),
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmapdata_p.h qt-adsk-4.8.6/src/gui/image/qpixmapdata_p.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmapdata_p.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/image/qpixmapdata_p.h	2014-05-06 04:23:09.000000000 +0800
@@ -155,6 +155,7 @@
     int h;
     int d;
     bool is_null;
+    qreal devicePixelRatio;
 
 private:
     friend class QPixmap;
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmap.h qt-adsk-4.8.6/src/gui/image/qpixmap.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmap.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/image/qpixmap.h	2014-05-06 04:23:09.000000000 +0800
@@ -108,6 +108,9 @@
 
     QBitmap mask() const;
     void setMask(const QBitmap &);
+    
+    qreal devicePixelRatio() const;
+    void setDevicePixelRatio(qreal scaleFactor);
 
 #ifdef QT_DEPRECATED
     QT_DEPRECATED QPixmap alphaChannel() const;
@@ -271,6 +274,7 @@
     friend IconRef qt_mac_create_iconref(const QPixmap&);
     friend quint32 *qt_mac_pixmap_get_base(const QPixmap*);
     friend int qt_mac_pixmap_get_bytes_per_line(const QPixmap*);
+    friend void qt_mac_set_pixmap_scale(QPixmap *pixmap, int scale);
 #endif
     friend class QPixmapData;
     friend class QX11PixmapData;
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmap_mac.cpp qt-adsk-4.8.6/src/gui/image/qpixmap_mac.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmap_mac.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/image/qpixmap_mac.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -240,6 +240,7 @@
     h = img.height();
     is_null = (w <= 0 || h <= 0);
     d = (pixelType() == BitmapType ? 1 : img.depth());
+    devicePixelRatio = img.devicePixelRatio();
 
     QImage image = img;
     int dd = QPixmap::defaultDepth();
@@ -391,6 +392,7 @@
         // exit if image was not created (out of memory)
     if (image.isNull())
         return image;
+    image.setDevicePixelRatio(devicePixelRatio);
     quint32 *sptr = pixels, *srow;
     const uint sbpr = bytesPerRow;
     if (format == QImage::Format_MonoLSB) {
@@ -487,6 +489,9 @@
 
 int QMacPixmapData::metric(QPaintDevice::PaintDeviceMetric theMetric) const
 {
+    extern float qt_mac_defaultDpi_x(); //qpaintdevice_mac.cpps
+    extern float qt_mac_defaultDpi_y(); //qpaintdevice_mac.cpp
+    
     switch (theMetric) {
     case QPaintDevice::PdmWidth:
         return w;
@@ -499,14 +504,14 @@
     case QPaintDevice::PdmNumColors:
         return 1 << d;
     case QPaintDevice::PdmDpiX:
-    case QPaintDevice::PdmPhysicalDpiX: {
-        extern float qt_mac_defaultDpi_x(); //qpaintdevice_mac.cpp
         return int(qt_mac_defaultDpi_x());
+    case QPaintDevice::PdmPhysicalDpiX: {
+        return int(qt_mac_defaultDpi_x() * devicePixelRatio);
     }
     case QPaintDevice::PdmDpiY:
-    case QPaintDevice::PdmPhysicalDpiY: {
-        extern float qt_mac_defaultDpi_y(); //qpaintdevice_mac.cpp
         return int(qt_mac_defaultDpi_y());
+    case QPaintDevice::PdmPhysicalDpiY: {
+        return int(qt_mac_defaultDpi_y() * devicePixelRatio);
     }
     case QPaintDevice::PdmDepth:
         return d;
@@ -890,7 +895,7 @@
     const CGRect cgRect = CGRectMake(rect.x(), rect.y(), rect.width(), rect.height());
     const CGDisplayErr err = CGGetDisplaysWithRect(cgRect, maxDisplays, displays, &displayCount);
 
-    extern CGFloat qt_mac_get_scalefactor();
+    //extern CGFloat qt_mac_get_scalefactor(QWidget*);
     QRect scaledRect = QRect(rect.topLeft(), rect.size() * qt_mac_get_scalefactor());
 
     if (err && displayCount == 0)
@@ -1200,6 +1205,7 @@
     has_alpha = macData->has_alpha;
     has_mask = macData->has_mask;
     uninit = false;
+    devicePixelRatio = macData->devicePixelRatio;
 
     const int x = rect.x();
     const int y = rect.y();
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmap_mac_p.h qt-adsk-4.8.6/src/gui/image/qpixmap_mac_p.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmap_mac_p.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/image/qpixmap_mac_p.h	2014-05-06 04:23:09.000000000 +0800
@@ -126,6 +126,7 @@
     friend void qt_mac_cgimage_data_free(void *, const void*, size_t);
     friend IconRef qt_mac_create_iconref(const QPixmap&);
     friend CGContextRef qt_mac_cg_context(const QPaintDevice*);
+    friend void qt_mac_set_pixmap_scale(QPixmap *pixmap, int devicePixelRatio);
     friend QColor qcolorForThemeTextColor(ThemeTextColor themeColor);
 };
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/itemviews/qitemdelegate.cpp qt-adsk-4.8.6/src/gui/itemviews/qitemdelegate.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/itemviews/qitemdelegate.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/itemviews/qitemdelegate.cpp	2014-12-17 10:12:50.000000000 +0800
@@ -66,6 +66,9 @@
 #include <private/qobject_p.h>
 #include <private/qdnd_p.h>
 #include <private/qtextengine_p.h>
+#ifdef Q_WS_MAC
+#include <private/qt_cocoa_helpers_mac_p.h>
+#endif
 #include <qdebug.h>
 #include <qlocale.h>
 #include <qdialog.h>
@@ -443,8 +446,12 @@
             d->tmp.icon = qvariant_cast<QIcon>(value);
             d->tmp.mode = d->iconMode(option.state);
             d->tmp.state = d->iconState(option.state);
-            const QSize size = d->tmp.icon.actualSize(option.decorationSize,
+            QSize size = d->tmp.icon.actualSize(option.decorationSize,
                                                       d->tmp.mode, d->tmp.state);
+#ifdef Q_WS_MAC
+            if ((qt_mac_get_scalefactor(0) > 1) && (size.width() > option.decorationSize.width())) // detect high-dpi pixmap
+                size = size / (int)qt_mac_get_scalefactor(0);
+#endif
             decorationRect = QRect(QPoint(0, 0), size);
         } else {
             d->tmp.icon = QIcon();
@@ -1084,15 +1091,21 @@
         switch (value.type()) {
         case QVariant::Invalid:
             break;
-        case QVariant::Pixmap:
-            return QRect(QPoint(0, 0), qvariant_cast<QPixmap>(value).size());
-        case QVariant::Image:
-            return QRect(QPoint(0, 0), qvariant_cast<QImage>(value).size());
+        case QVariant::Pixmap: {
+            const QPixmap &pixmap = qvariant_cast<QPixmap>(value);
+            return QRect(QPoint(0, 0), pixmap.size() / pixmap.devicePixelRatio()); }
+        case QVariant::Image: {
+            const QImage &image = qvariant_cast<QImage>(value);
+            return QRect(QPoint(0, 0), image.size() / image.devicePixelRatio()); }
         case QVariant::Icon: {
             QIcon::Mode mode = d->iconMode(option.state);
             QIcon::State state = d->iconState(option.state);
             QIcon icon = qvariant_cast<QIcon>(value);
             QSize size = icon.actualSize(option.decorationSize, mode, state);
+#ifdef Q_WS_MAC
+            if ((qt_mac_get_scalefactor(0) > 1) && (size.width() > option.decorationSize.width())) // detect high-dpi pixmap
+                size = size / (int)qt_mac_get_scalefactor(0);
+#endif
             return QRect(QPoint(0, 0), size); }
         case QVariant::Color:
             return QRect(QPoint(0, 0), option.decorationSize);
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/itemviews/qstyleditemdelegate.cpp qt-adsk-4.8.6/src/gui/itemviews/qstyleditemdelegate.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/itemviews/qstyleditemdelegate.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/itemviews/qstyleditemdelegate.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -356,7 +356,9 @@
                 else
                     mode = QIcon::Normal;
                 QIcon::State state = option->state & QStyle::State_Open ? QIcon::On : QIcon::Off;
-                v4->decorationSize = v4->icon.actualSize(option->decorationSize, mode, state);
+                QSize actualSize = v4->icon.actualSize(option->decorationSize, mode, state);
+                v4->decorationSize = QSize(qMin(v4->decorationSize.width(), actualSize.width()), qMin(v4->decorationSize.height(), actualSize.height()));
+                
                 break;
             }
             case QVariant::Color: {
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qapplication.cpp qt-adsk-4.8.6/src/gui/kernel/qapplication.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qapplication.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qapplication.cpp	2014-07-22 17:44:42.000000000 +0800
@@ -178,6 +178,8 @@
 bool QApplicationPrivate::autoSipEnabled = true;
 #endif
 
+int QApplicationPrivate::customDpiOverride = -1;
+
 QApplicationPrivate::QApplicationPrivate(int &argc, char **argv, QApplication::Type type, int flags)
     : QCoreApplicationPrivate(argc, argv, flags)
 {
@@ -215,6 +217,9 @@
     ignore_cursor = 0;
 #endif
 
+	//ADSK: create the namedObjects hash
+	QObjectPrivate::namedObjects = new QMultiHash<QString, QObject*>;
+
     if (!self)
         self = this;
 }
@@ -1018,6 +1023,8 @@
 #endif //QT_AUTO_MAXIMIZE_THRESHOLD
 #endif //Q_WS_WINCE
 
+	customDpiOverride = -1;
+
     // Set up which span functions should be used in raster engine...
     qInitDrawhelperAsm();
     // and QImage conversion functions
@@ -1132,6 +1139,9 @@
                 w->destroy(true, true);
         }
         delete mySet;
+		//ADSK: clean up hash
+        delete QObjectPrivate::namedObjects;
+        QObjectPrivate::namedObjects = 0;
     }
 
     delete qt_desktopWidget;
@@ -1382,6 +1392,16 @@
     The default is platform dependent.
 */
 
+void QApplication::setCustomDpiOverride(const int dpi)
+{
+	QApplicationPrivate::customDpiOverride = dpi;
+}
+
+int QApplication::customDpiOverride() const
+{
+	return QApplicationPrivate::customDpiOverride;
+}
+	 	 	
 #ifdef Q_WS_WINCE
 void QApplication::setAutoMaximizeThreshold(const int threshold)
 {
@@ -2137,6 +2157,18 @@
 }
 
 /*!
+    Returns the hash of named Objects. Might be NULL.
+  
+    \sa allWidgets()
+*/
+QMultiHash<QString,QObject*>* QApplication::namedObjects()
+{
+    return QObjectPrivate::namedObjects;
+}
+
+
+
+/*!
     Returns a list of the top-level widgets (windows) in the application.
 
     \note Some of the top-level widgets may be hidden, for example a tooltip if
@@ -4550,6 +4582,10 @@
             widget->setAttribute(Qt::WA_UnderMouse, true);
         else if (e->type() == QEvent::Leave || e->type() == QEvent::DragLeave)
             widget->setAttribute(Qt::WA_UnderMouse, false);
+#if defined(Q_OS_MAC) || defined(Q_OS_WIN)
+        else if (e->type() == QEvent::Drop)
+            QApplicationPrivate::mouse_buttons &= ~(Qt::LeftButton | Qt::MidButton | Qt::RightButton);
+#endif
 #endif
 
         if (QLayout *layout=widget->d_func()->layout) {
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qapplication.h qt-adsk-4.8.6/src/gui/kernel/qapplication.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qapplication.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qapplication.h	2014-07-22 17:47:08.000000000 +0800
@@ -88,6 +88,9 @@
 class QSymbianEvent;
 #endif
 
+//ADSK:
+template <typename T, typename V> class QMultiHash;
+
 class QApplication;
 class QApplicationPrivate;
 #if defined(qApp)
@@ -118,7 +121,10 @@
     Q_PROPERTY(int autoMaximizeThreshold READ autoMaximizeThreshold WRITE setAutoMaximizeThreshold)
 #endif
     Q_PROPERTY(bool autoSipEnabled READ autoSipEnabled WRITE setAutoSipEnabled)
-
+    // This allows overwriting the current system dpi to provide a custom dpi scale.
+    // Please see dpiScaled() in qstylehelper.cpp for details.
+    Q_PROPERTY(int customDpiOverride READ customDpiOverride WRITE setCustomDpiOverride)
+    
 public:
     enum Type { Tty, GuiClient, GuiServer };
 
@@ -178,6 +184,9 @@
     static QWidgetList allWidgets();
     static QWidgetList topLevelWidgets();
 
+//ADSK: added
+    static QMultiHash<QString,QObject*>* namedObjects();
+
     static QDesktopWidget *desktop();
 
     static QWidget *activePopupWidget();
@@ -324,6 +333,8 @@
 #endif
     void setAutoSipEnabled(const bool enabled);
     bool autoSipEnabled() const;
+    void setCustomDpiOverride(const int dpi);
+    int customDpiOverride() const;
     static void closeAllWindows();
     static void aboutQt();
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qapplication_mac.mm qt-adsk-4.8.6/src/gui/kernel/qapplication_mac.mm
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qapplication_mac.mm	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qapplication_mac.mm	2014-05-06 04:23:09.000000000 +0800
@@ -922,6 +922,7 @@
     InstallEventLoopTimer(GetMainEventLoop(), 0, 0, request_activate_pending.timerUPP, 0, &request_activate_pending.timer);
 }
 
+#define ADSK_USE_RAW_EVENT
 
 /* menubars */
 #ifndef QT_MAC_USE_COCOA
@@ -2261,6 +2262,7 @@
 #endif
                 Qt::MouseButton buttonToSend = button;
                 static bool lastButtonTranslated = false;
+#if !defined(ADSK_USE_RAW_EVENT)
                 if(ekind == kEventMouseDown &&
                    button == Qt::LeftButton && (modifiers & Qt::MetaModifier)) {
                     buttonToSend = Qt::RightButton;
@@ -2269,6 +2271,7 @@
                     buttonToSend = Qt::RightButton;
                     lastButtonTranslated = false;
                 }
+#endif
                 QMouseEvent qme(etype, plocal, p, buttonToSend, buttons, modifiers);
                 QApplication::sendSpontaneousEvent(widget, &qme);
                 if(!qme.isAccepted() || inNonClientArea)
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qapplication_p.h qt-adsk-4.8.6/src/gui/kernel/qapplication_p.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qapplication_p.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qapplication_p.h	2014-07-22 17:34:14.000000000 +0800
@@ -305,6 +305,7 @@
     static int autoMaximizeThreshold;
 #endif
     static bool autoSipEnabled;
+    static int customDpiOverride;
     static QString desktopStyleKey();
 
     static QGraphicsSystem *graphicsSystem()
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qapplication_win.cpp qt-adsk-4.8.6/src/gui/kernel/qapplication_win.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qapplication_win.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qapplication_win.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -3777,6 +3777,37 @@
 }
 #endif // QT_NO_TABLETEVENT
 
+// Adsk function to determine if running on Win7/Vista with Aero off
+
+typedef HRESULT (WINAPI *PtrDwmIsCompositionEnabled)(BOOL* pfEnabled);
+static PtrDwmIsCompositionEnabled pDwmIsCompositionEnabled = NULL;
+
+static bool adsk_DwmIsCompositionEnabled()
+{
+    static bool first = true;
+    bool AeroOn = false;        // Assume Aero off
+
+    if (first) {
+        // If we can load Dwm and compositing is enabled, then it's Aero
+        // do this part only once
+        if (NULL == pDwmIsCompositionEnabled) {
+            QSystemLibrary dwmLib(QLatin1String("dwmapi")); // object unloaded on process end
+            pDwmIsCompositionEnabled =
+             (PtrDwmIsCompositionEnabled)dwmLib.resolve("DwmIsCompositionEnabled");
+        }
+        first = false;
+     }
+
+    // Now check to see if Aero is On
+    if (pDwmIsCompositionEnabled) {
+        BOOL bEnabled;
+        HRESULT hr = pDwmIsCompositionEnabled(&bEnabled);
+        AeroOn = (S_OK == hr) && bEnabled;
+    }
+
+    // We know the current statue
+    return AeroOn;
+}
 
 //
 // Paint event translation
@@ -3798,8 +3829,10 @@
 
     setAttribute(Qt::WA_PendingUpdate, false);
 
-    if (d_func()->isGLWidget) {
-        if (d_func()->usesDoubleBufferedGLContext)
+    if (QSysInfo::windowsVersion() >= QSysInfo::WV_VISTA &&
+		!adsk_DwmIsCompositionEnabled() &&
+		(inherits("QmayaGLWidget") || inherits("QmayaDXWidget") || d_func()->isGLWidget) ) {
+        //if (d_func()->usesDoubleBufferedGLContext)
             InvalidateRect(internalWinId(), 0, false);
     } else {
         const QRegion dirtyInBackingStore(qt_dirtyRegion(this));
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qcocoaview_mac.mm qt-adsk-4.8.6/src/gui/kernel/qcocoaview_mac.mm
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qcocoaview_mac.mm	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qcocoaview_mac.mm	2014-05-06 04:23:09.000000000 +0800
@@ -1284,13 +1284,16 @@
         return Qt::IgnoreAction;
     /* At the moment it seems clear that Mac OS X does not want to drag with a non-left button
      so we just bail early to prevent it */
+#if 0
+    // ADSK: Commented out as this does seem to work, and we expect it to
     if (!(GetCurrentEventButtonState() & kEventMouseButtonPrimary)) {
         o->setMimeData(0);
         o->deleteLater();
         return Qt::IgnoreAction;
     }
+#endif
 
-    if(object) {
+	if(object) {
         dragPrivate()->source->removeEventFilter(this);
         cancel();
         beingCancelled = false;
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qcursor_mac.mm qt-adsk-4.8.6/src/gui/kernel/qcursor_mac.mm
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qcursor_mac.mm	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qcursor_mac.mm	2014-05-06 04:23:09.000000000 +0800
@@ -181,8 +181,11 @@
             if (w && !w->testAttribute(Qt::WA_SetCursor))
                 w = 0;
 
-            lastWidgetUnderMouse = widgetUnderMouse;
-            lastMouseCursorWidget = w;
+            // ADSK  this assignment causes problems - deleted window/widgets
+            // crashes later in  qt_mac_set_cursor()
+            // mostly for optimiztion, disable for now
+            //lastWidgetUnderMouse = widgetUnderMouse;
+            //lastMouseCursorWidget = w;
         }
     }
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qdnd_mac.mm qt-adsk-4.8.6/src/gui/kernel/qdnd_mac.mm
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qdnd_mac.mm	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qdnd_mac.mm	2014-05-06 04:23:09.000000000 +0800
@@ -538,8 +538,9 @@
         return Qt::IgnoreAction;
     /* At the moment it seems clear that Mac OS X does not want to drag with a non-left button
        so we just bail early to prevent it */
-    if(!(GetCurrentEventButtonState() & kEventMouseButtonPrimary))
-        return Qt::IgnoreAction;
+// ADSK: Commented out
+//    if(!(GetCurrentEventButtonState() & kEventMouseButtonPrimary))
+//        return Qt::IgnoreAction;
 
     if(object) {
         dragPrivate()->source->removeEventFilter(this);
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qt_cocoa_helpers_mac.mm qt-adsk-4.8.6/src/gui/kernel/qt_cocoa_helpers_mac.mm
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qt_cocoa_helpers_mac.mm	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qt_cocoa_helpers_mac.mm	2014-05-06 04:23:09.000000000 +0800
@@ -91,6 +91,8 @@
 #include <private/qwidget_p.h>
 #include <private/qcocoawindow_mac_p.h>
 
+#define ADSK_USE_RAW_EVENT
+
 QT_BEGIN_NAMESPACE
 
 #ifdef QT_MAC_USE_COCOA
@@ -998,15 +1000,19 @@
         if (clickCount % 2 == 0)
             eventType = (!fakeMouseEvents) ? QEvent::NonClientAreaMouseButtonDblClick
                                            : QEvent::MouseButtonDblClick;
+#if !defined(ADSK_USE_RAW_EVENT)
         if (button == Qt::LeftButton && (keyMods & Qt::MetaModifier)) {
             button = Qt::RightButton;
             qt_leftButtonIsRightButton = true;
         }
+#endif
     } else if (eventType == QEvent::NonClientAreaMouseButtonRelease || eventType == QEvent::MouseButtonRelease) {
+#if !defined(ADSK_USE_RAW_EVENT)
         if (button == Qt::LeftButton && qt_leftButtonIsRightButton) {
             button = Qt::RightButton;
             qt_leftButtonIsRightButton = false;
         }
+#endif
     }
 
     Qt::MouseButtons buttons = 0;
@@ -1243,17 +1249,23 @@
         qt_button_down = widgetUnderMouse;
         if (clickCount % 2 == 0 && (previousButton == Qt::NoButton || previousButton == button))
             eventType = QEvent::MouseButtonDblClick;
+#if !defined(ADSK_USE_RAW_EVENT)
         if (button == Qt::LeftButton && (keyMods & Qt::MetaModifier)) {
             button = Qt::RightButton;
             qt_leftButtonIsRightButton = true;
         }
+#endif
         break;
     case QEvent::MouseButtonRelease:
+#if !defined(ADSK_USE_RAW_EVENT)
         if (button == Qt::LeftButton && qt_leftButtonIsRightButton) {
             button = Qt::RightButton;
             qt_leftButtonIsRightButton = false;
         }
-        qt_button_down = 0;
+#endif
+        if(!buttons)
+            qt_button_down = 0;
+
         break;
     }
 
@@ -1280,7 +1292,8 @@
         // released. We therefore need to re-check if should send (delayed) enter leave events:
         // qt_button_down has now become NULL since the call at the top of the function. Also, since
         // the relase might have closed a window, we dont give the nativeWidget hint
-        qt_mac_getTargetForMouseEvent(0, QEvent::None, localPoint, globalPoint, nativeWidget, &widgetUnderMouse);
+		// ADSK implement change suggested by QTBUG-26761  passing NULL instead of nativeWidget to fix crashes
+        qt_mac_getTargetForMouseEvent(0, QEvent::None, localPoint, globalPoint, NULL, &widgetUnderMouse);
         qt_mac_checkEnterLeaveForNativeWidgets(widgetUnderMouse);
     }
 
@@ -1555,19 +1568,40 @@
 #endif
 }
 
-CGFloat qt_mac_get_scalefactor()
-{
 #ifndef QT_MAC_USE_COCOA
+CGFloat qt_mac_get_scalefactor(QWidget *window)
+{
+    Q_UNUSED(window);
     return HIGetScaleFactor();
+}
 #endif
 
+#ifdef QT_MAC_USE_COCOA
+CGFloat qt_mac_get_scalefactor(QWidget *window)
+{
+    // No high-dpi support on 10.6 and below
 #if (MAC_OS_X_VERSION_MAX_ALLOWED >= MAC_OS_X_VERSION_10_7)
-    NSScreen *mainScreen = [NSScreen mainScreen];
-    if ([mainScreen respondsToSelector:@selector(backingScaleFactor)])
-        return [mainScreen backingScaleFactor];
+    if (QSysInfo::MacintoshVersion >= QSysInfo::MV_10_7) {
+        if (window == 0) {
+            // If there is no window given we answer the question
+            // "Are there any HiDPI screens connected?" by returning
+            // the highest scale factor found.
+            CGFloat highestScaleFactor = 1.0;
+            NSArray *screens = [NSScreen screens];
+            for (id screen in screens) {
+                highestScaleFactor = qMax(highestScaleFactor, [screen backingScaleFactor]);
+            }
+            return highestScaleFactor;
+        } else {
+            return [qt_mac_window_for(window) backingScaleFactor];
+        }
+    } else
 #endif
-    return 1.0;
+    {
+        return 1.0; // return 1.0 when compiled on or running on 10.6 and lower.
+    }
 }
+#endif
 
 QString qt_mac_get_pasteboardString(OSPasteboardRef paste)
 {
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qt_cocoa_helpers_mac_p.h qt-adsk-4.8.6/src/gui/kernel/qt_cocoa_helpers_mac_p.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qt_cocoa_helpers_mac_p.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qt_cocoa_helpers_mac_p.h	2014-05-06 04:23:09.000000000 +0800
@@ -204,7 +204,7 @@
 
 void qt_syncCocoaTitleBarButtons(OSWindowRef window, QWidget *widgetForWindow);
 
-CGFloat qt_mac_get_scalefactor();
+Q_GUI_EXPORT CGFloat qt_mac_get_scalefactor(QWidget *window = 0);
 QString qt_mac_get_pasteboardString(OSPasteboardRef paste);
 
 #ifdef __OBJC__
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qwidget.cpp qt-adsk-4.8.6/src/gui/kernel/qwidget.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qwidget.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qwidget.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -68,6 +68,8 @@
 # include "qt_cocoa_helpers_mac_p.h"
 # include "qmainwindow.h"
 # include "qtoolbar.h"
+# include "qtoolbutton.h"
+# include "qpushbutton.h"
 # include <private/qmainwindowlayout_p.h>
 #endif
 #if defined(Q_WS_QWS)
@@ -1387,6 +1389,8 @@
 
     if (++QWidgetPrivate::instanceCounter > QWidgetPrivate::maxInstances)
         QWidgetPrivate::maxInstances = QWidgetPrivate::instanceCounter;
+//ADSK: add total instance operation counter
+    ++QWidgetPrivate::instanceOperationsCounter;
 
     if (QApplicationPrivate::app_compile_version < 0x040200
         || QApplicationPrivate::testAttribute(Qt::AA_ImmediateWidgetCreation))
@@ -1414,6 +1418,30 @@
 }
 
 
+// Adsk   enable QPushButtons as Alien widgets - performance fix for Mac
+// Nokia  added Alien code for Mac, but didn't enable it.  something for Qt 4.8
+// Qt 4.8 has default Alien code for all
+bool shouldMakeAlien(QWidget *widget)
+{
+#ifdef Q_WS_MAC
+    static int  adsk_alienWidgetEnable = qgetenv("MAYA_ALIEN_WIDGETS").toInt();
+
+    if (adsk_alienWidgetEnable < 0 )
+        return false;			// -1   no alien widgets
+    if (adsk_alienWidgetEnable > 0 )
+        return true;			// +1   all alien widgets
+
+    // else  not set or is zero - default just pushbutton derived
+
+    while (widget) {
+        if (qobject_cast<QPushButton *>(widget))
+            return true;
+        widget = widget->parentWidget();
+    }
+    return false;	
+#endif
+    return true;
+}
 
 
 /*!
@@ -1491,7 +1519,17 @@
         setAttribute(Qt::WA_PaintOnScreen);
 
     if (QApplicationPrivate::testAttribute(Qt::AA_NativeWindows))
-        setAttribute(Qt::WA_NativeWindow);
+    {
+        // force native by Qt Env Var
+         setAttribute(Qt::WA_NativeWindow);
+#ifdef Q_WS_MAC
+    } else {
+	// Adsk: on Mac check if widget is a pushButton family else native
+        if (!shouldMakeAlien(this)) {
+            setAttribute(Qt::WA_NativeWindow);
+        }
+#endif
+    }
 
 #ifdef ALIEN_DEBUG
     qDebug() << "QWidget::create:" << this << "parent:" << parentWidget()
@@ -1690,6 +1728,8 @@
         // if this fails we can't do anything about it but at least we are not allowed to throw.
     }
     --QWidgetPrivate::instanceCounter;
+//ADSK: increment total operations counter
+    ++QWidgetPrivate::instanceOperationsCounter;
 
     if (QWidgetPrivate::allWidgets) // might have been deleted by ~QApplication
         QWidgetPrivate::allWidgets->remove(this);
@@ -1704,6 +1744,8 @@
 
 int QWidgetPrivate::instanceCounter = 0;  // Current number of widget instances
 int QWidgetPrivate::maxInstances = 0;     // Maximum number of widget instances
+//ADSK:  define total operations counter
+int QWidgetPrivate::instanceOperationsCounter = 0; // Has number of widget instances changed?
 
 void QWidgetPrivate::setWinId(WId id)                // set widget identifier
 {
@@ -2493,6 +2535,28 @@
 }
 
 
+//ADSK:  added functions
+/*!
+    Returns total number of widgets in application.
+*/
+
+/*static*/
+int QWidget::instanceCounter()
+{
+    return QWidgetPrivate::instanceCounter;
+}
+
+/*!
+    Returns combined number of create/delete operations on widget.
+*/
+
+/*static*/
+int QWidget::instanceOperationsCounter()
+{
+    return QWidgetPrivate::instanceOperationsCounter;
+}
+//ADSK:  end of added functions
+
 
 /*!
     \fn WId QWidget::internalWinId() const
@@ -4261,7 +4325,8 @@
     QPoint p = pos;
     if (parent) {
         const QWidget * w = this;
-        while (w != parent) {
+		// adsk: TODO  don't worry about this just now - crashes on PaneLayout setup for splitter
+        while (w != parent && w != NULL) {
             Q_ASSERT_X(w, "QWidget::mapTo(QWidget *parent, const QPoint &pos)",
                        "parent must be in parent hierarchy");
             p = w->mapToParent(p);
@@ -8361,9 +8426,10 @@
         case QEvent::TouchUpdate:
         case QEvent::TouchEnd:
         case QEvent::ContextMenu:
-#ifndef QT_NO_WHEELEVENT
-        case QEvent::Wheel:
-#endif
+// ADSK commented out - want wheel event propagate from disabled widgets to parents
+//#ifndef QT_NO_WHEELEVENT
+//        case QEvent::Wheel:
+//#endif
             return false;
         default:
             break;
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qwidget.h qt-adsk-4.8.6/src/gui/kernel/qwidget.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qwidget.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qwidget.h	2014-05-06 04:23:09.000000000 +0800
@@ -591,6 +591,10 @@
     inline Qt::WindowType windowType() const;
 
     static QWidget *find(WId);
+//ADSK: added functions
+    static int instanceCounter();
+    static int instanceOperationsCounter();
+//ADSK: end of change
 #ifdef QT3_SUPPORT
     static QT3_SUPPORT QWidgetMapper *wmapper();
 #endif
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qwidget_mac.mm qt-adsk-4.8.6/src/gui/kernel/qwidget_mac.mm
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qwidget_mac.mm	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qwidget_mac.mm	2014-05-06 04:23:09.000000000 +0800
@@ -2886,6 +2886,10 @@
     if (set && ![qwin isVisible])
         return;
 
+    // ADSK Maya doesn't want this added functionality including Windows and Dialogs
+    // we just return early
+    return;
+
     if (QWidget *parent = q->parentWidget()) {
         if (NSWindow *pwin = [qt_mac_nativeview_for(parent) window]) {
             if (set) {
@@ -3283,8 +3287,7 @@
         if (icon.isNull()) {
             [iconButton setImage:nil];
         } else {
-            QPixmap scaled = pm->scaled(QSize(16,16), Qt::KeepAspectRatio, Qt::SmoothTransformation);
-            NSImage *image = static_cast<NSImage *>(qt_mac_create_nsimage(scaled));
+            NSImage *image = static_cast<NSImage *>(qt_mac_create_nsimage(*pm));
             [iconButton setImage:image];
             [image release];
         }
@@ -3655,6 +3658,8 @@
                 if(!keepFullScreen)
                     qt_mac_set_fullscreen_mode(false);
             }
+			setSubWindowStacking(true);
+
 #endif
             toggleDrawers(false);
             qt_mac_update_cursor();
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qwidget_p.h qt-adsk-4.8.6/src/gui/kernel/qwidget_p.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/kernel/qwidget_p.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/kernel/qwidget_p.h	2014-05-06 04:23:09.000000000 +0800
@@ -748,6 +748,9 @@
     signed char bottomLayoutItemMargin;
     static int instanceCounter; // Current number of widget instances
     static int maxInstances; // Maximum number of widget instances
+//ADSK:  added total count
+    static int instanceOperationsCounter; // Total number of create/delete operations on widget
+
     Qt::HANDLE hd;
     QWidgetData data;
     QSizePolicy size_policy;
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/painting/qpainter.cpp qt-adsk-4.8.6/src/gui/painting/qpainter.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/painting/qpainter.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/painting/qpainter.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -5389,7 +5389,8 @@
             x += d->state->matrix.dx();
             y += d->state->matrix.dy();
         }
-        d->engine->drawPixmap(QRectF(x, y, w, h), pm, QRectF(0, 0, w, h));
+        int scale = pm.devicePixelRatio();
+        d->engine->drawPixmap(QRectF(x, y, w / scale, h / scale), pm, QRectF(0, 0, w, h));
     }
 }
 
@@ -5419,6 +5420,11 @@
     qreal sw = sr.width();
     qreal sh = sr.height();
 
+    // Get pixmap scale. Use it when calculating the target
+    // rect size from pixmap size. For example, a 2X 64x64 pixel
+    // pixmap should result in a 32x32 point target rect.
+    const int pmscale = pm.devicePixelRatio();
+    
     // Sanity-check clipping
     if (sw <= 0)
         sw = pm.width() - sx;
@@ -5427,9 +5433,9 @@
         sh = pm.height() - sy;
 
     if (w < 0)
-        w = sw;
+        w = sw / pmscale;
     if (h < 0)
-        h = sh;
+        h = sh / pmscale;
 
     if (sx < 0) {
         qreal w_ratio = sx * w/sw;
@@ -5677,7 +5683,8 @@
         y += d->state->matrix.dy();
     }
 
-    d->engine->drawImage(QRectF(x, y, w, h), image, QRectF(0, 0, w, h), Qt::AutoColor);
+    int scale = image.devicePixelRatio();
+    d->engine->drawImage(QRectF(x, y, w / scale, h / scale), image, QRectF(0, 0, w, h), Qt::AutoColor);
 }
 
 void QPainter::drawImage(const QRectF &targetRect, const QImage &image, const QRectF &sourceRect,
@@ -5696,7 +5703,8 @@
     qreal sy = sourceRect.y();
     qreal sw = sourceRect.width();
     qreal sh = sourceRect.height();
-
+    int imageScale = image.devicePixelRatio();
+    
     // Sanity-check clipping
     if (sw <= 0)
         sw = image.width() - sx;
@@ -5705,9 +5713,9 @@
         sh = image.height() - sy;
 
     if (w < 0)
-        w = sw;
+        w = sw / imageScale;
     if (h < 0)
-        h = sh;
+        h = sh / imageScale;
 
     if (sx < 0) {
         qreal w_ratio = sx * w/sw;
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/styles/qcommonstyle.cpp qt-adsk-4.8.6/src/gui/styles/qcommonstyle.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/styles/qcommonstyle.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/styles/qcommonstyle.cpp	2014-12-17 10:13:02.000000000 +0800
@@ -1175,7 +1175,9 @@
         QSize tabIconSize = opt->icon.actualSize(iconSize,
                         (opt->state & QStyle::State_Enabled) ? QIcon::Normal : QIcon::Disabled,
                         (opt->state & QStyle::State_Selected) ? QIcon::On : QIcon::Off  );
-
+        // High-dpi icons do not need adjustmet; make sure tabIconSize is not larger than iconSize
+        tabIconSize = QSize(qMin(tabIconSize.width(), iconSize.width()), qMin(tabIconSize.height(), iconSize.height()));
+        
         *iconRect = QRect(tr.left(), tr.center().y() - tabIconSize.height() / 2,
                     tabIconSize.width(), tabIconSize .height());
         if (!verticalTabs)
@@ -1256,8 +1258,11 @@
                     state = QIcon::On;
 
                 QPixmap pixmap = button->icon.pixmap(button->iconSize, mode, state);
-                int labelWidth = pixmap.width();
-                int labelHeight = pixmap.height();
+                
+                int pixmapWidth = pixmap.width() / pixmap.devicePixelRatio();
+                int pixmapHeight = pixmap.height() / pixmap.devicePixelRatio();
+                int labelWidth = pixmapWidth;
+                int labelHeight = pixmapHeight;
                 int iconSpacing = 4;//### 4 is currently hardcoded in QPushButton::sizeHint()
                 int textWidth = button->fontMetrics.boundingRect(opt->rect, tf, button->text).width();
                 if (!button->text.isEmpty())
@@ -1265,7 +1270,7 @@
 
                 iconRect = QRect(textRect.x() + (textRect.width() - labelWidth) / 2,
                                  textRect.y() + (textRect.height() - labelHeight) / 2,
-                                 pixmap.width(), pixmap.height());
+                                 pixmapWidth, pixmapHeight);
 
                 iconRect = visualRect(button->direction, textRect, iconRect);
 
@@ -1537,9 +1542,9 @@
             if (!header->icon.isNull()) {
                 QPixmap pixmap
                     = header->icon.pixmap(proxy()->pixelMetric(PM_SmallIconSize), (header->state & State_Enabled) ? QIcon::Normal : QIcon::Disabled);
-                int pixw = pixmap.width();
+                int pixw = pixmap.width() / pixmap.devicePixelRatio();
 
-                QRect aligned = alignedRect(header->direction, QFlag(header->iconAlignment), pixmap.size(), rect);
+                QRect aligned = alignedRect(header->direction, QFlag(header->iconAlignment), pixmap.size() / pixmap.devicePixelRatio(), rect);
                 QRect inter = aligned.intersected(rect);
                 p->drawPixmap(inter.x(), inter.y(), pixmap, inter.x() - aligned.x(), inter.y() - aligned.y(), inter.width(), inter.height());
 
@@ -1594,7 +1599,7 @@
                         mode = QIcon::Normal;
                     pm = toolbutton->icon.pixmap(toolbutton->rect.size().boundedTo(toolbutton->iconSize),
                                                  mode, state);
-                    pmSize = pm.size();
+                    pmSize = pm.size() / pm.devicePixelRatio();
                 }
 
                 if (toolbutton->toolButtonStyle != Qt::ToolButtonIconOnly) {
@@ -1817,8 +1822,8 @@
                 tr = cr;
                 tr.adjust(4, 0, -8, 0);
             } else {
-                int iw = pm.width() + 4;
-                ih = pm.height();
+                int iw = pm.width() / pm.devicePixelRatio() + 4;
+                ih = pm.height() / pm.devicePixelRatio();
                 ir = QRect(cr.left() + 4, cr.top(), iw + 2, ih);
                 tr = QRect(ir.right(), cr.top(), cr.width() - ir.right() - 4, cr.height());
             }
@@ -2936,6 +2941,10 @@
             if (canClose) {
                 QSize sz = standardIcon(QStyle::SP_TitleBarCloseButton,
                                         opt, widget).actualSize(QSize(iconSize, iconSize));
+#ifdef Q_WS_MAC
+				if ((qt_mac_get_scalefactor(0) > 1) && (sz.width() > iconSize)) // detect high-dpi pixmap
+					sz = sz / (int)qt_mac_get_scalefactor(0);
+#endif
                 sz += QSize(buttonMargin, buttonMargin);
                 if (verticalTitleBar)
                     sz.transpose();
@@ -2953,6 +2962,10 @@
             if (canFloat) {
                 QSize sz = standardIcon(QStyle::SP_TitleBarNormalButton,
                                         opt, widget).actualSize(QSize(iconSize, iconSize));
+#ifdef Q_WS_MAC
+				if ((qt_mac_get_scalefactor(0) > 1) && (sz.width() > iconSize)) // detect high-dpi pixmap
+					sz = sz / (int)qt_mac_get_scalefactor(0);
+#endif
                 sz += QSize(buttonMargin, buttonMargin);
                 if (verticalTitleBar)
                     sz.transpose();
@@ -2974,6 +2987,10 @@
                 if (!icon.isNull()
                         && icon.cacheKey() != QApplication::windowIcon().cacheKey()) {
                     QSize sz = icon.actualSize(QSize(r.height(), r.height()));
+#ifdef Q_WS_MAC
+					if ((qt_mac_get_scalefactor(0) > 1) && (sz.height() > r.height())) // detect high-dpi pixmap
+						sz = sz / (int)qt_mac_get_scalefactor(0);
+#endif
                     if (verticalTitleBar)
                         sz.transpose();
                     iconRect = QRect(left, rect.center().y() - sz.height()/2,
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/styles/qmacstyle_mac.mm qt-adsk-4.8.6/src/gui/styles/qmacstyle_mac.mm
--- qt-everywhere-opensource-src-4.8.6/src/gui/styles/qmacstyle_mac.mm	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/styles/qmacstyle_mac.mm	2014-05-06 04:23:09.000000000 +0800
@@ -1061,8 +1061,10 @@
 
 bool qt_mac_buttonIsRenderedFlat(const QPushButton *pushButton, const QStyleOptionButton *option)
 {
+    // ADSK Change, temp fix, return if not mac or is flat
+
     QMacStyle *macStyle = qobject_cast<QMacStyle *>(pushButton->style());
-    if (!macStyle)
+    if (!macStyle || pushButton->isFlat())
         return true;    // revert to 'flat' behavior if not Mac style
     HIThemeButtonDrawInfo bdi;
     macStyle->d->initHIThemePushButton(option, pushButton, kThemeStateActive, &bdi);
@@ -3254,9 +3256,10 @@
                 QPixmap pixmap = header->icon.pixmap(proxy()->pixelMetric(PM_SmallIconSize), mode);
 
                 QRect pixr = header->rect;
-                pixr.setY(header->rect.center().y() - (pixmap.height() - 1) / 2);
+                pixr.setY(header->rect.center().y() - (pixmap.height() / pixmap.devicePixelRatio() - 1) / 2);
                 proxy()->drawItemPixmap(p, pixr, Qt::AlignVCenter, pixmap);
-                textr.translate(pixmap.width() + 2, 0);
+                textr.translate(pixmap.width() / pixmap.devicePixelRatio() + 2, 0);
+
             }
 
             proxy()->drawItemText(p, textr, header->textAlignment | Qt::AlignVCenter, header->palette,
@@ -3308,15 +3311,15 @@
                             if (tb->toolButtonStyle == Qt::ToolButtonTextUnderIcon) {
                                 QMainWindow *mw = qobject_cast<QMainWindow *>(w->window());
                                 if (mw && mw->unifiedTitleAndToolBarOnMac()) {
-                                    pr.setHeight(pixmap.size().height());
+                                    pr.setHeight(pixmap.size().height() / pixmap.devicePixelRatio());
                                     cr.adjust(0, pr.bottom() + 1, 0, 1);
                                 } else {
-                                    pr.setHeight(pixmap.size().height() + 6);
+                                    pr.setHeight(pixmap.size().height() / pixmap.devicePixelRatio() + 6);
                                     cr.adjust(0, pr.bottom(), 0, -3);
-                                }       
+                                }
                                 alignment |= Qt::AlignCenter;
                             } else {
-                                pr.setWidth(pixmap.width() + 8);
+                                pr.setWidth(pixmap.width() / pixmap.devicePixelRatio() + 8);
                                 cr.adjust(pr.right(), 0, 0, 0);
                                 alignment |= Qt::AlignLeft | Qt::AlignVCenter;
                             }
@@ -3507,10 +3510,12 @@
                         if (btn->state & State_On)
                             state = QIcon::On;
                         QPixmap pixmap = btn->icon.pixmap(btn->iconSize, mode, state);
-                        contentW += pixmap.width() + QMacStylePrivate::PushButtonContentPadding;
+                        int pixmapWidth = pixmap.width() / pixmap.devicePixelRatio();
+                        int pixmapHeight = pixmap.height() / pixmap.devicePixelRatio();
+                        contentW += pixmapWidth + QMacStylePrivate::PushButtonContentPadding;
                         int iconLeftOffset = freeContentRect.x() + (freeContentRect.width() - contentW) / 2;
-                        int iconTopOffset = freeContentRect.y() + (freeContentRect.height() - pixmap.height()) / 2;
-                        QRect iconDestRect(iconLeftOffset, iconTopOffset, pixmap.width(), pixmap.height());
+                        int iconTopOffset = freeContentRect.y() + (freeContentRect.height() - pixmapHeight) / 2;
+                        QRect iconDestRect(iconLeftOffset, iconTopOffset, pixmapWidth, pixmapHeight);
                         QRect visualIconDestRect = visualRect(btn->direction, freeContentRect, iconDestRect);
                         proxy()->drawItemPixmap(p, visualIconDestRect, Qt::AlignLeft | Qt::AlignVCenter, pixmap);
                         int newOffset = iconDestRect.x() + iconDestRect.width()
@@ -3941,8 +3946,8 @@
                     iconSize = comboBox->iconSize();
                 }
                 QPixmap pixmap = mi->icon.pixmap(iconSize, mode);
-                int pixw = pixmap.width();
-                int pixh = pixmap.height();
+                int pixw = pixmap.width() / pixmap.devicePixelRatio();
+                int pixh = pixmap.height() / pixmap.devicePixelRatio();
                 QRect cr(xpos, contentRect.y(), checkcol, contentRect.height());
                 QRect pmr(0, 0, pixw, pixh);
                 pmr.moveCenter(cr.center());
@@ -6036,6 +6041,7 @@
         QPixmap pixmap(qt_mac_toolbar_ext);
         if (standardIcon == SP_ToolBarVerticalExtensionButton) {
             QPixmap pix2(pixmap.height(), pixmap.width());
+            pix2.setDevicePixelRatio(pixmap.devicePixelRatio());
             pix2.fill(Qt::transparent);
             QPainter p(&pix2);
             p.translate(pix2.width(), 0);
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/styles/qstyle.cpp qt-adsk-4.8.6/src/gui/styles/qstyle.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/styles/qstyle.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/styles/qstyle.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -555,10 +555,12 @@
 void QStyle::drawItemPixmap(QPainter *painter, const QRect &rect, int alignment,
                             const QPixmap &pixmap) const
 {
-    QRect aligned = alignedRect(QApplication::layoutDirection(), QFlag(alignment), pixmap.size(), rect);
+    int scale = pixmap.devicePixelRatio();
+    
+    QRect aligned = alignedRect(QApplication::layoutDirection(), QFlag(alignment), pixmap.size() / scale, rect);
     QRect inter = aligned.intersected(rect);
 
-    painter->drawPixmap(inter.x(), inter.y(), pixmap, inter.x() - aligned.x(), inter.y() - aligned.y(), inter.width(), inter.height());
+    painter->drawPixmap(inter.x(), inter.y(), pixmap, inter.x() - aligned.x(), inter.y() - aligned.y(), inter.width() * scale, inter.height() * scale);
 }
 
 /*!
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/styles/qstyle.h qt-adsk-4.8.6/src/gui/styles/qstyle.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/styles/qstyle.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/styles/qstyle.h	2014-07-22 17:31:13.000000000 +0800
@@ -134,7 +134,8 @@
 #endif
         State_ReadOnly =            0x02000000,
         State_Small =               0x04000000,
-        State_Mini =                0x08000000
+        State_Mini =                0x08000000,
+		State_MouseDown =			0x10000000
     };
     Q_DECLARE_FLAGS(State, StateFlag)
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/styles/qstylehelper.cpp qt-adsk-4.8.6/src/gui/styles/qstylehelper.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/styles/qstylehelper.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/styles/qstylehelper.cpp	2014-07-22 17:40:54.000000000 +0800
@@ -86,13 +86,22 @@
         scale = 1.0;
 #if defined(Q_WS_WIN)
         {
-            HDC hdcScreen = GetDC(0);
-            int dpi = GetDeviceCaps(hdcScreen, LOGPIXELSX);
-            ReleaseDC(0, hdcScreen);
-            scale = dpi/96.0;
+        	int dpi;
+        	if (qApp->customDpiOverride() != -1){
+        		dpi = qApp->customDpiOverride();
+        	}
+        	else{
+        		HDC hdcScreen = GetDC(0);
+        		dpi = GetDeviceCaps(hdcScreen, LOGPIXELSX);
+        		ReleaseDC(0, hdcScreen);
+        	}
+        	scale = dpi/96.0;
         }
-#elif defined(Q_WS_MAC)
-    scale = qt_mac_get_scalefactor();
+#elif defined(Q_OS_LINUX)
+		{
+			int dpi = qApp->customDpiOverride() != -1 ? qApp->customDpiOverride() : qApp->desktop()->logicalDpiX();
+			scale = dpi/96.0;
+		}
 #endif
     }
     return value * scale;
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/util/qsystemtrayicon.cpp qt-adsk-4.8.6/src/gui/util/qsystemtrayicon.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/util/qsystemtrayicon.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/util/qsystemtrayicon.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -283,6 +283,22 @@
 }
 
 /*!
+    \property QSystemTrayIcon::richTextEnabled
+    \brief whether the system tray's message supports rich text
+*/
+void QSystemTrayIcon::enableRichText(bool richTextEnabled)
+{
+    Q_D(QSystemTrayIcon);
+    d->richTextEnabled = richTextEnabled;
+}
+
+bool QSystemTrayIcon::isRichTextEnabled() const
+{
+    Q_D(const QSystemTrayIcon);
+    return d->richTextEnabled;
+}
+
+/*!
   \reimp
 */
 bool QSystemTrayIcon::event(QEvent *e)
@@ -386,8 +402,24 @@
                             QSystemTrayIcon::MessageIcon icon, int msecs)
 {
     Q_D(QSystemTrayIcon);
+    if (d->visible) {
+        if (isRichTextEnabled())
+            QBalloonTip::showBalloon(icon, title, msg, this,
+                geometry().center(), msecs, true);
+        else
+            d->showMessage_sys(title, msg, icon, msecs);
+    }
+}
+
+void QSystemTrayIcon::showMessage(QBalloonTip* msgBalloon, int msecs)
+{
+    if (msgBalloon == 0)
+        return;
+    Q_D(QSystemTrayIcon);
     if (d->visible)
-        d->showMessage_sys(title, msg, icon, msecs);
+        QBalloonTip::showBalloon(msgBalloon, geometry().center(), msecs, true);
+    else
+        msgBalloon->close();
 }
 
 //////////////////////////////////////////////////////////////////////
@@ -407,12 +439,38 @@
     theSolitaryBalloonTip->balloon(pos, timeout, showArrow);
 }
 
+void QBalloonTip::showBalloon(QBalloonTip* balloonTip,
+                              const QPoint& pos, int timeout, bool showArrow)
+{
+    hideBalloon();
+    if (balloonTip == 0)
+        return;
+    if ((!balloonTip->titleLabel || balloonTip->titleLabel->text().isEmpty()) &&
+        (!balloonTip->msgLabel || balloonTip->msgLabel->text().isEmpty()))
+    {
+        balloonTip->close();
+        return;
+    }
+
+    theSolitaryBalloonTip = balloonTip;
+    if (timeout < 0)
+        timeout = 10000; //10 s default
+    theSolitaryBalloonTip->balloon(pos, timeout, showArrow);
+}
+
 void QBalloonTip::hideBalloon()
 {
     if (!theSolitaryBalloonTip)
         return;
-    theSolitaryBalloonTip->hide();
-    delete theSolitaryBalloonTip;
+    // Original code:
+    // theSolitaryBalloonTip->hide();
+    // delete theSolitaryBalloonTip;
+    // We shouldn't delete the tip here since we may come here when the tip is being closed 
+    // (to show next balloon from messageClosed signal) and we should keep the object around 
+    // till the close event is finished. Instead of deleting close the balloon. 
+    // The balloon will be deleted later since it has DeleteOnClose attribute set. 
+    // New code:
+    theSolitaryBalloonTip->close();
     theSolitaryBalloonTip = 0;
 }
 
@@ -423,12 +481,13 @@
 
 QBalloonTip::QBalloonTip(QSystemTrayIcon::MessageIcon icon, const QString& title,
                          const QString& message, QSystemTrayIcon *ti)
-    : QWidget(0, Qt::ToolTip), trayIcon(ti), timerId(-1)
+    : QWidget(0, Qt::ToolTip), trayIcon(ti), timerId(-1), msgLabel(0),
+    titleLabel(0), iconLabel(0), closeButton(0), layout(0)
 {
     setAttribute(Qt::WA_DeleteOnClose);
     QObject::connect(ti, SIGNAL(destroyed()), this, SLOT(close()));
 
-    QLabel *titleLabel = new QLabel;
+    titleLabel = new QLabel;
     titleLabel->installEventFilter(this);
     titleLabel->setText(title);
     QFont f = titleLabel->font();
@@ -447,21 +506,29 @@
     const int closeButtonSize = 15;
 #endif
 
-    QPushButton *closeButton = new QPushButton;
+    closeButton = new QPushButton;
     closeButton->setIcon(style()->standardIcon(QStyle::SP_TitleBarCloseButton));
     closeButton->setIconSize(QSize(closeButtonSize, closeButtonSize));
     closeButton->setSizePolicy(QSizePolicy::Fixed, QSizePolicy::Fixed);
     closeButton->setFixedSize(closeButtonSize, closeButtonSize);
     QObject::connect(closeButton, SIGNAL(clicked()), this, SLOT(close()));
-
-    QLabel *msgLabel = new QLabel;
+    QObject::connect(closeButton, SIGNAL(clicked()), trayIcon, SIGNAL(messageCloseButtonClicked()));
+ 
+    msgLabel = new QLabel;
 #ifdef Q_WS_WINCE
     f.setBold(false);
     msgLabel->setFont(f);
 #endif
     msgLabel->installEventFilter(this);
     msgLabel->setText(message);
-    msgLabel->setTextFormat(Qt::PlainText);
+
+    if (trayIcon->isRichTextEnabled()) {
+        msgLabel->setTextFormat(Qt::RichText);
+        bool b = connect(msgLabel, SIGNAL(linkActivated(QString)), this, SLOT(messageLinkActivated(QString)));
+        Q_ASSERT(b);
+    } else {
+        msgLabel->setTextFormat(Qt::PlainText);
+    }
     msgLabel->setAlignment(Qt::AlignTop | Qt::AlignLeft);
 
     // smart size for the message label
@@ -507,9 +574,9 @@
         break;
     }
 
-    QGridLayout *layout = new QGridLayout;
+    layout = new QGridLayout;
     if (!si.isNull()) {
-        QLabel *iconLabel = new QLabel;
+        iconLabel = new QLabel;
         iconLabel->setPixmap(si.pixmap(iconSize, iconSize));
         iconLabel->setSizePolicy(QSizePolicy::Fixed, QSizePolicy::Fixed);
         iconLabel->setMargin(2);
@@ -648,6 +715,18 @@
 
 void QBalloonTip::mousePressEvent(QMouseEvent *e)
 {
+    if (msgLabel) {
+        QPoint posInLabel = msgLabel->mapFrom(this, e->pos());
+        QLabelPrivate* msgLabel_p = msgLabel->d_func();
+        QString link;
+        if (msgLabel_p && msgLabel_p->isTextLabel && msgLabel_p->layoutRect().contains(posInLabel))
+            link = msgLabel_p->control->document()->documentLayout()->anchorAt(
+                msgLabel_p->layoutPoint(posInLabel));
+        if (!link.isEmpty())
+            return;
+        // Link clicked. messageLinkClicked signal emitted already.
+    }
+
     close();
     if(e->button() == Qt::LeftButton)
         emit trayIcon->messageClicked();
@@ -664,6 +743,19 @@
     QWidget::timerEvent(e);
 }
 
+void QBalloonTip::closeEvent(QCloseEvent* e)
+{
+    msgLabel = 0;
+    QWidget::closeEvent(e);
+    emit trayIcon->messageClosed();
+}
+
+void QBalloonTip::messageLinkActivated(const QString& link)
+{
+    close();
+    emit trayIcon->messageLinkClicked(link);
+}
+
 void qtsystray_sendActivated(QSystemTrayIcon *i, int r)
 {
     emit i->activated((QSystemTrayIcon::ActivationReason)r);
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/util/qsystemtrayicon.h qt-adsk-4.8.6/src/gui/util/qsystemtrayicon.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/util/qsystemtrayicon.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/util/qsystemtrayicon.h	2014-05-06 04:23:09.000000000 +0800
@@ -55,7 +55,7 @@
 QT_MODULE(Gui)
 
 class QSystemTrayIconPrivate;
-
+class QBalloonTip;
 class QMenu;
 class QEvent;
 class QWheelEvent;
@@ -68,6 +68,7 @@
     Q_PROPERTY(QString toolTip READ toolTip WRITE setToolTip)
     Q_PROPERTY(QIcon icon READ icon WRITE setIcon)
     Q_PROPERTY(bool visible READ isVisible WRITE setVisible DESIGNABLE false)
+    Q_PROPERTY(bool richTextEnabled READ isRichTextEnabled WRITE enableRichText)
 
 public:
     QSystemTrayIcon(QObject *parent = 0);
@@ -93,12 +94,16 @@
     QString toolTip() const;
     void setToolTip(const QString &tip);
 
+    bool isRichTextEnabled() const;
+    void enableRichText(bool enabled);
+
     static bool isSystemTrayAvailable();
     static bool supportsMessages();
 
     enum MessageIcon { NoIcon, Information, Warning, Critical };
     void showMessage(const QString &title, const QString &msg,
                      MessageIcon icon = Information, int msecs = 10000);
+    void showMessage(QBalloonTip* msgBalloon, int msecs = 10000);
 
     QRect geometry() const;
     bool isVisible() const;
@@ -111,6 +116,9 @@
 Q_SIGNALS:
     void activated(QSystemTrayIcon::ActivationReason reason);
     void messageClicked();
+    void messageLinkClicked(const QString &link);
+    void messageClosed();
+    void messageCloseButtonClicked();
 
 protected:
     bool event(QEvent *event);
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/util/qsystemtrayicon_p.h qt-adsk-4.8.6/src/gui/util/qsystemtrayicon_p.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/util/qsystemtrayicon_p.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/util/qsystemtrayicon_p.h	2014-05-06 04:23:09.000000000 +0800
@@ -68,13 +68,15 @@
 class QSystemTrayIconSys;
 class QToolButton;
 class QLabel;
+class QPushButton;
+class QGridLayout;
 
 class QSystemTrayIconPrivate : public QObjectPrivate
 {
     Q_DECLARE_PUBLIC(QSystemTrayIcon)
 
 public:
-    QSystemTrayIconPrivate() : sys(0), visible(false) { }
+    QSystemTrayIconPrivate() : sys(0), visible(false), richTextEnabled(false) { }
 
     void install_sys();
     void remove_sys();
@@ -92,34 +94,47 @@
     QString toolTip;
     QSystemTrayIconSys *sys;
     bool visible;
+    bool richTextEnabled;
 };
 
-class QBalloonTip : public QWidget
+class Q_GUI_EXPORT QBalloonTip : public QWidget
 {
     Q_OBJECT
 public:
     static void showBalloon(QSystemTrayIcon::MessageIcon icon, const QString& title,
                             const QString& msg, QSystemTrayIcon *trayIcon,
                             const QPoint& pos, int timeout, bool showArrow = true);
+    static void showBalloon(QBalloonTip* balloonTip,
+                            const QPoint& pos, int timeout, bool showArrow = true);
     static void hideBalloon();
     static bool isBalloonVisible();
 
-private:
+private Q_SLOTS:
+    void messageLinkActivated(const QString& link);
+
+protected:
     QBalloonTip(QSystemTrayIcon::MessageIcon icon, const QString& title,
                 const QString& msg, QSystemTrayIcon *trayIcon);
-    ~QBalloonTip();
-    void balloon(const QPoint&, int, bool);
+    virtual ~QBalloonTip();
+
+private:
+    virtual void balloon(const QPoint&, int, bool);
 
 protected:
     void paintEvent(QPaintEvent *);
     void resizeEvent(QResizeEvent *);
     void mousePressEvent(QMouseEvent *e);
     void timerEvent(QTimerEvent *e);
+    void closeEvent(QCloseEvent* e);
 
-private:
     QSystemTrayIcon *trayIcon;
     QPixmap pixmap;
     int timerId;
+    QLabel *msgLabel;
+    QLabel *titleLabel;
+    QLabel *iconLabel;
+    QPushButton *closeButton;
+    QGridLayout *layout;
 };
 
 #if defined(Q_WS_X11)
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qabstractbutton.cpp qt-adsk-4.8.6/src/gui/widgets/qabstractbutton.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qabstractbutton.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qabstractbutton.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -1053,9 +1053,10 @@
         case QEvent::HoverEnter:
         case QEvent::HoverLeave:
         case QEvent::ContextMenu:
-#ifndef QT_NO_WHEELEVENT
-        case QEvent::Wheel:
-#endif
+// ADSK commented out - want wheel event propagate from disabled widgets to parents
+//#ifndef QT_NO_WHEELEVENT
+//        case QEvent::Wheel:
+//#endif
             return true;
         default:
             break;
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qdockarealayout.cpp qt-adsk-4.8.6/src/gui/widgets/qdockarealayout.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qdockarealayout.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qdockarealayout.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -188,6 +188,35 @@
     return QSize(-1, -1);
 }
 
+//ADSK:  new functions
+QSize QDockAreaLayoutItem::itemSize() const
+{
+    if (placeHolderItem != 0)
+        return QSize(0, 0);
+    if (widgetItem != 0) {
+        QVariant v = widgetItem->widget()->property("savedSize");
+		if(v.isValid()) {
+			return v.value<QSize>();
+		} else {
+			return widgetItem->sizeHint();
+		}
+	}
+    if (subinfo != 0)
+        return subinfo->size();
+    return QSize(-1, -1);
+}
+
+void QDockAreaLayoutItem::saveCurrentSize() const
+{
+	if (placeHolderItem != 0)
+        return;
+    if (widgetItem != 0)
+        widgetItem->widget()->setProperty("savedSize", qVariantFromValue(widgetItem->widget()->size()));
+    if (subinfo != 0)
+        subinfo->saveCurrentSize();
+}
+//ADSK:  end of new functions
+
 QDockAreaLayoutItem
     &QDockAreaLayoutItem::operator = (const QDockAreaLayoutItem &other)
 {
@@ -248,7 +277,113 @@
 
 QSize QDockAreaLayoutInfo::size() const
 {
-    return isEmpty() ? QSize(0, 0) : rect.size();
+    if (isEmpty())
+        return QSize(0, 0);
+
+//ADSK:  new functionality
+    int a = 0, b = 0;
+    bool prev_gap = false;
+    bool first = true;
+    int min_perp = 0;
+    int max_perp = QWIDGETSIZE_MAX;
+    for (int i = 0; i < item_list.size(); ++i) {
+        const QDockAreaLayoutItem &item = item_list.at(i);
+        if (item.skip())
+            continue;
+
+        bool gap = item.flags & QDockAreaLayoutItem::GapItem;
+
+        QSize item_size = item.itemSize();
+
+#ifndef QT_NO_TABBAR
+        if (tabbed) {
+            if(tabId(item) == currentTabId()) {
+				a = qMax(a, gap ? item.size : pick(o, item_size));
+			} else {
+				continue;
+			}
+        } else
+#endif
+        {
+            if(item.widgetItem != 0 && item.widgetItem->widget()->isHidden()) {
+				continue;
+			} else {
+				if (!first && !gap && !prev_gap)
+	                a += *sep;
+	            a += gap ? item.size : pick(o, item_size);
+			}
+        }
+		b = qMax(b, perp(o, item_size));
+
+		min_perp = qMax(min_perp, perp(o, item.minimumSize()));
+        max_perp = qMin(max_perp, perp(o, item.maximumSize()));
+
+        prev_gap = gap;
+        first = false;
+    }
+
+    max_perp = qMax(max_perp, min_perp);
+    b = qMax(b, min_perp);
+    b = qMin(b, max_perp);
+
+    QSize result;
+    rpick(o, result) = a;
+    rperp(o, result) = b;
+
+#ifndef QT_NO_TABBAR
+    if (tabbed) {
+        QSize tbh = tabBarSizeHint();
+        if (!tbh.isNull()) {
+            switch (tabBarShape) {
+                case QTabBar::RoundedNorth:
+                case QTabBar::RoundedSouth:
+                    result.rheight() += tbh.height();
+                    result.rwidth() = qMax(tbh.width(), result.width());
+                    break;
+                case QTabBar::RoundedEast:
+                case QTabBar::RoundedWest:
+                    result.rheight() = qMax(tbh.height(), result.height());
+                    result.rwidth() += tbh.width();
+                    break;
+                default:
+                    break;
+            }  
+        }
+    }
+#endif // QT_NO_TABBAR
+
+    return result;
+//ADSK:  end of new code
+}
+
+//ADSK:  new function
+void QDockAreaLayoutInfo::saveCurrentSize() const
+{
+	if (isEmpty())
+        return;
+
+    for (int i = 0; i < item_list.size(); ++i) {
+        const QDockAreaLayoutItem &item = item_list.at(i);
+        if (item.skip())
+            continue;
+
+#ifndef QT_NO_TABBAR
+        if (tabbed) {
+            if(tabId(item) == currentTabId()) {
+				item.saveCurrentSize();
+			} else {
+				continue;
+			}
+        } else
+#endif
+        {
+            if(item.widgetItem != 0 && item.widgetItem->widget()->isHidden()) {
+				continue;
+			} else {
+				item.saveCurrentSize();
+			}
+        }
+    }
 }
 
 void QDockAreaLayoutInfo::clear()
@@ -271,6 +406,7 @@
     if (isEmpty())
         return QSize(0, 0);
 
+//ADSK:  new functionality
     int a = 0, b = 0;
     bool first = true;
     for (int i = 0; i < item_list.size(); ++i) {
@@ -281,13 +417,21 @@
         QSize min_size = item.minimumSize();
 #ifndef QT_NO_TABBAR
         if (tabbed) {
-            a = qMax(a, pick(o, min_size));
+           if(tabId(item) == currentTabId()) {
+                a = qMax(a, pick(o, min_size));
+            } else {
+                continue;
+            }
         } else
 #endif
         {
-            if (!first)
-                a += *sep;
-            a += pick(o, min_size);
+            if(item.widgetItem != 0 && item.widgetItem->widget()->isHidden()) {
+                continue;
+            } else {
+                if (!first)
+                    a += *sep;
+                a += pick(o, min_size);
+            }
         }
         b = qMax(b, perp(o, min_size));
 
@@ -349,16 +493,26 @@
 
 #ifndef QT_NO_TABBAR
         if (tabbed) {
-            a = qMin(a, pick(o, max_size));
+            if(tabId(item) == currentTabId()) {
+                a = qMin(a, pick(o, max_size));
+            } else {
+                continue;
+            }
         } else
 #endif
         {
-            if (!first)
-                a += *sep;
-            a += pick(o, max_size);
+            if(item.widgetItem != 0 && item.widgetItem->widget()->isHidden()) {
+                continue;
+            } else {
+                if (!first)
+                    a += *sep;
+                a += pick(o, max_size);
+            }
         }
         b = qMin(b, perp(o, max_size));
 
+        min_perp = qMax(min_perp, perp(o, item.minimumSize()));
+
         a = qMin(a, int(QWIDGETSIZE_MAX));
         b = qMin(b, int(QWIDGETSIZE_MAX));
 
@@ -409,23 +563,33 @@
         bool gap = item.flags & QDockAreaLayoutItem::GapItem;
 
         QSize size_hint = item.sizeHint();
-        min_perp = qMax(min_perp, perp(o, item.minimumSize()));
-        max_perp = qMin(max_perp, perp(o, item.maximumSize()));
 
 #ifndef QT_NO_TABBAR
         if (tabbed) {
-            a = qMax(a, gap ? item.size : pick(o, size_hint));
+            if(tabId(item) == currentTabId()) {
+                a = qMax(a, gap ? item.size : pick(o, size_hint));
+            } else {
+                continue;
+            }
         } else
 #endif
         {
-            if (previous && !gap && !(previous->flags &  QDockAreaLayoutItem::GapItem)
-                && !previous->hasFixedSize(o)) {
-                a += *sep;
+            if(item.widgetItem != 0 && item.widgetItem->widget()->isHidden()) {
+                continue;
+            } else {
+
+                if (previous && !gap && !(previous->flags &  QDockAreaLayoutItem::GapItem)
+                    && !previous->hasFixedSize(o)) {
+                    a += *sep;
+                }
+                a += gap ? item.size : pick(o, size_hint);
             }
-            a += gap ? item.size : pick(o, size_hint);
         }
         b = qMax(b, perp(o, size_hint));
 
+        min_perp = qMax(min_perp, perp(o, item.minimumSize()));
+        max_perp = qMin(max_perp, perp(o, item.maximumSize()));
+
         previous = &item;
     }
 
@@ -1471,7 +1635,7 @@
             continue;
         }
 
-        if (!(item.flags & QDockAreaLayoutItem::GapItem) && item.widgetItem->widget() == widget) {
+        if (!(item.flags & QDockAreaLayoutItem::GapItem) && item.widgetItem && item.widgetItem->widget() == widget) {
             QList<int> result;
             result << i;
             return result;
@@ -1557,6 +1721,10 @@
             QDockWidget *dw = qobject_cast<QDockWidget*>(w);
             if (!r.isValid() && geo.right() >= 0 && geo.bottom() >= 0) {
                 dw->lower();
+//ADSK:  new check
+                if (dw->focusWidget())
+                    dw->focusWidget()->clearFocus();
+//ADSK:  end of check
                 emit dw->visibilityChanged(false);
             } else if (r.isValid()
                         && (geo.right() < 0 || geo.bottom() < 0)) {
@@ -3044,6 +3212,14 @@
     Q_ASSERT(info != 0);
     info->tab(path.last(), new QDockWidgetItem(second));
 
+//ADSK: new code
+	// If the dock widget being tabbed onto is collapsed, collapse
+	// the dock widget being tabbed into it as well
+	if(first->maximumSize().isNull()) {
+		second->setFixedSize(0,0);
+	}
+//ADSK:  end of code
+
     QList<int> index = indexOfPlaceHolder(second->objectName());
     if (!index.isEmpty())
         remove(index);
@@ -3061,6 +3237,14 @@
     Q_ASSERT(info != 0);
     info->split(path.last(), orientation, new QDockWidgetItem(dockWidget));
 
+//ADSK:  new code
+	// If the dock widget being split is collapsed, collapse
+	// the dock widget being attached to it as well
+	if(after->maximumSize().isNull()) {
+		dockWidget->setFixedSize(0,0);
+	}
+//ADSK:  end of code
+
     QList<int> index = indexOfPlaceHolder(dockWidget->objectName());
     if (!index.isEmpty())
         remove(index);
@@ -3128,6 +3312,8 @@
         if (delta != 0)
             delta = info->separatorMove(index, delta);
         info->apply(false);
+        // Save the new size of the dock widget area
+        info->saveCurrentSize();
         return delta;
     }
 
@@ -3153,6 +3339,10 @@
         setGrid(&list, 0);
 
     apply(false);
+//ADSK:  modified code
+    // Save the new size of the dock widget area
+    docks[index].saveCurrentSize();
+//ADSK:  end of code
 
     return delta;
 }
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qdockarealayout_p.h qt-adsk-4.8.6/src/gui/widgets/qdockarealayout_p.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qdockarealayout_p.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qdockarealayout_p.h	2014-05-06 04:23:09.000000000 +0800
@@ -105,6 +105,11 @@
     bool expansive(Qt::Orientation o) const;
     bool hasFixedSize(Qt::Orientation o) const;
 
+//ADSK:  added functions
+    QSize itemSize() const;
+    void saveCurrentSize() const;
+//ADSK:  end of functions
+
     QLayoutItem *widgetItem;
     QDockAreaLayoutInfo *subinfo;
     QPlaceHolderItem *placeHolderItem;
@@ -136,6 +141,9 @@
     QSize sizeHint() const;
     QSize size() const;
 
+//ADSK:  added function
+    void saveCurrentSize() const;
+
     bool insertGap(const QList<int> &path, QLayoutItem *dockWidgetItem);
     QLayoutItem *plug(const QList<int> &path);
     QLayoutItem *unplug(const QList<int> &path);
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qdockwidget.cpp qt-adsk-4.8.6/src/gui/widgets/qdockwidget.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qdockwidget.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qdockwidget.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -1167,6 +1167,8 @@
 {
     Q_D(QDockWidget);
     d->init();
+//ADSK:  add connection
+	connect(this, SIGNAL(visibilityChanged(bool)), this, SLOT(handleVisibilityChange(bool)));
 }
 
 /*!
@@ -1186,6 +1188,8 @@
     Q_D(QDockWidget);
     d->init();
     setWindowTitle(title);
+//ADSK:  add connection
+	connect(this, SIGNAL(visibilityChanged(bool)), this, SLOT(handleVisibilityChange(bool)));
 }
 
 /*!
@@ -1621,6 +1625,51 @@
     return layout->widgetForRole(QDockWidgetLayout::TitleBar);
 }
 
+//ADSK:  added function
+void QDockWidget::handleVisibilityChange(bool visible)
+{
+    if(!visible && maximumSize().isNull() && isHidden()) {
+        // Dock widget is collapsed and is being hidden
+            
+        // Find out how many visible dock widgets are left after this one
+		// is hidden. If there is only one left, expand all collapsed
+		// widgets in this dock area, since the tab bar will disappear
+		// and the collapsed state, which relies on the tab bar to expand
+		// again, can thus no longer be maintained
+        if(QMainWindow *win = qobject_cast<QMainWindow*>(parentWidget())) {
+            Qt::DockWidgetArea area = win->dockWidgetArea(this);
+            QObjectList childrenList = win->children();
+			QList<QDockWidget *> visibleDWs;
+			QList<QDockWidget *> areaDWs;
+            for(int i = 0; i < childrenList.count(); i++) {
+                QDockWidget *dw = qobject_cast<QDockWidget *>(childrenList[i]);
+				if(dw && win->dockWidgetArea(dw) == area) {
+					areaDWs.append(dw);
+					if(!dw->isHidden()) {
+                    visibleDWs.append(dw);
+						if(visibleDWs.count() > 1) return;
+					}
+                }
+            }
+			// If we reach this point, there is at most one visible dock widget
+			// left, so do the expansion
+			for(int i = 0; i < areaDWs.count(); i++) {
+				QDockWidget *dw = areaDWs[i];
+				if(dw && dw->maximumSize().isNull()) {
+                    dw->setMaximumSize(QWIDGETSIZE_MAX, QWIDGETSIZE_MAX);
+                    // Restore the previous size of the dock widget
+                    QVariant v = dw->property("savedSize");
+                    if(v.isValid()) {
+                        dw->resize(v.value<QSize>());
+                    } else {
+                        dw->resize(dw->sizeHint());
+                    }
+                }    
+            }
+        }
+    }
+}
+
 QT_END_NAMESPACE
 
 #include "qdockwidget.moc"
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qdockwidget.h qt-adsk-4.8.6/src/gui/widgets/qdockwidget.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qdockwidget.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qdockwidget.h	2014-05-06 04:23:09.000000000 +0800
@@ -123,6 +123,10 @@
     bool event(QEvent *event);
     void initStyleOption(QStyleOptionDockWidget *option) const;
 
+//ADSK:  added function
+private slots:
+    void handleVisibilityChange(bool visible);
+
 private:
     Q_DECLARE_PRIVATE(QDockWidget)
     Q_DISABLE_COPY(QDockWidget)
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qlabel.cpp qt-adsk-4.8.6/src/gui/widgets/qlabel.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qlabel.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qlabel.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -644,8 +644,10 @@
     int vextra = hextra;
     QFontMetrics fm = q->fontMetrics();
 
-    if (pixmap && !pixmap->isNull())
+    if (pixmap && !pixmap->isNull()) {
         br = pixmap->rect();
+        br.setSize(br.size() / pixmap->devicePixelRatio());
+    }
 #ifndef QT_NO_PICTURE
     else if (picture && !picture->isNull())
         br = picture->boundingRect();
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qmainwindowlayout.cpp qt-adsk-4.8.6/src/gui/widgets/qmainwindowlayout.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qmainwindowlayout.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qmainwindowlayout.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -1310,6 +1310,8 @@
         result->setElideMode(Qt::ElideRight);
         result->setDocumentMode(_documentMode);
         connect(result, SIGNAL(currentChanged(int)), this, SLOT(tabChanged()));
+//ADSK: added connection
+        connect(result, SIGNAL(currentReselected()), this, SLOT(toggleDockWidgets()));
     }
 
     usedTabBars.insert(result);
@@ -1340,11 +1342,66 @@
     QDockAreaLayoutInfo *info = layoutState.dockAreaLayout.info(tb);
     if (info == 0)
         return;
+
+//ADSK:  additional functionality
+    // If the tabbed dock widgets are currently in collapsed state, expand them again
+  	Qt::DockWidgetArea area = toDockWidgetArea(info->dockPos);
+   	QObjectList childrenList = layoutState.mainWindow->children();
+   	for(int i = 0; i < childrenList.count(); i++) {
+        QDockWidget *dw = qobject_cast<QDockWidget *>(childrenList[i]);
+        if(dw && layoutState.mainWindow->dockWidgetArea(dw) == area) {
+            if(dw->maximumSize().isNull()) {
+                dw->setMaximumSize(QWIDGETSIZE_MAX, QWIDGETSIZE_MAX);
+                // Restore the previous size of the dock widget
+                QVariant v = dw->property("savedSize");
+                if(v.isValid()) {
+                    dw->resize(v.value<QSize>());
+                } else {
+                    dw->resize(dw->sizeHint());
+                }
+            }
+        }
+    } 
+//ADSK:  end of change
+
     info->apply(false);
 
     if (QWidget *w = centralWidget())
         w->raise();
 }
+
+//ADSK:  new function
+void QMainWindowLayout::toggleDockWidgets()
+{
+    QTabBar *tb = qobject_cast<QTabBar*>(sender());
+    if (tb == 0)
+        return;
+    QDockAreaLayoutInfo *info = layoutState.dockAreaLayout.info(tb);
+    if (info == 0)
+        return;
+    // Collapse or expand all the dock widgets tabbed on this tab bar
+	Qt::DockWidgetArea area = toDockWidgetArea(info->dockPos);
+	QObjectList childrenList = layoutState.mainWindow->children();
+	for(int i = 0; i < childrenList.count(); i++) {
+		QDockWidget *dw = qobject_cast<QDockWidget *>(childrenList[i]);
+		if(dw && !dw->isFloating() && layoutState.mainWindow->dockWidgetArea(dw) == area) {
+			if(dw->maximumSize().isNull()) {
+				dw->setMaximumSize(QWIDGETSIZE_MAX, QWIDGETSIZE_MAX);
+				// Restore the previous size of the dock widget
+				QVariant v = dw->property("savedSize");
+				if(v.isValid()) {
+					dw->resize(v.value<QSize>());
+				} else {
+					dw->resize(dw->sizeHint());
+				}
+			} else {
+				// Save the current size of the dock widget before collapsing
+				dw->setProperty("savedSize", qVariantFromValue(dw->size()));
+				dw->setFixedSize(0,0);
+			}
+		}
+	}
+}
 #endif // QT_NO_TABBAR
 
 bool QMainWindowLayout::startSeparatorMove(const QPoint &pos)
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qmainwindowlayout_p.h qt-adsk-4.8.6/src/gui/widgets/qmainwindowlayout_p.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qmainwindowlayout_p.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qmainwindowlayout_p.h	2014-05-06 04:23:09.000000000 +0800
@@ -305,6 +305,8 @@
 #ifndef QT_NO_DOCKWIDGET
 #ifndef QT_NO_TABBAR
     void tabChanged();
+//ADSK: added function
+    void toggleDockWidgets();
 #endif
 #endif
 private:
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qmenubar.h qt-adsk-4.8.6/src/gui/widgets/qmenubar.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qmenubar.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qmenubar.h	2014-07-22 17:30:33.000000000 +0800
@@ -144,7 +144,7 @@
     void timerEvent(QTimerEvent *);
     bool eventFilter(QObject *, QEvent *);
     bool event(QEvent *);
-    void initStyleOption(QStyleOptionMenuItem *option, const QAction *action) const;
+    virtual void initStyleOption(QStyleOptionMenuItem *option, const QAction *action) const;
 
 #ifdef QT3_SUPPORT
 public:
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qmenu.cpp qt-adsk-4.8.6/src/gui/widgets/qmenu.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qmenu.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qmenu.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -123,6 +123,7 @@
         setAttribute(Qt::WA_X11NetWmWindowTypeMenu, true);
         setWindowTitle(p->windowTitle());
         setEnabled(p->isEnabled());
+        setSeparatorsCollapsible(p->separatorsCollapsible());
         //QObject::connect(this, SIGNAL(triggered(QAction*)), this, SLOT(onTrigger(QAction*)));
         //QObject::connect(this, SIGNAL(hovered(QAction*)), this, SLOT(onHovered(QAction*)));
         QList<QAction*> items = p->actions();
@@ -1664,6 +1665,30 @@
     return false;
 }
 
+//ADSK:  added function
+/*!
+   This function will forcibly show the torn off menu making it
+   appear on the users desktop.
+
+   \sa hideTearOffMenu() isTearOffMenuVisible() isTearOffEnabled()
+*/
+void QMenu::showTearOffMenu(QPoint *pos)
+{
+    if (!d_func()->tornPopup)
+        d_func()->tornPopup = new QTornOffMenu(this);
+    QSize s = sizeHint();
+    QPoint p;
+    if(NULL != pos) {
+        p.setX(pos->x());
+        p.setY(pos->y());
+    } else {
+        p = QCursor::pos();
+    }
+    d_func()->tornPopup->setGeometry(p.x(), p.y(), s.width(), s.height());
+    d_func()->tornPopup->show();
+}
+
+
 /*!
    This function will forcibly hide the torn off menu making it
    disappear from the users desktop.
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qmenu.h qt-adsk-4.8.6/src/gui/widgets/qmenu.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qmenu.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qmenu.h	2014-05-06 04:23:09.000000000 +0800
@@ -111,6 +111,8 @@
     bool isTearOffEnabled() const;
 
     bool isTearOffMenuVisible() const;
+//ADSK: added function
+    void showTearOffMenu(QPoint *pos=0);
     void hideTearOffMenu();
 
     void setDefaultAction(QAction *);
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qmenu_mac.mm qt-adsk-4.8.6/src/gui/widgets/qmenu_mac.mm
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qmenu_mac.mm	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qmenu_mac.mm	2014-05-06 04:23:09.000000000 +0800
@@ -2014,6 +2014,11 @@
 
 void qt_mac_clear_menubar()
 {
+	// ADSK  change,  Maya controls custom Main Menu
+    if (QApplication::testAttribute(Qt::AA_DontUseNativeMenuBar))
+        return;
+	// ADSK  end change
+
     if (QApplication::testAttribute(Qt::AA_MacPluginApplication))
         return;
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qsplashscreen.cpp qt-adsk-4.8.6/src/gui/widgets/qsplashscreen.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qsplashscreen.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qsplashscreen.cpp	2015-01-26 11:51:14.681900923 +0800
@@ -240,8 +240,12 @@
 
     d->pixmap = pixmap;
     setAttribute(Qt::WA_TranslucentBackground, pixmap.hasAlpha());
-
+#ifdef Q_WS_MAC
+    // For hi dpi pixmap in Mac Retina, we need to consider its devicePixelRatio.
+    QRect r(QPoint(), d->pixmap.size() / pixmap.devicePixelRatio());
+#else
     QRect r(QPoint(), d->pixmap.size());
+#endif
     resize(r.size());
     move(QApplication::desktop()->screenGeometry().center() - r.center());
     if (isVisible())
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qtabbar.cpp qt-adsk-4.8.6/src/gui/widgets/qtabbar.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qtabbar.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qtabbar.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -1758,9 +1758,14 @@
         QStyleOptionTabBarBaseV2 optTabBase;
         optTabBase.init(this);
         optTabBase.documentMode = d->documentMode;
-        if (event->type() == style()->styleHint(QStyle::SH_TabBar_SelectMouseType, &optTabBase, this))
-            setCurrentIndex(d->pressedIndex);
-        else
+//ADSK: additional check and emit code
+        if (event->type() == style()->styleHint(QStyle::SH_TabBar_SelectMouseType, &optTabBase, this)) {
+            if(d->pressedIndex == d->currentIndex) {
+                emit currentReselected();
+            }
+             setCurrentIndex(d->pressedIndex);
+        } else
+//ADSK: end of change
             repaint(tabRect(d->pressedIndex));
         if (d->movable) {
             d->dragStartPosition = event->pos();
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qtabbar.h qt-adsk-4.8.6/src/gui/widgets/qtabbar.h
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qtabbar.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qtabbar.h	2014-05-06 04:23:09.000000000 +0800
@@ -178,6 +178,8 @@
 
 Q_SIGNALS:
     void currentChanged(int index);
+//ADSK:  added function
+    void currentReselected();
     void tabCloseRequested(int index);
     void tabMoved(int from, int to);
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qtabwidget.cpp qt-adsk-4.8.6/src/gui/widgets/qtabwidget.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qtabwidget.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qtabwidget.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -777,17 +777,21 @@
     if (onlyCheck && !d->dirty)
         return; // nothing to do
 
-    QStyleOptionTabWidgetFrameV2 option;
-    initStyleOption(&option);
-
-    // this must be done immediately, because QWidgetItem relies on it (even if !isVisible())
-    d->setLayoutItemMargins(QStyle::SE_TabWidgetLayoutItem, &option);
-
     if (!isVisible()) {
+        QStyleOptionTabWidgetFrame option;
+        initStyleOption(&option);
+        // this must be done immediately, because QWidgetItem relies on it (even if !isVisible())
+        d->setLayoutItemMargins(QStyle::SE_TabWidgetLayoutItem, &option);
+
         d->dirty = true;
         return; // we'll do it later
     }
 
+    QStyleOptionTabWidgetFrameV2 option;
+    initStyleOption(&option);
+
+    d->setLayoutItemMargins(QStyle::SE_TabWidgetLayoutItem, &option);
+
     QRect tabRect = style()->subElementRect(QStyle::SE_TabWidgetTabBar, &option, this);
     d->panelRect = style()->subElementRect(QStyle::SE_TabWidgetTabPane, &option, this);
     QRect contentsRect = style()->subElementRect(QStyle::SE_TabWidgetTabContents, &option, this);
diff -rau qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qtoolbutton.cpp qt-adsk-4.8.6/src/gui/widgets/qtoolbutton.cpp
--- qt-everywhere-opensource-src-4.8.6/src/gui/widgets/qtoolbutton.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/gui/widgets/qtoolbutton.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -428,9 +428,9 @@
         w = icon.width();
         h = icon.height();
 #ifdef Q_WS_MAC
-        extern CGFloat qt_mac_get_scalefactor();
-        w /= qt_mac_get_scalefactor();
-        h /= qt_mac_get_scalefactor();
+        extern CGFloat qt_mac_get_scalefactor(QWidget *);
+        w /= qt_mac_get_scalefactor(0);
+        h /= qt_mac_get_scalefactor(0);
 #endif
     }
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/network/access/qnetworkaccesshttpbackend.cpp qt-adsk-4.8.6/src/network/access/qnetworkaccesshttpbackend.cpp
--- qt-everywhere-opensource-src-4.8.6/src/network/access/qnetworkaccesshttpbackend.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/network/access/qnetworkaccesshttpbackend.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -480,6 +480,14 @@
         // commented this out since it will be called later anyway
         // by copyFinished()
         //QNetworkAccessBackend::finished();
+	
+       ///Yongfu Ren --> Fix the synchoronus http request issue 
+	   /// that when the content is cached, this thread never gets released
+        if(isSynchronous())
+           thread->quit();
+       ///Yongfu ren <--
+	
+
         return;    // no need to send the request! :)
     }
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/network/kernel/qauthenticator.cpp qt-adsk-4.8.6/src/network/kernel/qauthenticator.cpp
--- qt-everywhere-opensource-src-4.8.6/src/network/kernel/qauthenticator.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/network/kernel/qauthenticator.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -52,6 +52,14 @@
 #include <qstring.h>
 #include <qdatetime.h>
 
+#ifdef Q_OS_WIN
+#include <qmutex.h>
+#include <private/qmutexpool_p.h>
+#include <rpc.h>
+#define SECURITY_WIN32 1
+#include <security.h>
+#endif
+
 //#define NTLMV1_CLIENT
 
 QT_BEGIN_NAMESPACE
@@ -62,6 +70,10 @@
 
 static QByteArray qNtlmPhase1();
 static QByteArray qNtlmPhase3(QAuthenticatorPrivate *ctx, const QByteArray& phase2data);
+#ifdef Q_OS_WIN
+static QByteArray qNtlmPhase1_SSPI(QAuthenticatorPrivate *ctx);
+static QByteArray qNtlmPhase3_SSPI(QAuthenticatorPrivate *ctx, const QByteArray& phase2data);
+#endif
 
 /*!
   \class QAuthenticator
@@ -81,9 +93,9 @@
 
   QAuthenticator supports the following authentication methods:
   \list
-    \o Basic
-    \o NTLM version 2
-    \o Digest-MD5
+    \li Basic
+    \li NTLM version 2
+    \li Digest-MD5
   \endlist
 
   \section1 Options
@@ -105,8 +117,8 @@
   \section2 Basic
 
   \table
-    \header \o Option \o Direction \o Description
-    \row \o \tt{realm} \o Incoming \o Contains the realm of the authentication, the same as realm()
+    \header \li Option \li Direction \li Description
+    \row \li \tt{realm} \li Incoming \li Contains the realm of the authentication, the same as realm()
   \endtable
 
   The Basic authentication mechanism supports no outgoing options.
@@ -114,12 +126,14 @@
   \section2 NTLM version 2
 
   The NTLM authentication mechanism currently supports no incoming or outgoing options.
+  On Windows, if no \a user has been set, domain\user credentials will be searched for on the
+  local system to enable Single-Sign-On functionality.
 
   \section2 Digest-MD5
 
   \table
-    \header \o Option \o Direction \o Description
-    \row \o \tt{realm} \o Incoming \o Contains the realm of the authentication, the same as realm()
+    \header \li Option \li Direction \li Description
+    \row \li \tt{realm} \li Incoming \li Contains the realm of the authentication, the same as realm()
   \endtable
 
   The Digest-MD5 authentication mechanism supports no outgoing options.
@@ -233,6 +247,8 @@
 
 /*!
   Sets the \a password used for authentication.
+
+  \sa QNetworkAccessManager::authenticationRequired()
 */
 void QAuthenticator::setPassword(const QString &password)
 {
@@ -311,17 +327,38 @@
     return !d;
 }
 
+#ifdef Q_OS_WIN
+class QNtlmWindowsHandles
+{
+	public:
+	    CredHandle credHandle;
+	    CtxtHandle ctxHandle;
+};
+#endif
+
 QAuthenticatorPrivate::QAuthenticatorPrivate()
     : method(None)
     , hasFailed(false)
     , phase(Start)
     , nonceCount(0)
+#ifdef Q_OS_WIN
+    , ntlmWindowsHandles(0)
+#endif
 {
     cnonce = QCryptographicHash::hash(QByteArray::number(qrand(), 16) + QByteArray::number(qrand(), 16),
                                       QCryptographicHash::Md5).toHex();
     nonceCount = 0;
 }
 
+QAuthenticatorPrivate::~QAuthenticatorPrivate()
+{
+#ifdef Q_OS_WIN
+    if (ntlmWindowsHandles)
+        delete ntlmWindowsHandles;
+#endif
+}
+ 
+
 #ifndef QT_NO_HTTP
 void QAuthenticatorPrivate::parseHttpResponse(const QHttpResponseHeader &header, bool isProxy)
 {
@@ -337,10 +374,6 @@
 }
 #endif
 
-QAuthenticatorPrivate::~QAuthenticatorPrivate()
-{
-}
-
 void QAuthenticatorPrivate::updateCredentials()
 {
     int separatorPosn = 0;
@@ -466,14 +499,36 @@
     case QAuthenticatorPrivate::Ntlm:
         methodString = "NTLM ";
         if (challenge.isEmpty()) {
-            response = qNtlmPhase1().toBase64();
-            if (user.isEmpty())
-                phase = Done;
-            else
+#ifdef Q_OS_WIN
+            QByteArray phase1Token;
+            if (user.isEmpty()) // Only pull from system if no user was specified in authenticator
+                phase1Token = qNtlmPhase1_SSPI(this);
+            if (!phase1Token.isEmpty()) {
+                response = phase1Token.toBase64();
                 phase = Phase2;
+            } else
+#endif
+            {
+                response = qNtlmPhase1().toBase64();
+                if (user.isEmpty())
+                    phase = Done;
+                else
+                    phase = Phase2;
+            }
         } else {
-            response = qNtlmPhase3(this, QByteArray::fromBase64(challenge)).toBase64();
-            phase = Done;
+#ifdef Q_OS_WIN
+            QByteArray phase3Token;
+            if (ntlmWindowsHandles)
+                phase3Token = qNtlmPhase3_SSPI(this, QByteArray::fromBase64(challenge));
+            if (!phase3Token.isEmpty()) {
+                response = phase3Token.toBase64();
+                phase = Done;
+            } else
+#endif
+            {
+                response = qNtlmPhase3(this, QByteArray::fromBase64(challenge)).toBase64();
+                phase = Done;
+            }
         }
 
         break;
@@ -939,7 +994,7 @@
     QNtlmPhase1Block() {
         qstrncpy(magic, "NTLMSSP", 8);
         type = 1;
-        flags = NTLMSSP_NEGOTIATE_UNICODE | NTLMSSP_NEGOTIATE_NTLM | NTLMSSP_REQUEST_TARGET;
+        flags = NTLMSSP_NEGOTIATE_UNICODE | NTLMSSP_NEGOTIATE_NTLM | NTLMSSP_REQUEST_TARGET | NTLMSSP_NEGOTIATE_ALWAYS_SIGN | NTLMSSP_NEGOTIATE_NTLM2;
     }
 
     // extracted
@@ -967,7 +1022,7 @@
     QNtlmPhase3Block() {
         qstrncpy(magic, "NTLMSSP", 8);
         type = 3;
-        flags = NTLMSSP_NEGOTIATE_UNICODE | NTLMSSP_NEGOTIATE_NTLM | NTLMSSP_NEGOTIATE_TARGET_INFO;
+        flags = NTLMSSP_NEGOTIATE_NTLM | NTLMSSP_REQUEST_TARGET;
     }
 
     // extracted
@@ -1353,7 +1408,7 @@
     ds >> ch.targetInfo;
 
     if (ch.targetName.len > 0) {
-        if (ch.targetName.len + ch.targetName.offset >= (unsigned)data.size())
+        if (ch.targetName.len + ch.targetName.offset > (unsigned)data.size())
             return false;
 
         ch.targetNameStr = qStringFromUcs2Le(data.mid(ch.targetName.offset, ch.targetName.len));
@@ -1381,9 +1436,16 @@
     ds.setByteOrder(QDataStream::LittleEndian);
     QNtlmPhase3Block pb;
 
+    // set NTLMv2
+    if (ch.flags & NTLMSSP_NEGOTIATE_NTLM2)
+        pb.flags |= NTLMSSP_NEGOTIATE_NTLM2;
+
+    // set Always Sign
+    if (ch.flags & NTLMSSP_NEGOTIATE_ALWAYS_SIGN)
+        pb.flags |= NTLMSSP_NEGOTIATE_ALWAYS_SIGN;
+
     bool unicode = ch.flags & NTLMSSP_NEGOTIATE_UNICODE;
 
-    pb.flags = NTLMSSP_NEGOTIATE_NTLM;
     if (unicode)
         pb.flags |= NTLMSSP_NEGOTIATE_UNICODE;
     else
@@ -1393,14 +1455,8 @@
     int offset = QNtlmPhase3BlockBase::Size;
     Q_ASSERT(QNtlmPhase3BlockBase::Size == sizeof(QNtlmPhase3BlockBase));
 
-    // for kerberos style user@domain logins, NTLM domain string should be left empty
-    if (ctx->userDomain.isEmpty() && !ctx->extractedUser.contains(QLatin1Char('@'))) {
-        offset = qEncodeNtlmString(pb.domain, offset, ch.targetNameStr, unicode);
-        pb.domainStr = ch.targetNameStr;
-    } else {
-        offset = qEncodeNtlmString(pb.domain, offset, ctx->userDomain, unicode);
-        pb.domainStr = ctx->userDomain;
-    }
+    offset = qEncodeNtlmString(pb.domain, offset, ctx->userDomain, unicode);
+    pb.domainStr = ctx->userDomain;
 
     offset = qEncodeNtlmString(pb.user, offset, ctx->extractedUser, unicode);
     pb.userStr = ctx->extractedUser;
@@ -1435,6 +1491,165 @@
     return rc;
 }
 
+#ifdef Q_OS_WIN
+// See http://davenport.sourceforge.net/ntlm.html
+// and libcurl http_ntlm.c
+
+// Handle of secur32.dll
+static HMODULE securityDLLHandle = NULL;
+// Pointer to SSPI dispatch table
+static PSecurityFunctionTable pSecurityFunctionTable = NULL;
+
+
+static bool q_NTLM_SSPI_library_load()
+{
+    QMutexLocker locker(QMutexPool::globalInstanceGet((void *)&pSecurityFunctionTable));
+
+    // Initialize security interface
+    if (pSecurityFunctionTable == NULL) {
+        securityDLLHandle = LoadLibrary(L"secur32.dll");
+        if (securityDLLHandle != NULL) {
+#if defined(Q_OS_WINCE)
+            INIT_SECURITY_INTERFACE pInitSecurityInterface =
+            (INIT_SECURITY_INTERFACE)GetProcAddress(securityDLLHandle,
+                                                    L"InitSecurityInterfaceW");
+#else
+            INIT_SECURITY_INTERFACE pInitSecurityInterface =
+            (INIT_SECURITY_INTERFACE)GetProcAddress(securityDLLHandle,
+                                                    "InitSecurityInterfaceW");
+#endif
+            if (pInitSecurityInterface != NULL)
+                pSecurityFunctionTable = pInitSecurityInterface();
+        }
+    }
 
+    if (pSecurityFunctionTable == NULL)
+        return false;
+
+    return true;
+}
+
+#ifdef Q_OS_WIN
+// Phase 1:
+static QByteArray qNtlmPhase1_SSPI(QAuthenticatorPrivate *ctx)
+{
+    QByteArray result;
+
+    if (!q_NTLM_SSPI_library_load())
+        return result;
+
+    // 1. The client obtains a representation of the credential set
+    // for the user via the SSPI AcquireCredentialsHandle function.
+    if (!ctx->ntlmWindowsHandles)
+        ctx->ntlmWindowsHandles = new QNtlmWindowsHandles;
+    memset(&ctx->ntlmWindowsHandles->credHandle, 0, sizeof(CredHandle));
+    TimeStamp tsDummy;
+    SECURITY_STATUS secStatus = pSecurityFunctionTable->AcquireCredentialsHandle(
+        NULL, (SEC_WCHAR*)L"NTLM", SECPKG_CRED_OUTBOUND, NULL, NULL,
+        NULL, NULL, &ctx->ntlmWindowsHandles->credHandle, &tsDummy);
+    if (secStatus != SEC_E_OK) {
+        delete ctx->ntlmWindowsHandles;
+        ctx->ntlmWindowsHandles = 0;
+        return result;
+    }
+
+    // 2. The client calls the SSPI InitializeSecurityContext function
+    // to obtain an authentication request token (in our case, a Type 1 message).
+    // The client sends this token to the server.
+    SecBufferDesc desc;
+    SecBuffer buf;
+    desc.ulVersion = SECBUFFER_VERSION;
+    desc.cBuffers  = 1;
+    desc.pBuffers  = &buf;
+    buf.cbBuffer   = 0;
+    buf.BufferType = SECBUFFER_TOKEN;
+    buf.pvBuffer   = NULL;
+    ULONG attrs;
+
+    secStatus = pSecurityFunctionTable->InitializeSecurityContext(&ctx->ntlmWindowsHandles->credHandle, NULL,
+        const_cast<SEC_WCHAR*>(L"") /* host */,
+        ISC_REQ_ALLOCATE_MEMORY,
+        0, SECURITY_NETWORK_DREP,
+        NULL, 0,
+        &ctx->ntlmWindowsHandles->ctxHandle, &desc,
+        &attrs, &tsDummy);
+    if (secStatus == SEC_I_COMPLETE_AND_CONTINUE ||
+        secStatus == SEC_I_CONTINUE_NEEDED) {
+            pSecurityFunctionTable->CompleteAuthToken(&ctx->ntlmWindowsHandles->ctxHandle, &desc);
+    } else if (secStatus != SEC_E_OK) {
+        if ((const char*)buf.pvBuffer)
+            pSecurityFunctionTable->FreeContextBuffer(buf.pvBuffer);
+        pSecurityFunctionTable->FreeCredentialsHandle(&ctx->ntlmWindowsHandles->credHandle);
+        delete ctx->ntlmWindowsHandles;
+        ctx->ntlmWindowsHandles = 0;
+        return result;
+    }
+
+    result = QByteArray((const char*)buf.pvBuffer, buf.cbBuffer);
+    pSecurityFunctionTable->FreeContextBuffer(buf.pvBuffer);
+    return result;
+}
+
+// Phase 2:
+// 3. The server receives the token from the client, and uses it as input to the
+// AcceptSecurityContext SSPI function. This creates a local security context on
+// the server to represent the client, and yields an authentication response token
+// (the Type 2 message), which is sent to the client.
+
+// Phase 3:
+static QByteArray qNtlmPhase3_SSPI(QAuthenticatorPrivate *ctx, const QByteArray& phase2data)
+{
+    // 4. The client receives the response token from the server and calls
+    // InitializeSecurityContext again, passing the server's token as input.
+    // This provides us with another authentication request token (the Type 3 message).
+    // The return value indicates that the security context was successfully initialized;
+    // the token is sent to the server.
+
+    QByteArray result;
+
+    if (pSecurityFunctionTable == NULL)
+        return result;
+
+    SecBuffer type_2, type_3;
+    SecBufferDesc type_2_desc, type_3_desc;
+    ULONG attrs;
+    TimeStamp tsDummy; // For Windows 9x compatibility of SPPI calls
+
+    type_2_desc.ulVersion  = type_3_desc.ulVersion  = SECBUFFER_VERSION;
+    type_2_desc.cBuffers   = type_3_desc.cBuffers   = 1;
+    type_2_desc.pBuffers   = &type_2;
+    type_3_desc.pBuffers   = &type_3;
+
+    type_2.BufferType = SECBUFFER_TOKEN;
+    type_2.pvBuffer   = (PVOID)phase2data.data();
+    type_2.cbBuffer   = phase2data.length();
+    type_3.BufferType = SECBUFFER_TOKEN;
+    type_3.pvBuffer   = 0;
+    type_3.cbBuffer   = 0;
+
+    SECURITY_STATUS secStatus = pSecurityFunctionTable->InitializeSecurityContext(&ctx->ntlmWindowsHandles->credHandle,
+        &ctx->ntlmWindowsHandles->ctxHandle,
+        const_cast<SEC_WCHAR*>(L"") /* host */,
+        ISC_REQ_ALLOCATE_MEMORY,
+        0, SECURITY_NETWORK_DREP, &type_2_desc,
+        0, &ctx->ntlmWindowsHandles->ctxHandle, &type_3_desc,
+        &attrs, &tsDummy);
+
+    if (secStatus == SEC_E_OK && ((const char*)type_3.pvBuffer)) {
+        result = QByteArray((const char*)type_3.pvBuffer, type_3.cbBuffer);
+        pSecurityFunctionTable->FreeContextBuffer(type_3.pvBuffer);
+    }
+
+    pSecurityFunctionTable->FreeCredentialsHandle(&ctx->ntlmWindowsHandles->credHandle);
+    pSecurityFunctionTable->DeleteSecurityContext(&ctx->ntlmWindowsHandles->ctxHandle);
+    delete ctx->ntlmWindowsHandles;
+    ctx->ntlmWindowsHandles = 0;
+
+    return result;
+}
+#endif // Q_OS_WIN
+
+#endif
 
 QT_END_NAMESPACE
+
diff -rau qt-everywhere-opensource-src-4.8.6/src/network/kernel/qauthenticator_p.h qt-adsk-4.8.6/src/network/kernel/qauthenticator_p.h
--- qt-everywhere-opensource-src-4.8.6/src/network/kernel/qauthenticator_p.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/network/kernel/qauthenticator_p.h	2014-05-06 04:23:09.000000000 +0800
@@ -63,6 +63,10 @@
 
 class QHttpResponseHeader;
 
+#ifdef Q_OS_WIN
+class QNtlmWindowsHandles;
+#endif
+
 class Q_AUTOTEST_EXPORT QAuthenticatorPrivate
 {
 public:
@@ -77,6 +81,9 @@
     Method method;
     QString realm;
     QByteArray challenge;
+#ifdef Q_OS_WIN
+    QNtlmWindowsHandles *ntlmWindowsHandles;
+#endif
     bool hasFailed; //credentials have been tried but rejected by server.
 
     enum Phase {
diff -rau qt-everywhere-opensource-src-4.8.6/src/network/socket/qlocalserver_unix.cpp qt-adsk-4.8.6/src/network/socket/qlocalserver_unix.cpp
--- qt-everywhere-opensource-src-4.8.6/src/network/socket/qlocalserver_unix.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/network/socket/qlocalserver_unix.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -208,16 +208,11 @@
 
 void QLocalServerPrivate::waitForNewConnection(int msec, bool *timedOut)
 {
-    fd_set readfds;
-    FD_ZERO(&readfds);
-    FD_SET(listenSocket, &readfds);
-
-    timeval timeout;
-    timeout.tv_sec = msec / 1000;
-    timeout.tv_usec = (msec % 1000) * 1000;
+    struct pollfd fd;
+    fd.fd = listenSocket;
+    fd.events = POLLIN;
 
-    int result = -1;
-    result = qt_safe_select(listenSocket + 1, &readfds, 0, 0, (msec == -1) ? 0 : &timeout);
+    int result = qt_safe_poll(&fd, 1, msec);
     if (-1 == result) {
         setError(QLatin1String("QLocalServer::waitForNewConnection"));
         closeServer();
diff -rau qt-everywhere-opensource-src-4.8.6/src/network/socket/qlocalsocket_unix.cpp qt-adsk-4.8.6/src/network/socket/qlocalsocket_unix.cpp
--- qt-everywhere-opensource-src-4.8.6/src/network/socket/qlocalsocket_unix.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/network/socket/qlocalsocket_unix.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -56,10 +56,6 @@
 #include <qdebug.h>
 #include <qelapsedtimer.h>
 
-#ifdef Q_OS_VXWORKS
-#  include <selectLib.h>
-#endif
-
 #define QT_CONNECT_TIMEOUT 30000
 
 QT_BEGIN_NAMESPACE
@@ -520,32 +516,17 @@
     if (state() != ConnectingState)
         return (state() == ConnectedState);
 
-    fd_set fds;
-    FD_ZERO(&fds);
-    FD_SET(d->connectingSocket, &fds);
-
-    timeval timeout;
-    timeout.tv_sec = msec / 1000;
-    timeout.tv_usec = (msec % 1000) * 1000;
-
-    // timeout can not be 0 or else select will return an error.
-    if (0 == msec)
-        timeout.tv_usec = 1000;
+    pollfd fd;
+    fd.fd = d->connectingSocket;
+    fd.events = POLLIN | POLLOUT;
 
     int result = -1;
     // on Linux timeout will be updated by select, but _not_ on other systems.
     QElapsedTimer timer;
+    int remaining = msec;
     timer.start();
-    while (state() == ConnectingState
-           && (-1 == msec || timer.elapsed() < msec)) {
-#ifdef Q_OS_SYMBIAN
-        // On Symbian, ready-to-write is signaled when non-blocking socket
-        // connect is finised. Is ready-to-read really used on other
-        // UNIX paltforms when using non-blocking AF_UNIX socket?
-        result = ::select(d->connectingSocket + 1, 0, &fds, 0, &timeout);
-#else
-        result = ::select(d->connectingSocket + 1, &fds, 0, 0, &timeout);
-#endif
+    while (state() == ConnectingState) {
+        result = qt_safe_poll(&fd, 1, remaining, /* retry_eintr */ false);
         if (-1 == result && errno != EINTR) {
             d->errorOccurred( QLocalSocket::UnknownSocketError,
                     QLatin1String("QLocalSocket::waitForConnected"));
@@ -553,6 +534,11 @@
         }
         if (result > 0)
             d->_q_connectToSocket();
+        if (msec >= 0) {
+            remaining = timer.elapsed() - msec;
+            if (remaining < 0)
+                break;
+        }
     }
 
     return (state() == ConnectedState);
diff -rau qt-everywhere-opensource-src-4.8.6/src/network/socket/qnativesocketengine_unix.cpp qt-adsk-4.8.6/src/network/socket/qnativesocketengine_unix.cpp
--- qt-everywhere-opensource-src-4.8.6/src/network/socket/qnativesocketengine_unix.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/network/socket/qnativesocketengine_unix.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -1068,48 +1068,40 @@
 
 int QNativeSocketEnginePrivate::nativeSelect(int timeout, bool selectForRead) const
 {
-    fd_set fds;
-    FD_ZERO(&fds);
-    FD_SET(socketDescriptor, &fds);
-
-    struct timeval tv;
-    tv.tv_sec = timeout / 1000;
-    tv.tv_usec = (timeout % 1000) * 1000;
-
-    int retval;
-    if (selectForRead)
-        retval = qt_safe_select(socketDescriptor + 1, &fds, 0, 0, timeout < 0 ? 0 : &tv);
-    else
-        retval = qt_safe_select(socketDescriptor + 1, 0, &fds, 0, timeout < 0 ? 0 : &tv);
-
-    return retval;
+    struct pollfd fd;
+    fd.fd = socketDescriptor;
+    if (selectForRead) {
+	fd.events = POLLIN;
+    } else {
+	fd.events = POLLOUT;
+    }
+    return qt_safe_poll(&fd, 1, timeout);
 }
 
 int QNativeSocketEnginePrivate::nativeSelect(int timeout, bool checkRead, bool checkWrite,
                        bool *selectForRead, bool *selectForWrite) const
 {
-    fd_set fdread;
-    FD_ZERO(&fdread);
+    struct pollfd fd;
+    fd.fd = socketDescriptor;
     if (checkRead)
-        FD_SET(socketDescriptor, &fdread);
-
-    fd_set fdwrite;
-    FD_ZERO(&fdwrite);
+	fd.events =  POLLIN;
+    else
+	fd.events = 0;
     if (checkWrite)
-        FD_SET(socketDescriptor, &fdwrite);
-
-    struct timeval tv;
-    tv.tv_sec = timeout / 1000;
-    tv.tv_usec = (timeout % 1000) * 1000;
-
-    int ret;
-    ret = qt_safe_select(socketDescriptor + 1, &fdread, &fdwrite, 0, timeout < 0 ? 0 : &tv);
-
+	fd.events |= POLLOUT;
+    int ret = qt_safe_poll(&fd, 1, timeout);
     if (ret <= 0)
-        return ret;
-    *selectForRead = FD_ISSET(socketDescriptor, &fdread);
-    *selectForWrite = FD_ISSET(socketDescriptor, &fdwrite);
-
+	return ret;
+    bool r = (fd.revents & (POLLIN | POLLHUP | POLLERR)) != 0;
+    bool w = (fd.revents & (POLLOUT | POLLHUP | POLLERR)) != 0;
+    // Emulate the return value from select(2).
+    ret = 0;
+    if (r)
+	++ret;
+    if (w)
+	++ret;
+    *selectForRead = r;
+    *selectForWrite = w;
     return ret;
 }
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/network/ssl/qsslsocket_openssl.cpp qt-adsk-4.8.6/src/network/ssl/qsslsocket_openssl.cpp
--- qt-everywhere-opensource-src-4.8.6/src/network/ssl/qsslsocket_openssl.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/network/ssl/qsslsocket_openssl.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -357,18 +357,22 @@
         }
     }
 
-    bool addExpiredCerts = true;
+    //bool addExpiredCerts = true;
 #if defined(Q_OS_MAC) && (MAC_OS_X_VERSION_MAX_ALLOWED == MAC_OS_X_VERSION_10_5)
+    bool addExpiredCerts = true;
     //On Leopard SSL does not work if we add the expired certificates.
     if (QSysInfo::MacintoshVersion == QSysInfo::MV_10_5)
        addExpiredCerts = false;
 #endif
+    // ECO-30-029 (http://psebshare/sites/platform/technology/Lists/FY13%20Requests/DispForm.aspx?ID=570&ContentTypeId=0x01002730D7F1F4571E4580829266E2A1C4A1)
+    // Modified on 8/16/2011 4:05:58 PM by Gao Yang (yangga)
+    // Description: Comment out the following four lines that encloses a foreach loop.
     // now add the expired certs
-    if (addExpiredCerts) {
-        foreach (const QSslCertificate &caCertificate, expiredCerts) {
-            q_X509_STORE_add_cert(ctx->cert_store, (X509 *)caCertificate.handle());
-        }
-    }
+    //if (addExpiredCerts) {
+    //    foreach (const QSslCertificate &caCertificate, expiredCerts) {
+    //        q_X509_STORE_add_cert(ctx->cert_store, (X509 *)caCertificate.handle());
+    //    }
+    //}
 
     if (s_loadRootCertsOnDemand && allowRootCertOnDemandLoading) {
         // tell OpenSSL the directories where to look up the root certs on demand
diff -rau qt-everywhere-opensource-src-4.8.6/src/opengl/qgl.h qt-adsk-4.8.6/src/opengl/qgl.h
--- qt-everywhere-opensource-src-4.8.6/src/opengl/qgl.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/opengl/qgl.h	2014-05-06 04:23:09.000000000 +0800
@@ -153,6 +153,7 @@
         HasOverlay              = 0x0100,
         SampleBuffers           = 0x0200,
         DeprecatedFunctions     = 0x0400,
+        DebugContext            = 0x0800,
         SingleBuffer            = DoubleBuffer    << 16,
         NoDepthBuffer           = DepthBuffer     << 16,
         ColorIndex              = Rgba            << 16,
@@ -163,7 +164,8 @@
         IndirectRendering       = DirectRendering << 16,
         NoOverlay               = HasOverlay      << 16,
         NoSampleBuffers         = SampleBuffers   << 16,
-        NoDeprecatedFunctions   = DeprecatedFunctions << 16
+        NoDeprecatedFunctions   = DeprecatedFunctions << 16,
+        NoDebugContext          = DebugContext << 16
     };
     Q_DECLARE_FLAGS(FormatOptions, FormatOption)
 }
@@ -390,6 +392,8 @@
     QColor overlayTransparentColor() const;
 
     static const QGLContext* currentContext();
+//ADSK:  added function
+    void * getContext();
 
 #ifdef Q_WS_QPA
     static QGLContext *fromPlatformGLContext(QPlatformGLContext *platformContext);
diff -rau qt-everywhere-opensource-src-4.8.6/src/opengl/qgl_mac.mm qt-adsk-4.8.6/src/opengl/qgl_mac.mm
--- qt-everywhere-opensource-src-4.8.6/src/opengl/qgl_mac.mm	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/opengl/qgl_mac.mm	2014-05-06 04:23:09.000000000 +0800
@@ -187,6 +187,16 @@
     return false;
 }
 
+//ADSK: new function
+void * QGLContext::getContext()
+{
+    Q_D(QGLContext);
+    if (d)
+        return (void *)d->cx;
+    else
+        return NULL;
+}
+
 bool QGLContext::chooseContext(const QGLContext *shareContext)
 {
     QMacCocoaAutoReleasePool pool;
@@ -350,7 +360,7 @@
 
 void *QGLContextPrivate::tryFormat(const QGLFormat &format)
 {
-    static const int Max = 40;
+    static const int Max = 42;
 #ifndef QT_MAC_USE_COCOA
     GLint attribs[Max], cnt = 0;
     bool device_is_pixmap = (paintDevice->devType() == QInternal::Pixmap);
@@ -436,6 +446,18 @@
         if (format.doubleBuffer())
             attribs[cnt++] = NSOpenGLPFADoubleBuffer;
     }
+    if (format.profile() == QGLFormat::CoreProfile) {
+#if MAC_OS_X_VERSION_MAX_ALLOWED >= MAC_OS_X_VERSION_10_7
+    if ((format.majorVersion() == 3 && format.minorVersion() >= 2)
+          || format.majorVersion() > 3 ) {
+          attribs[cnt++] = NSOpenGLPFAOpenGLProfile;
+          // Will open a 4.1 profile on OS/X 10.9 even though the enum mentions 3.2
+          attribs[cnt++] = NSOpenGLProfileVersion3_2Core;
+        }
+#else
+     qWarning("Mac OSX >= 10.7 is needed for OpenGL Core Profile support");
+#endif
+    }
     if (glFormat.stereo())
         attribs[cnt++] = NSOpenGLPFAStereo;
     if (device_is_pixmap || format.alpha()) {
diff -rau qt-everywhere-opensource-src-4.8.6/src/opengl/qgl_win.cpp qt-adsk-4.8.6/src/opengl/qgl_win.cpp
--- qt-everywhere-opensource-src-4.8.6/src/opengl/qgl_win.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/opengl/qgl_win.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -714,7 +714,7 @@
     PFNWGLCREATECONTEXTATTRIBSARB wglCreateContextAttribsARB =
         (PFNWGLCREATECONTEXTATTRIBSARB) wglGetProcAddress("wglCreateContextAttribsARB");
     if (wglCreateContextAttribsARB) {
-        int attributes[11];
+        int attributes[13];
         int attribIndex = 0;
         const int major = d->reqFormat.majorVersion();
         const int minor = d->reqFormat.minorVersion();
@@ -746,6 +746,11 @@
             }
         }
 
+        if (d->reqFormat.testOption(QGL::DebugContext)) {
+            attributes[attribIndex++] = WGL_CONTEXT_FLAGS_ARB;
+            attributes[attribIndex++] = WGL_CONTEXT_DEBUG_BIT_ARB;
+        }
+
         if (d->reqFormat.plane() != 0) {
             attributes[attribIndex++] = WGL_CONTEXT_LAYER_PLANE_ARB;
             attributes[attribIndex++] = d->reqFormat.plane();
@@ -814,6 +819,17 @@
     }
 }
 
+//ADSK:  added function
+void * QGLContext::getContext()
+{
+    Q_D(QGLContext);
+    if (d)
+        return (void *)d->rc;
+    else
+        return NULL;
+}
+
+
 bool QGLContext::chooseContext(const QGLContext* shareContext)
 {
     QGLContextPrivate *share = shareContext ? const_cast<QGLContext *>(shareContext)->d_func() : 0;
diff -rau qt-everywhere-opensource-src-4.8.6/src/opengl/qgl_x11.cpp qt-adsk-4.8.6/src/opengl/qgl_x11.cpp
--- qt-everywhere-opensource-src-4.8.6/src/opengl/qgl_x11.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/opengl/qgl_x11.cpp	2014-05-06 04:23:09.000000000 +0800
@@ -564,6 +564,17 @@
   QGLContext UNIX/GLX-specific code
  *****************************************************************************/
 
+// ADSK: added function
+void * QGLContext::getContext()
+{
+    Q_D(QGLContext);
+    if (d)
+        return (void *)d->cx;
+    else
+        return NULL;
+}
+
+
 bool QGLContext::chooseContext(const QGLContext* shareContext)
 {
     Q_D(QGLContext);
@@ -673,7 +684,12 @@
         int attributes[] = { GLX_CONTEXT_MAJOR_VERSION_ARB, major,
                              GLX_CONTEXT_MINOR_VERSION_ARB, minor,
                              GLX_CONTEXT_PROFILE_MASK_ARB, profile,
-                             0 };
+                             0, 0, 0 };
+
+        if (d->reqFormat.testOption(QGL::DebugContext)) {
+            attributes[6] = GLX_CONTEXT_FLAGS_ARB;
+            attributes[7] = GLX_CONTEXT_DEBUG_BIT_ARB;
+        }
 
         typedef GLXContext ( * Q_PFNGLXCREATECONTEXTATTRIBSARBPROC)
             (Display* dpy, GLXFBConfig config, GLXContext share_context, Bool direct, const int *attrib_list);
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/accessible/compat/compat.pro qt-adsk-4.8.6/src/plugins/accessible/compat/compat.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/accessible/compat/compat.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/accessible/compat/compat.pro	2014-05-06 04:23:09.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET  = qtaccessiblecompatwidgets
+TARGET  = qtaccessiblecompatwidgets$${QT_LIBINFIX}
 CONFIG += qt_no_compat_warning
 include(../../qpluginbase.pri)
 include (../qaccessiblebase.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/accessible/widgets/widgets.pro qt-adsk-4.8.6/src/plugins/accessible/widgets/widgets.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/accessible/widgets/widgets.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/accessible/widgets/widgets.pro	2014-05-06 04:23:09.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET  = qtaccessiblewidgets
+TARGET  = qtaccessiblewidgets$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 include (../qaccessiblebase.pri)
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/connman/connman.pro qt-adsk-4.8.6/src/plugins/bearer/connman/connman.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/connman/connman.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/bearer/connman/connman.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qconnmanbearer
+TARGET = qconnmanbearer$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT = core network dbus
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/corewlan/corewlan.pro qt-adsk-4.8.6/src/plugins/bearer/corewlan/corewlan.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/corewlan/corewlan.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/bearer/corewlan/corewlan.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,11 +1,11 @@
-TARGET = qcorewlanbearer
+TARGET = qcorewlanbearer$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT = core network
 LIBS += -framework Foundation -framework SystemConfiguration
 
 contains(QT_CONFIG, corewlan) {
-    isEmpty(QMAKE_MAC_SDK)|contains(QMAKE_MAC_SDK, "/Developer/SDKs/MacOSX10\.[67]\.sdk") {
+    isEmpty(QMAKE_MAC_SDK)|contains(QMAKE_MAC_SDK, ".*MacOSX10\.[6789]\.sdk"){ 
          LIBS += -framework CoreWLAN -framework Security
     }
 }
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/generic/generic.pro qt-adsk-4.8.6/src/plugins/bearer/generic/generic.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/generic/generic.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/bearer/generic/generic.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qgenericbearer
+TARGET = qgenericbearer$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT = core network
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/icd/icd.pro qt-adsk-4.8.6/src/plugins/bearer/icd/icd.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/icd/icd.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/bearer/icd/icd.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qicdbearer
+TARGET = qicdbearer$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT = core network dbus
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/nativewifi/nativewifi.pro qt-adsk-4.8.6/src/plugins/bearer/nativewifi/nativewifi.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/nativewifi/nativewifi.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/bearer/nativewifi/nativewifi.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qnativewifibearer
+TARGET = qnativewifibearer$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT = core network
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/networkmanager/networkmanager.pro qt-adsk-4.8.6/src/plugins/bearer/networkmanager/networkmanager.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/networkmanager/networkmanager.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/bearer/networkmanager/networkmanager.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qnmbearer
+TARGET = qnmbearer$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT = core network dbus
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/nla/nla.pro qt-adsk-4.8.6/src/plugins/bearer/nla/nla.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/nla/nla.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/bearer/nla/nla.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qnlabearer
+TARGET = qnlabearer$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT = core network
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/symbian/3_1/3_1.pro qt-adsk-4.8.6/src/plugins/bearer/symbian/3_1/3_1.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/symbian/3_1/3_1.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/bearer/symbian/3_1/3_1.pro	2014-05-06 04:23:10.000000000 +0800
@@ -5,5 +5,5 @@
 } else {
     LIBS += -lAPEngine
 }
-TARGET = $${TARGET}_3_1
+TARGET = $${TARGET}_3_1$${QT_LIBINFIX}
 TARGET.UID3 = 0x2002131C
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/symbian/3_2/3_2.pro qt-adsk-4.8.6/src/plugins/bearer/symbian/3_2/3_2.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/bearer/symbian/3_2/3_2.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/bearer/symbian/3_2/3_2.pro	2014-05-06 04:23:10.000000000 +0800
@@ -13,5 +13,5 @@
     }
 }
 
-TARGET = $${TARGET}_3_2
+TARGET = $${TARGET}_3_2$${QT_LIBINFIX}
 TARGET.UID3 = 0x2002131D
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/codecs/cn/cn.pro qt-adsk-4.8.6/src/plugins/codecs/cn/cn.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/codecs/cn/cn.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/codecs/cn/cn.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET	 = qcncodecs
+TARGET	 = qcncodecs$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 CONFIG	+= warn_on
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/codecs/jp/jp.pro qt-adsk-4.8.6/src/plugins/codecs/jp/jp.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/codecs/jp/jp.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/codecs/jp/jp.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET	 = qjpcodecs
+TARGET	 = qjpcodecs$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 CONFIG	+= warn_on
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/codecs/kr/kr.pro qt-adsk-4.8.6/src/plugins/codecs/kr/kr.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/codecs/kr/kr.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/codecs/kr/kr.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET	 = qkrcodecs
+TARGET	 = qkrcodecs$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 CONFIG	+= warn_on
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/codecs/tw/tw.pro qt-adsk-4.8.6/src/plugins/codecs/tw/tw.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/codecs/tw/tw.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/codecs/tw/tw.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET   = qtwcodecs
+TARGET   = qtwcodecs$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 CONFIG  += warn_on
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/decorations/default/default.pro qt-adsk-4.8.6/src/plugins/decorations/default/default.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/decorations/default/default.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/decorations/default/default.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET	 = qdecorationdefault
+TARGET	 = qdecorationdefault$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 HEADERS	= $$QT_SOURCE_TREE/src/gui/embedded/qdecorationdefault_qws.h
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/decorations/styled/styled.pro qt-adsk-4.8.6/src/plugins/decorations/styled/styled.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/decorations/styled/styled.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/decorations/styled/styled.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qdecorationstyled
+TARGET = qdecorationstyled$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/decorations
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/decorations/windows/windows.pro qt-adsk-4.8.6/src/plugins/decorations/windows/windows.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/decorations/windows/windows.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/decorations/windows/windows.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET	 = qdecorationwindows
+TARGET	 = qdecorationwindows$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 HEADERS	= $$QT_SOURCE_TREE/src/gui/embedded/qdecorationwindows_qws.h
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/generic/linuxinput/linuxinput.pro qt-adsk-4.8.6/src/plugins/generic/linuxinput/linuxinput.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/generic/linuxinput/linuxinput.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/generic/linuxinput/linuxinput.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qlinuxinputplugin
+TARGET = qlinuxinputplugin$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/generic
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/generic/tslib/tslib.pro qt-adsk-4.8.6/src/plugins/generic/tslib/tslib.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/generic/tslib/tslib.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/generic/tslib/tslib.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qtslibplugin
+TARGET = qtslibplugin$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/generic
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/ahi/ahi.pro qt-adsk-4.8.6/src/plugins/gfxdrivers/ahi/ahi.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/ahi/ahi.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/gfxdrivers/ahi/ahi.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qahiscreen
+TARGET = qahiscreen$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/gfxdrivers
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/directfb/directfb.pro qt-adsk-4.8.6/src/plugins/gfxdrivers/directfb/directfb.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/directfb/directfb.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/gfxdrivers/directfb/directfb.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qdirectfbscreen
+TARGET = qdirectfbscreen$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 include($$QT_SOURCE_TREE/src/gui/embedded/directfb.pri)
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/eglnullws/eglnullws.pro qt-adsk-4.8.6/src/plugins/gfxdrivers/eglnullws/eglnullws.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/eglnullws/eglnullws.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/gfxdrivers/eglnullws/eglnullws.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qeglnullws
+TARGET = qeglnullws$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 CONFIG += warn_on
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/linuxfb/linuxfb.pro qt-adsk-4.8.6/src/plugins/gfxdrivers/linuxfb/linuxfb.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/linuxfb/linuxfb.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/gfxdrivers/linuxfb/linuxfb.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qscreenlinuxfb
+TARGET = qscreenlinuxfb$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/gfxdrivers
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/powervr/pvreglscreen/pvreglscreen.pro qt-adsk-4.8.6/src/plugins/gfxdrivers/powervr/pvreglscreen/pvreglscreen.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/powervr/pvreglscreen/pvreglscreen.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/gfxdrivers/powervr/pvreglscreen/pvreglscreen.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,5 +1,5 @@
 TEMPLATE = lib
-TARGET = qgfxpvregl
+TARGET = qgfxpvregl$${QT_LIBINFIX}
 CONFIG += qt plugin warn_on
 QT += opengl
 
@@ -24,4 +24,4 @@
 target.path = $$[QT_INSTALL_PLUGINS]/gfxdrivers
 INSTALLS += target
 
-include(../powervr.pri)
\ No newline at end of file
+include(../powervr.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/powervr/QWSWSEGL/QWSWSEGL.pro qt-adsk-4.8.6/src/plugins/gfxdrivers/powervr/QWSWSEGL/QWSWSEGL.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/powervr/QWSWSEGL/QWSWSEGL.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/gfxdrivers/powervr/QWSWSEGL/QWSWSEGL.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,5 +1,5 @@
 TEMPLATE = lib
-TARGET = pvrQWSWSEGL
+TARGET = pvrQWSWSEGL$${QT_LIBINFIX}
 CONFIG += dll warn_on
 CONFIG -= qt
 
@@ -23,4 +23,4 @@
 target.path = $$[QT_INSTALL_LIBS]
 INSTALLS += target
 
-include(../powervr.pri)
\ No newline at end of file
+include(../powervr.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/qvfb/qvfb.pro qt-adsk-4.8.6/src/plugins/gfxdrivers/qvfb/qvfb.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/qvfb/qvfb.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/gfxdrivers/qvfb/qvfb.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qscreenvfb
+TARGET = qscreenvfb$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 DEFINES	+= QT_QWS_QVFB QT_QWS_MOUSE_QVFB QT_QWS_KBD_QVFB
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/transformed/transformed.pro qt-adsk-4.8.6/src/plugins/gfxdrivers/transformed/transformed.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/transformed/transformed.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/gfxdrivers/transformed/transformed.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET	 = qgfxtransformed
+TARGET	 = qgfxtransformed$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 DEFINES	+= QT_QWS_TRANSFORMED
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/vnc/vnc.pro qt-adsk-4.8.6/src/plugins/gfxdrivers/vnc/vnc.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/gfxdrivers/vnc/vnc.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/gfxdrivers/vnc/vnc.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qgfxvnc
+TARGET = qgfxvnc$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 DEFINES	+= QT_QWS_VNC
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/graphicssystems/meego/meego.pro qt-adsk-4.8.6/src/plugins/graphicssystems/meego/meego.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/graphicssystems/meego/meego.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/graphicssystems/meego/meego.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qmeegographicssystem
+TARGET = qmeegographicssystem$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT += gui opengl
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/graphicssystems/opengl/opengl.pro qt-adsk-4.8.6/src/plugins/graphicssystems/opengl/opengl.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/graphicssystems/opengl/opengl.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/graphicssystems/opengl/opengl.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qglgraphicssystem
+TARGET = qglgraphicssystem$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT += opengl
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/graphicssystems/openvg/openvg.pro qt-adsk-4.8.6/src/plugins/graphicssystems/openvg/openvg.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/graphicssystems/openvg/openvg.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/graphicssystems/openvg/openvg.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qvggraphicssystem
+TARGET = qvggraphicssystem$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT += openvg
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/graphicssystems/shivavg/shivavg.pro qt-adsk-4.8.6/src/plugins/graphicssystems/shivavg/shivavg.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/graphicssystems/shivavg/shivavg.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/graphicssystems/shivavg/shivavg.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qshivavggraphicssystem
+TARGET = qshivavggraphicssystem$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT += openvg
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/graphicssystems/trace/trace.pro qt-adsk-4.8.6/src/plugins/graphicssystems/trace/trace.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/graphicssystems/trace/trace.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/graphicssystems/trace/trace.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qtracegraphicssystem
+TARGET = qtracegraphicssystem$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT += network
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/iconengines/svgiconengine/svgiconengine.pro qt-adsk-4.8.6/src/plugins/iconengines/svgiconengine/svgiconengine.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/iconengines/svgiconengine/svgiconengine.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/iconengines/svgiconengine/svgiconengine.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET  = qsvgicon
+TARGET  = qsvgicon$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 HEADERS += qsvgiconengine.h
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/gif/gif.pro qt-adsk-4.8.6/src/plugins/imageformats/gif/gif.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/gif/gif.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/imageformats/gif/gif.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET  = qgif
+TARGET  = qgif$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 include(../../../gui/image/qgifhandler.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/ico/ico.pro qt-adsk-4.8.6/src/plugins/imageformats/ico/ico.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/ico/ico.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/imageformats/ico/ico.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET  = qico
+TARGET  = qico$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:REQUIRES = "!contains(QT_CONFIG, no-ico)"
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/jpeg/jpeg.pro qt-adsk-4.8.6/src/plugins/imageformats/jpeg/jpeg.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/jpeg/jpeg.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/imageformats/jpeg/jpeg.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET  = qjpeg
+TARGET  = qjpeg$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:REQUIRES = "!contains(QT_CONFIG, no-jpeg)"
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/mng/mng.pro qt-adsk-4.8.6/src/plugins/imageformats/mng/mng.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/mng/mng.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/imageformats/mng/mng.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET  = qmng
+TARGET  = qmng$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:REQUIRES = "!contains(QT_CONFIG, no-mng)"
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/svg/svg.pro qt-adsk-4.8.6/src/plugins/imageformats/svg/svg.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/svg/svg.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/imageformats/svg/svg.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET  = qsvg
+TARGET  = qsvg$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 HEADERS += qsvgiohandler.h
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/tga/tga.pro qt-adsk-4.8.6/src/plugins/imageformats/tga/tga.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/tga/tga.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/imageformats/tga/tga.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qtga
+TARGET = qtga$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:REQUIRES = "!contains(QT_CONFIG, no-tga)"
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/tiff/tiff.pro qt-adsk-4.8.6/src/plugins/imageformats/tiff/tiff.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/imageformats/tiff/tiff.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/imageformats/tiff/tiff.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET  = qtiff
+TARGET  = qtiff$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:REQUIRES = "!contains(QT_CONFIG, no-tiff)"
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/inputmethods/imsw-multi/imsw-multi.pro qt-adsk-4.8.6/src/plugins/inputmethods/imsw-multi/imsw-multi.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/inputmethods/imsw-multi/imsw-multi.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/inputmethods/imsw-multi/imsw-multi.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET   = qimsw-multi
+TARGET   = qimsw-multi$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 CONFIG      += warn_on
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/kbddrivers/linuxinput/linuxinput.pro qt-adsk-4.8.6/src/plugins/kbddrivers/linuxinput/linuxinput.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/kbddrivers/linuxinput/linuxinput.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/kbddrivers/linuxinput/linuxinput.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qlinuxinputkbddriver
+TARGET = qlinuxinputkbddriver$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/kbddrivers
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/mousedrivers/linuxtp/linuxtp.pro qt-adsk-4.8.6/src/plugins/mousedrivers/linuxtp/linuxtp.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/mousedrivers/linuxtp/linuxtp.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/mousedrivers/linuxtp/linuxtp.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qlinuxtpmousedriver
+TARGET = qlinuxtpmousedriver$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/mousedrivers
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/mousedrivers/pc/pc.pro qt-adsk-4.8.6/src/plugins/mousedrivers/pc/pc.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/mousedrivers/pc/pc.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/mousedrivers/pc/pc.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qpcmousedriver
+TARGET = qpcmousedriver$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/mousedrivers
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/mousedrivers/tslib/tslib.pro qt-adsk-4.8.6/src/plugins/mousedrivers/tslib/tslib.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/mousedrivers/tslib/tslib.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/mousedrivers/tslib/tslib.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET	 = qtslibmousedriver
+TARGET	 = qtslibmousedriver$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/mousedrivers
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/phonon/ds9/ds9.pro qt-adsk-4.8.6/src/plugins/phonon/ds9/ds9.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/phonon/ds9/ds9.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/phonon/ds9/ds9.pro	2014-05-06 04:23:10.000000000 +0800
@@ -4,7 +4,7 @@
 win32:!wince*:LIBS += -lgdi32
 win32-msvc2005:DEFINES += _CRT_SECURE_NO_WARNINGS
 LIBS += -lstrmiids -ldmoguids -luuid -lmsdmo -lole32 -loleaut32
-TARGET = phonon_ds9
+TARGET = phonon_ds9$${QT_LIBINFIX}
 
 DEFINES += PHONON_MAKE_QT_ONLY_BACKEND
 PHONON_DS9_DIR = $$QT_SOURCE_TREE/src/3rdparty/phonon/ds9
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/phonon/gstreamer/gstreamer.pro qt-adsk-4.8.6/src/plugins/phonon/gstreamer/gstreamer.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/phonon/gstreamer/gstreamer.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/phonon/gstreamer/gstreamer.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = phonon_gstreamer
+TARGET = phonon_gstreamer$${QT_LIBINFIX}
 DESTDIR = $$QT_BUILD_TREE/plugins/phonon_backend
 
 DEPENDPATH += .
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/phonon/mmf/mmf.pro qt-adsk-4.8.6/src/plugins/phonon/mmf/mmf.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/phonon/mmf/mmf.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/phonon/mmf/mmf.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,7 +1,7 @@
 # MMF Phonon backend
 symbian {
 	QT += phonon
-	TARGET = phonon_mmf
+	TARGET = phonon_mmf$${QT_LIBINFIX}
 	PHONON_MMF_DIR = $$QT_SOURCE_TREE/src/3rdparty/phonon/mmf
 
 	# Uncomment the following line in order to use the CDrmPlayerUtility client
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/phonon/qt7/qt7.pro qt-adsk-4.8.6/src/plugins/phonon/qt7/qt7.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/phonon/qt7/qt7.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/phonon/qt7/qt7.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,5 +1,5 @@
 QT += opengl phonon
-TARGET = phonon_qt7
+TARGET = phonon_qt7$${QT_LIBINFIX}
 DESTDIR = $$QT_BUILD_TREE/plugins/phonon_backend
 
 # The Quicktime framework is only awailable for 32-bit builds, so we
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/phonon/waveout/waveout.pro qt-adsk-4.8.6/src/plugins/phonon/waveout/waveout.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/phonon/waveout/waveout.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/phonon/waveout/waveout.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,7 +1,7 @@
 DESTDIR = $$QT_BUILD_TREE/plugins/phonon_backend
 QT += phonon
 win32-msvc2005:DEFINES += _CRT_SECURE_NO_WARNINGS
-TARGET = phonon_waveout
+TARGET = phonon_waveout$${QT_LIBINFIX}
 
 DEFINES += PHONON_MAKE_QT_ONLY_BACKEND
 PHONON_WAVEOUT_DIR = $$QT_SOURCE_TREE/src/3rdparty/phonon/waveout
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/blackberry/blackberry.pro qt-adsk-4.8.6/src/plugins/platforms/blackberry/blackberry.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/blackberry/blackberry.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/blackberry/blackberry.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = blackberry
+TARGET = blackberry$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/platforms
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/cocoa/cocoa.pro qt-adsk-4.8.6/src/plugins/platforms/cocoa/cocoa.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/cocoa/cocoa.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/cocoa/cocoa.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qcocoa
+TARGET = qcocoa$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/platforms
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/directfb/directfb.pro qt-adsk-4.8.6/src/plugins/platforms/directfb/directfb.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/directfb/directfb.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/directfb/directfb.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qdirectfb
+TARGET = qdirectfb$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/platforms
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/eglfs/eglfs.pro qt-adsk-4.8.6/src/plugins/platforms/eglfs/eglfs.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/eglfs/eglfs.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/eglfs/eglfs.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qeglfs
+TARGET = qeglfs$${QT_LIBINFIX}
 TEMPLATE = lib
 CONFIG += plugin
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/fb_base/fb_base.pro qt-adsk-4.8.6/src/plugins/platforms/fb_base/fb_base.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/fb_base/fb_base.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/fb_base/fb_base.pro	2014-05-06 04:23:10.000000000 +0800
@@ -5,7 +5,7 @@
 #-------------------------------------------------
 
 #QT       -= core gui
-TARGET = fb_base
+TARGET = fb_base$${QT_LIBINFIX}
 #include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/graphicssystems
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/linuxfb/linuxfb.pro qt-adsk-4.8.6/src/plugins/platforms/linuxfb/linuxfb.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/linuxfb/linuxfb.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/linuxfb/linuxfb.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qlinuxfbgraphicssystem
+TARGET = qlinuxfbgraphicssystem$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/platforms
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/minimal/minimal.pro qt-adsk-4.8.6/src/plugins/platforms/minimal/minimal.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/minimal/minimal.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/minimal/minimal.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qminimal
+TARGET = qminimal$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/platforms
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/openkode/openkode.pro qt-adsk-4.8.6/src/plugins/platforms/openkode/openkode.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/openkode/openkode.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/openkode/openkode.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qopenkodeintegration
+TARGET = qopenkodeintegration$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT += opengl
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/qvfb/qvfb.pro qt-adsk-4.8.6/src/plugins/platforms/qvfb/qvfb.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/qvfb/qvfb.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/qvfb/qvfb.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qvfbintegration
+TARGET = qvfbintegration$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/platforms
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/uikit/phonon_av/phonon_av.pro qt-adsk-4.8.6/src/plugins/platforms/uikit/phonon_av/phonon_av.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/uikit/phonon_av/phonon_av.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/uikit/phonon_av/phonon_av.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,6 +1,6 @@
 DESTDIR = $$QT_BUILD_TREE/plugins/phonon_backend
 QT += phonon
-TARGET = phonon_av
+TARGET = phonon_av$${QT_LIBINFIX}
 include(../../../qpluginbase.pri)
 
 DEFINES += PHONON_MAKE_QT_ONLY_BACKEND
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/uikit/platform.pro qt-adsk-4.8.6/src/plugins/platforms/uikit/platform.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/uikit/platform.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/uikit/platform.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = quikit
+TARGET = quikit$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/platforms
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/vnc/vnc.pro qt-adsk-4.8.6/src/plugins/platforms/vnc/vnc.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/vnc/vnc.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/vnc/vnc.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qvncgraphicssystem
+TARGET = qvncgraphicssystem$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QT += network
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/wayland/wayland.pro qt-adsk-4.8.6/src/plugins/platforms/wayland/wayland.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/wayland/wayland.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/wayland/wayland.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qwayland
+TARGET = qwayland$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/platforms
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/xcb/xcb.pro qt-adsk-4.8.6/src/plugins/platforms/xcb/xcb.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/xcb/xcb.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/xcb/xcb.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = xcb
+TARGET = xcb$${QT_LIBINFIX}
 
 include(../../qpluginbase.pri)
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/platforms
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/xlib/xlib.pro qt-adsk-4.8.6/src/plugins/platforms/xlib/xlib.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/platforms/xlib/xlib.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/platforms/xlib/xlib.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qxlib
+TARGET = qxlib$${QT_LIBINFIX}
 
 include(../../qpluginbase.pri)
 QTDIR_build:DESTDIR = $$QT_BUILD_TREE/plugins/platforms
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/qmltooling/qmldbg_inspector/qmldbg_inspector.pro qt-adsk-4.8.6/src/plugins/qmltooling/qmldbg_inspector/qmldbg_inspector.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/qmltooling/qmldbg_inspector/qmldbg_inspector.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/qmltooling/qmldbg_inspector/qmldbg_inspector.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qmldbg_inspector
+TARGET = qmldbg_inspector$${QT_LIBINFIX}
 QT       += declarative
 
 include(../../qpluginbase.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/qmltooling/qmldbg_ost/qmldbg_ost.pro qt-adsk-4.8.6/src/plugins/qmltooling/qmldbg_ost/qmldbg_ost.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/qmltooling/qmldbg_ost/qmldbg_ost.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/qmltooling/qmldbg_ost/qmldbg_ost.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qmldbg_ost
+TARGET = qmldbg_ost$${QT_LIBINFIX}
 QT       += declarative network
 
 include(../../qpluginbase.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/script/qtdbus/qtdbus.pro qt-adsk-4.8.6/src/plugins/script/qtdbus/qtdbus.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/script/qtdbus/qtdbus.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/script/qtdbus/qtdbus.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET  = qtscriptdbus
+TARGET  = qtscriptdbus$${QT_LIBINFIX}
 include(../../qpluginbase.pri)
 QT = core gui script
 CONFIG += qdbus
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/db2/db2.pro qt-adsk-4.8.6/src/plugins/sqldrivers/db2/db2.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/db2/db2.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/sqldrivers/db2/db2.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qsqldb2
+TARGET = qsqldb2$${QT_LIBINFIX}
 
 SOURCES = main.cpp
 include(../../../sql/drivers/db2/qsql_db2.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/ibase/ibase.pro qt-adsk-4.8.6/src/plugins/sqldrivers/ibase/ibase.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/ibase/ibase.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/sqldrivers/ibase/ibase.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qsqlibase
+TARGET = qsqlibase$${QT_LIBINFIX}
 
 SOURCES = main.cpp
 include(../../../sql/drivers/ibase/qsql_ibase.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/mysql/mysql.pro qt-adsk-4.8.6/src/plugins/sqldrivers/mysql/mysql.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/mysql/mysql.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/sqldrivers/mysql/mysql.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qsqlmysql
+TARGET = qsqlmysql$${QT_LIBINFIX}
 
 SOURCES = main.cpp
 include(../../../sql/drivers/mysql/qsql_mysql.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/oci/oci.pro qt-adsk-4.8.6/src/plugins/sqldrivers/oci/oci.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/oci/oci.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/sqldrivers/oci/oci.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qsqloci
+TARGET = qsqloci$${QT_LIBINFIX}
 
 SOURCES = main.cpp
 include(../../../sql/drivers/oci/qsql_oci.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/odbc/odbc.pro qt-adsk-4.8.6/src/plugins/sqldrivers/odbc/odbc.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/odbc/odbc.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/sqldrivers/odbc/odbc.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qsqlodbc
+TARGET = qsqlodbc$${QT_LIBINFIX}
 
 SOURCES = main.cpp
 include(../../../sql/drivers/odbc/qsql_odbc.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/psql/psql.pro qt-adsk-4.8.6/src/plugins/sqldrivers/psql/psql.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/psql/psql.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/sqldrivers/psql/psql.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qsqlpsql
+TARGET = qsqlpsql$${QT_LIBINFIX}
 
 SOURCES = main.cpp
 include(../../../sql/drivers/psql/qsql_psql.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/sqlite/sqlite.pro qt-adsk-4.8.6/src/plugins/sqldrivers/sqlite/sqlite.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/sqlite/sqlite.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/sqldrivers/sqlite/sqlite.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qsqlite
+TARGET = qsqlite$${QT_LIBINFIX}
 
 SOURCES = smain.cpp
 include(../../../sql/drivers/sqlite/qsql_sqlite.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/sqlite2/sqlite2.pro qt-adsk-4.8.6/src/plugins/sqldrivers/sqlite2/sqlite2.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/sqlite2/sqlite2.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/sqldrivers/sqlite2/sqlite2.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qsqlite2
+TARGET = qsqlite2$${QT_LIBINFIX}
 
 SOURCES = smain.cpp
 include(../../../sql/drivers/sqlite2/qsql_sqlite2.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/symsql/symsql.pro qt-adsk-4.8.6/src/plugins/sqldrivers/symsql/symsql.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/symsql/symsql.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/sqldrivers/symsql/symsql.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qsymsql
+TARGET = qsymsql$${QT_LIBINFIX}
 PLUGIN_TYPE = sqldrivers
 SOURCES = main.cpp
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/tds/tds.pro qt-adsk-4.8.6/src/plugins/sqldrivers/tds/tds.pro
--- qt-everywhere-opensource-src-4.8.6/src/plugins/sqldrivers/tds/tds.pro	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/plugins/sqldrivers/tds/tds.pro	2014-05-06 04:23:10.000000000 +0800
@@ -1,4 +1,4 @@
-TARGET = qsqltds
+TARGET = qsqltds$${QT_LIBINFIX}
 
 SOURCES = main.cpp
 include(../../../sql/drivers/tds/qsql_tds.pri)
diff -rau qt-everywhere-opensource-src-4.8.6/src/qt3support/network/q3socketdevice_unix.cpp qt-adsk-4.8.6/src/qt3support/network/q3socketdevice_unix.cpp
--- qt-everywhere-opensource-src-4.8.6/src/qt3support/network/q3socketdevice_unix.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/qt3support/network/q3socketdevice_unix.cpp	2014-05-06 04:23:10.000000000 +0800
@@ -68,6 +68,7 @@
 #endif
 
 #include "q3socketdevice.h"
+#include "private/qcore_unix_p.h"
 
 #ifndef QT_NO_NETWORK
 
@@ -588,19 +589,10 @@
 {
     if ( !isValid() )
 	return -1;
-    if ( fd >= FD_SETSIZE )
-	return -1;
-
-    fd_set fds;
-    struct timeval tv;
-
-    FD_ZERO( &fds );
-    FD_SET( fd, &fds );
-
-    tv.tv_sec = msecs / 1000;
-    tv.tv_usec = (msecs % 1000) * 1000;
 
-    int rv = select( fd+1, &fds, 0, 0, msecs < 0 ? 0 : &tv );
+    pollfd pfd;
+    pfd.fd = fd;
+    int rv = qt_safe_poll(&pfd, 1, msecs, /* retry_eintr */ false);
 
     if ( rv < 0 )
 	return -1;
diff -rau qt-everywhere-opensource-src-4.8.6/src/qt3support/other/q3process_unix.cpp qt-adsk-4.8.6/src/qt3support/other/q3process_unix.cpp
--- qt-everywhere-opensource-src-4.8.6/src/qt3support/other/q3process_unix.cpp	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/qt3support/other/q3process_unix.cpp	2014-05-06 04:23:10.000000000 +0800
@@ -981,13 +981,10 @@
 	// On heavy processing, the socket notifier for the sigchild might not
 	// have found time to fire yet.
 	if ( d->procManager && d->procManager->sigchldFd[1] < FD_SETSIZE ) {
-	    fd_set fds;
-	    struct timeval tv;
-	    FD_ZERO( &fds );
-	    FD_SET( d->procManager->sigchldFd[1], &fds );
-	    tv.tv_sec = 0;
-	    tv.tv_usec = 0;
-	    if ( ::select( d->procManager->sigchldFd[1]+1, &fds, 0, 0, &tv ) > 0 )
+	    pollfd fd;
+	    fd.fd = d->procManager->sigchldFd[1];
+	    fd.events = POLLIN;
+	    if ( qt_safe_poll(&fd, 1, 0, /* retry_eintr */ false) > 0 )
 		d->procManager->sigchldHnd( d->procManager->sigchldFd[1] );
 	}
 
@@ -1124,29 +1121,21 @@
 	}
     }
 
-    if ( fd < FD_SETSIZE ) {
-	fd_set fds;
-	struct timeval tv;
-	FD_ZERO( &fds );
-	FD_SET( fd, &fds );
-	tv.tv_sec = 0;
-	tv.tv_usec = 0;
-	while ( ::select( fd+1, &fds, 0, 0, &tv ) > 0 ) {
-	    // prepare for the next round
-	    FD_ZERO( &fds );
-	    FD_SET( fd, &fds );
-	    // read data
-	    ba = new QByteArray( basize );
-	    n = ::read( fd, ba->data(), basize );
-	    if ( n > 0 ) {
-		ba->resize( n );
-		buffer->append( ba );
-		ba = 0;
-	    } else {
-		delete ba;
-		ba = 0;
-		break;
-	    }
+    pollfd pfd;
+    pfd.fd = fd;
+    pfd.events = POLLIN;
+    while (qt_safe_poll(&pfd, 1, 0)) {
+	// read data
+	ba = new QByteArray( basize );
+	n = ::read( fd, ba->data(), basize );
+	if ( n > 0 ) {
+	    ba->resize( n );
+	    buffer->append( ba );
+	    ba = 0;
+	} else {
+	    delete ba;
+	    ba = 0;
+	    break;
 	}
     }
 
diff -rau qt-everywhere-opensource-src-4.8.6/src/testlib/3rdparty/cycle_p.h qt-adsk-4.8.6/src/testlib/3rdparty/cycle_p.h
--- qt-everywhere-opensource-src-4.8.6/src/testlib/3rdparty/cycle_p.h	2014-04-11 02:37:12.000000000 +0800
+++ qt-adsk-4.8.6/src/testlib/3rdparty/cycle_p.h	2014-05-06 04:23:10.000000000 +0800
@@ -23,7 +23,7 @@
  *
  */
 
-/* $Id: cycle.h,v 1.52 2006-02-08 02:36:47 athena Exp $ */
+/* $Id: //depot/external_toolkit_source/Qt/4.8.2/src/testlib/3rdparty/cycle_p.h#1 $ */
 
 /* machine-dependent cycle counters code. Needs to be inlined. */
 
diff -rau qt-everywhere-opensource-src-4.8.6/translations/qt_ja.ts qt-adsk-4.8.6/translations/qt_ja.ts
--- qt-everywhere-opensource-src-4.8.6/translations/qt_ja.ts	2014-04-11 02:37:08.000000000 +0800
+++ qt-adsk-4.8.6/translations/qt_ja.ts	2014-05-06 04:23:10.000000000 +0800
@@ -2544,6 +2544,14 @@
         <translation>削除(&amp;D)</translation>
     </message>
     <message>
+        <source>&amp;Copy</source>
+        <translation>コピー(&amp;C)</translation>
+    </message>
+    <message>
+        <source>&amp;Paste</source>
+        <translation>貼り付け(&amp;P)</translation>
+    </message>
+    <message>
         <source>Show &amp;hidden files</source>
         <translation>隠しファイルの表示(&amp;H)</translation>
     </message>
@@ -5578,19 +5586,19 @@
     </message>
     <message>
         <source>Left</source>
-        <translation>←</translation>
+        <translation>Left</translation>
     </message>
     <message>
         <source>Up</source>
-        <translation>↑</translation>
+        <translation>Up</translation>
     </message>
     <message>
         <source>Right</source>
-        <translation>→</translation>
+        <translation>Right</translation>
     </message>
     <message>
         <source>Down</source>
-        <translation>↓</translation>
+        <translation>Down</translation>
     </message>
     <message>
         <source>PgUp</source>
diff -rau qt-everywhere-opensource-src-4.8.6/translations/qt_zh_CN.ts qt-adsk-4.8.6/translations/qt_zh_CN.ts
--- qt-everywhere-opensource-src-4.8.6/translations/qt_zh_CN.ts	2014-04-11 02:37:08.000000000 +0800
+++ qt-adsk-4.8.6/translations/qt_zh_CN.ts	2014-05-06 04:23:10.000000000 +0800
@@ -1549,6 +1549,14 @@
         <translation>删除(&amp;D)</translation>
     </message>
     <message>
+        <source>&amp;Copy</source>
+        <translation>复制(&amp;C)</translation>
+    </message>
+    <message>
+        <source>&amp;Paste</source>
+        <translation>粘贴(&amp;P)</translation>
+    </message>
+    <message>
         <location line="+1"/>
         <source>Show &amp;hidden files</source>
         <translation>显示隐藏文件(&amp;H)</translation>
