// Copyright (C) 1997-2014 Autodesk, Inc., and/or its licensors.
// All rights reserved.
//
// The coded instructions, statements, computer programs, and/or related
// material (collectively the "Data") in these files contain unpublished
// information proprietary to Autodesk, Inc. ("Autodesk") and/or its licensors,
// which is protected by U.S. and Canadian federal copyright law and by
// international treaties.
//
// The Data is provided for use exclusively by You. You have the right to use,
// modify, and incorporate this Data into other products for purposes authorized 
// by the Autodesk software license agreement, without fee.
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND. AUTODESK
// DOES NOT MAKE AND HEREBY DISCLAIMS ANY EXPRESS OR IMPLIED WARRANTIES
// INCLUDING, BUT NOT LIMITED TO, THE WARRANTIES OF NON-INFRINGEMENT,
// MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE, OR ARISING FROM A COURSE 
// OF DEALING, USAGE, OR TRADE PRACTICE. IN NO EVENT WILL AUTODESK AND/OR ITS
// LICENSORS BE LIABLE FOR ANY LOST REVENUES, DATA, OR PROFITS, OR SPECIAL,
// DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES, EVEN IF AUTODESK AND/OR ITS
// LICENSORS HAS BEEN ADVISED OF THE POSSIBILITY OR PROBABILITY OF SUCH DAMAGES.

//
//  Procedure Name:
//	AEnRigidTemplate
//
//  Description Name;
//	Creates the attribute editor controls for the nRigid Node
//
//  Input Value:
//	nodeName 
//
//  Output Value:
//	None
// 

global proc AEnRigidDimWindDist( string $nodeName )
{
	int $wd = getAttr( $nodeName + ".windShadowDistance" );
	editorTemplate -dimControl $nodeName "windShadowDiffusion" ($wd == 0.0);
}

global proc AEnRigidDimForce( string $nodeName )
{
	int $f = getAttr( $nodeName + ".forceField" );
	editorTemplate -dimControl $nodeName "fieldMagnitude" ($f == 0);
	editorTemplate -dimControl $nodeName "fieldDistance" ($f == 0);
	editorTemplate -dimControl $nodeName "fieldScale" ($f == 0);
}

//global proc AEnRigidDimPointForce( string $nodeName )
//{
//	int $f = getAttr( $nodeName + ".pointForceField" );
//	editorTemplate -dimControl $nodeName "pointFieldMagnitude" ($f == 0);
//	editorTemplate -dimControl $nodeName "pointFieldDistance" ($f == 0);
//	editorTemplate -dimControl $nodeName "pointFieldDropoff" ($f == 0);
//}

global proc AErigidMapTypeCB(string $node, string $attr)
{
	string $mapAttr = ($attr+"Map");
	string $mapTypeAttr = ($node+"."+$attr+"MapType");
	
	int $mapVal = `getAttr $mapTypeAttr`;
	int $enableVal = ($mapVal == 2);
	if (`attrNavigationControlGrp -exists $mapAttr`) {
		attrNavigationControlGrp -edit
			-at ($node+"."+$mapAttr)
			-enable $enableVal
			$mapAttr;
	}
}


proc AEnRigidMapCommon( string $attrName, int $createControlGroup )
//
//	Description
//		Common method called by AEnRigidMapNew & AEnRigidMapReplace.
//
{
	string $label;
	string $attr = `plugAttr $attrName`;

	if( $attr == "thicknessMap" ){
		$label = (uiRes("m_AEnRigidTemplate.kThicknessMap"));
	} else if( $attr == "bounceMap"){
		$label = (uiRes("m_AEnRigidTemplate.kBounceMap"));
	} else if( $attr == "frictionMap"){
		$label = (uiRes("m_AEnRigidTemplate.kFrictionMap"));
	} else if( $attr == "stickinessMap"){
		$label = (uiRes("m_AEnRigidTemplate.kStickinessMap"));
	} else if( $attr == "collideStrengthMap"){
		$label = (uiRes("m_AEnRigidTemplate.kCollideStrengthMap"));
	} else if( $attr == "massMap"){
		$label = (uiRes("m_AEnRigidTemplate.kMassMap"));
	} else if( $attr == "fieldMagnitudeMap"){
		$label = (uiRes("m_AEnRigidTemplate.kFieldMagnitudeMap"));
	} else if( $attr == "dampMap"){
		$label = (uiRes("m_AEnRigidTemplate.kDampMap"));
	} else {
		error((uiRes("m_AEnRigidTemplate.kUnsupportedAttr")));
		return;
	}
	// temporarily deactivate stretchmaps
	int $enabled = ($attr != "stretchMap");

	// Find out if this is an active node
	//
	string $nodeName = `plugNode $attrName`;

	// A mappable attribute is enabled if the node is either active, or the
	// attribute is not strictly for active nodes.
	//
	if( $createControlGroup ){
		// Create the control group
		//
		setUITemplate -pst attributeEditorTemplate;
		// Temporarily disable the stretch map
		//
		attrNavigationControlGrp
				-label $label
				-at $attrName
				-enable $enabled 
				$attr;
		setUITemplate -ppt;
	}

	// enable or disable the navigation group based on the map type
	//
	string $baseAttr = `substring $attr 1 (size($attr)-3)`;
	AErigidMapTypeCB($nodeName,$baseAttr);
}

global proc AEnRigidMapNew (string $attrName )
//
//	Description:
//		This method is called for mappable attributes the first time we
//	need to create UI for an nRigid.
//
{
	AEnRigidMapCommon( $attrName, true );
}

global proc AEnRigidMapReplace (string $attrName )
//
//	Description:
//		This method is called for mappable attributes when a new node of the
//	same type is now being edited.
//
{
	AEnRigidMapCommon( $attrName, false );
}

global proc AErigidThicknessMapCB(string $node)
{
	AErigidMapTypeCB($node,"thickness");
}

global proc AErigidBounceMapCB(string $node)
{
	AErigidMapTypeCB($node,"bounce");
}

global proc AErigidFrictionMapCB(string $node)
{
	AErigidMapTypeCB($node,"friction");
}

global proc AErigidStickinessMapCB(string $node)
{
	AErigidMapTypeCB($node,"stickiness");
}

global proc AErigidCollideStrengthMapCB(string $node)
{
	AErigidMapTypeCB($node,"collideStrength");
}

global proc AErigidFieldMagnitudeMapCB(string $node)
{
	AErigidMapTypeCB($node,"fieldMagnitude");
}

global proc AErigidMassMapCB(string $node)
{
	AErigidMapTypeCB($node,"mass");
}


//
//=========================================================
//  Procedure Name: AEnRigidTemplate
//
global proc AEnRigidTemplate ( string $nodeName )
{

	editorTemplate -beginScrollLayout;
		editorTemplate -label (uiRes("m_AEnRigidTemplate.kEnable"))  -addControl "isDynamic";
		editorTemplate -beginNoOptimize;
		editorTemplate -beginLayout (uiRes("m_AEnRigidTemplate.kCollisions"))  -collapse 0;
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kCollide"))  -addControl "collide";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kCollisionFlag"))  -addControl "collisionFlag";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kCollideStrength"))  -addControl "collideStrength";		
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kCollisionLayer"))  -addControl "collisionLayer";
			editorTemplate -addSeparator;
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kThickness"))  -addControl "thickness";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kSolverDisplay"))  -addControl "solverDisplay";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kDisplayColor"))  -addControl "displayColor";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kBounce"))  -addControl "bounce";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kFriction"))  -addControl "friction";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kStickiness"))  -addControl "stickiness";
			editorTemplate -beginLayout (uiRes("m_AEnRigidTemplate.kCollisionPropertiesMaps"))  -collapse 1;
				editorTemplate -addControl "collideStrengthMapType" "AErigidCollideStrengthMapCB";
				editorTemplate -callCustom "AEnRigidMapNew" "AEnRigidMapReplace" "collideStrengthMap";
				editorTemplate -addControl "thicknessMapType" "AErigidThicknessMapCB";			
				editorTemplate -callCustom "AEnRigidMapNew" "AEnRigidMapReplace" "thicknessMap";
				editorTemplate -addControl "bounceMapType" "AErigidBounceMapCB";
				editorTemplate -callCustom "AEnRigidMapNew" "AEnRigidMapReplace" "bounceMap";
				editorTemplate -addControl "frictionMapType" "AErigidFrictionMapCB";
				editorTemplate -callCustom "AEnRigidMapNew" "AEnRigidMapReplace" "frictionMap";
				editorTemplate -addControl "stickinessMapType" "AErigidStickinessMapCB";
				editorTemplate -callCustom "AEnRigidMapNew" "AEnRigidMapReplace" "stickinessMap";
			editorTemplate -endLayout;		
		editorTemplate -endLayout;
		
		editorTemplate -beginLayout (uiRes("m_AEnRigidTemplate.kForceFieldEmission"))  -collapse 1;
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kForceField"))  -addControl "forceField" "AEnRigidDimForce";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kFieldMagnitude"))  -addControl "fieldMagnitude";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kFieldDistance"))  -addControl "fieldDistance";
			AEaddRampControl ($nodeName+".fieldScale");
			// The point field is minimally useful on the nRigid node so it is not presented in the attribute editor currently
	//		editorTemplate -label _L10N( kPointForceField, "Point Force Field" )  -addControl "pointForceField" "AEnRigidDimPointForce";
	//		editorTemplate -label _L10N( kPointFieldMagnitude, "Point Field Magnitude" )  -addControl "pointFieldMagnitude";
	//		editorTemplate -label _L10N( kPointFieldDistance, "Point Field Distance" )  -addControl "pointFieldDistance";
	//		AEaddRampControl ($nodeName+".pointFieldDropoff");
			editorTemplate -beginLayout (uiRes("m_AEnRigidTemplate.kForceFieldMaps"))  -collapse 1;
				editorTemplate -addControl "fieldMagnitudeMapType" "AErigidFieldMagnitudeMapCB";
				editorTemplate -callCustom "AEnRigidMapNew" "AEnRigidMapReplace" "fieldMagnitudeMap";
			editorTemplate -endLayout;
		editorTemplate -endLayout;
		
		editorTemplate -beginLayout (uiRes("m_AEnRigidTemplate.kWindFieldGeneration"))  -collapse 1;
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kAirPushDistance"))  -addControl "airPushDistance";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kAirPushVorticity"))  -addControl "airPushVorticity";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kShadowDropoff"))  -addControl "windShadowDistance";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kShadowDiffusion"))  -addControl "windShadowDiffusion";
		editorTemplate -endLayout;		
		
		// for now these are not needed
		editorTemplate -suppress "numSubdivisions";
		editorTemplate -suppress "selfAttract";
		editorTemplate -suppress "pointCollideCore";
		editorTemplate -suppress "damp";
		editorTemplate -suppress "dampMap";
		editorTemplate -suppress "thicknessMapType";
		editorTemplate -suppress "bounceMapType";
		editorTemplate -suppress "frictionMapType";
		editorTemplate -suppress "stickinessMapType";
		editorTemplate -suppress "collideStrengthMapType";
		editorTemplate -suppress "massMapType";
		editorTemplate -suppress "fieldMagnitudeMapType";
		editorTemplate -suppress "cdampMapType";		
		editorTemplate -suppress "thicknessPerVertex";
		editorTemplate -suppress "bouncePerVertex";
		editorTemplate -suppress "frictionPerVertex";
		editorTemplate -suppress "stickinessPerVertex";
		editorTemplate -suppress "collideStrengthPerVertex";
		editorTemplate -suppress "fieldMagnitudePerVertex";
		editorTemplate -suppress "dampPerVertex";
		editorTemplate -suppress "massPerVertex";
		editorTemplate -suppress "maxSelfCollisionIterations";
		editorTemplate -suppress "maxIterations";
		editorTemplate -suppress "pointMass";
		editorTemplate -suppress "selfCollide";
		editorTemplate -suppress "dampMapType";

		editorTemplate -beginLayout (uiRes("m_AEnRigidTemplate.kQualitySettings"))  -collapse 1;
			editorTemplate -suppress "numDampingIterations";

			editorTemplate -label (uiRes("m_AEnRigidTemplate.kTrappedCheck"))  -addControl "trappedCheck";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kPushOut"))  -addControl "pushOut";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kPushOutRadius"))  -addControl "pushOutRadius";
			editorTemplate -label (uiRes("m_AEnRigidTemplate.kCrossoverPush"))  -addControl "crossoverPush";

			editorTemplate -suppress "selfCollisionFlag";
			editorTemplate -suppress "numSelfCollisionIterations";
			editorTemplate -suppress "numSelfCollisionSubcycles";
			editorTemplate -suppress "restLengthScale";
			editorTemplate -suppress "localSpaceOutput";
			editorTemplate -suppress "mass";
			editorTemplate -suppress "massMap";

		editorTemplate -endLayout;
		editorTemplate -endNoOptimize;
		
		editorTemplate -endLayout;
		editorTemplate -suppress "active";
		editorTemplate -suppress "nextState";
		editorTemplate -suppress "inputMesh";
		editorTemplate -suppress "playFromCache";

		// remove after beta 2
		editorTemplate -suppress "displayThickness";
		editorTemplate -suppress "sphereTree";

		// Attributes to control time in the solver.
		editorTemplate -beginLayout (uiRes("m_AEnRigidTemplate.kTimeAttributes"))  -collapse true;
			editorTemplate -addControl "startFrame";
			editorTemplate -addControl "currentTime";
		editorTemplate -endLayout;

		// mental ray override per shape
		editorTemplate -suppress mentalRayControls;

		// particle attributes to suppress

		// Suppress this attribute until we implement it 
		// later in the Volume Controls stage
		editorTemplate -suppress "normalizeVelocity";

		// Suppress attributes so they don't appear under "Extras."
		//
		editorTemplate -suppress "cacheWidth";
		editorTemplate -suppress "inheritColor";
		editorTemplate -suppress "age";
		editorTemplate -suppress "particleId";
		editorTemplate -suppress "idQuery";
		editorTemplate -suppress "attributeQuery";
		editorTemplate -suppress "levelOfDetail";
		editorTemplate -suppress "shapeNameMsg";
		editorTemplate -suppress "event";
		editorTemplate -suppress "eventCount";
		editorTemplate -suppress "eventTest";
		editorTemplate -suppress "centroid";
		editorTemplate -suppress "opacityPP";
		editorTemplate -suppress "lifespanPP";
		editorTemplate -suppress "rgbPP";
		editorTemplate -suppress "goalPP";
		editorTemplate -suppress "ageNormalized";
		editorTemplate -suppress "expressionsAfterDynamics";
		editorTemplate -suppress "seed";
		editorTemplate -suppress "useLifespanPP";

		editorTemplate -suppress "collisionData";
		editorTemplate -suppress "collisionResilience";
		editorTemplate -suppress "collisionFriction";
		editorTemplate -suppress "traceDepth";
		editorTemplate -suppress "goalGeometry";
		editorTemplate -suppress "goalActive";
		editorTemplate -suppress "goalSmoothness";

		editorTemplate -suppress "inputGeometry";
		editorTemplate -suppress "inputGeometrySpace";
		editorTemplate -suppress "enforceCountFromHistory";
		editorTemplate -suppress "targetGeometrySpace";
		editorTemplate -suppress "targetGeometryWorldMatrix";
	
		editorTemplate -suppress "goalPP0";
		editorTemplate -suppress "goalPPCache";
		editorTemplate -suppress "opacityPP0";
		editorTemplate -suppress "opacityPPCache";
		editorTemplate -suppress "rgbPP0";
		editorTemplate -suppress "rgbPPCache";
		editorTemplate -suppress "lifespanPP0";
		editorTemplate -suppress "lifespanPPCache";
		editorTemplate -suppress "input";
		editorTemplate -suppress "output";
		editorTemplate -suppress "nextId";
		editorTemplate -suppress "nextId0";
		editorTemplate -suppress "currentSceneTime";
		editorTemplate -suppress "lastSceneTime";
		editorTemplate -suppress "inputForce";
		editorTemplate -suppress "goalWeight";
		editorTemplate -suppress "goalStatus";
		editorTemplate -suppress "age0";
		editorTemplate -suppress "particleId0";
		editorTemplate -suppress "mass";
		editorTemplate -suppress "eventSeed";
		editorTemplate -suppress "eventRandState";
		editorTemplate -suppress "eventRandStateX";
		editorTemplate -suppress "eventRandStateY";
		editorTemplate -suppress "eventRandStateZ";
		editorTemplate -suppress "eventCountCache";
		editorTemplate -suppress "eventName";
		editorTemplate -suppress "eventValid";
		editorTemplate -suppress "eventCount";
		editorTemplate -suppress "eventEmit";
		editorTemplate -suppress "eventSplit";
		editorTemplate -suppress "eventDie";
		editorTemplate -suppress "eventRandom";
		editorTemplate -suppress "eventSpread";
		editorTemplate -suppress "eventProc";
		editorTemplate -suppress "traceDepthPP";
		editorTemplate -suppress "currentTimeSave";
		editorTemplate -suppress "useStartupCache";
		editorTemplate -suppress "startupCachePath";
		editorTemplate -suppress "startupCacheFrame";
	
		// suppress any rendering attributes
		//
		editorTemplate -suppress "spriteNumPP";
		editorTemplate -suppress "spriteScaleXPP";
		editorTemplate -suppress "spriteScaleYPP";
		editorTemplate -suppress "spriteTwistPP";
		editorTemplate -suppress "radiusPP";
		editorTemplate -suppress "incandescencePP";

		// suppress the instancing attributes
		//
		editorTemplate -suppress "instanceData";
		editorTemplate -suppress "instanceAttributeMapping";
		editorTemplate -suppress "instancePointData";

		// suppress the sprite attributes
		//
		editorTemplate -suppress "__ApplySprite__";
		editorTemplate -suppress "startIndexPP";
		editorTemplate -suppress "spriteNumRamp";
		editorTemplate -suppress "spriteNumRampU";
		editorTemplate -suppress "worldVelocityInObjectSpace";

		// include/call base class/node attributes
		// actually these are now in the particle shape
		// AEdynObjectInclude $nodeName;

		// Suppress the dynamic attributes for the fireworks clip effect,
		// as the appropriate ones will be put in a special layout.
		//
		editorTemplate -suppress "_fireworksRocket";
		editorTemplate -suppress "fireworksColors";
		editorTemplate -suppress "rocketTrailColors";
		editorTemplate -suppress "launchPositionManipMessage";
		editorTemplate -suppress "burstPositionManipMessage";
		editorTemplate -suppress "minSparksCount";
		editorTemplate -suppress "maxSparksCount";
		editorTemplate -suppress "sparksColorSpread";
		editorTemplate -suppress "maxBurstSpeed";
		editorTemplate -suppress "rocketGravity";
		editorTemplate -suppress "launchPositionPP";
		editorTemplate -suppress "burstPositionPP";
		editorTemplate -suppress "launchFramePP";
		editorTemplate -suppress "burstFramePP";
		editorTemplate -suppress "initialVelocity";
		editorTemplate -suppress "launched";
		editorTemplate -suppress "hasBurst";
		editorTemplate -suppress "colorPaletteProc";
		editorTemplate -suppress "spin";
		editorTemplate -suppress "showAllBurstPositions";
		editorTemplate -suppress "showAllLaunchPositions";
		editorTemplate -suppress "localGravX";
		editorTemplate -suppress "localGravY";
		editorTemplate -suppress "localGravZ";
		editorTemplate -suppress "burstColorIndex";
		editorTemplate -suppress "explodeChance";
		editorTemplate -suppress "displayGeometry";
		editorTemplate -suppress "spinSpeed";
		editorTemplate -suppress "spinSpread";
		editorTemplate -suppress "rocketsMessage";
		editorTemplate -suppress "deformedPosition";

		// more particle attrs to suppress - those that were not pre-suppressed for us
		editorTemplate -suppress "position";
		editorTemplate -suppress "velocity";
		editorTemplate -suppress "acceleration";
		editorTemplate -suppress "dieOnEmissionVolumeExit";
		editorTemplate -suppress "lifespan";
		editorTemplate -suppress "lifespanMode";
		editorTemplate -suppress "lifespanRandom";
		editorTemplate -suppress "dynamicsWeight";
		editorTemplate -suppress "forcesInWorld";
		editorTemplate -suppress "conserve";
		editorTemplate -suppress "emissionInWorld";
		editorTemplate -suppress "maxCount";
		editorTemplate -suppress "inheritFactor";
		editorTemplate -suppress "cacheData";
		editorTemplate -suppress "depthSort";
		editorTemplate -suppress "particleRenderType";

		// suppress pointfield attributes
		editorTemplate -suppress "pointForceField";
		editorTemplate -suppress "pointFieldMagnitude";
		editorTemplate -suppress "selfAttract";
		editorTemplate -suppress "pointFieldDistance";
		editorTemplate -suppress "pointFieldDropoff";

		AEshapeTemplate $nodeName;
	
		// suppress all the surface and geometry shape attrs
			editorTemplate -suppress "ignoreSelfShadowing";
			editorTemplate -suppress "controlPoints";
			editorTemplate -suppress "weights";
			editorTemplate -suppress "tweak";
			editorTemplate -suppress "relativeTweak";
			editorTemplate -suppress "currentUVSet";
			editorTemplate -suppress "uvSet";
			editorTemplate -suppress "compInstObjGroups";
			editorTemplate -suppress "smoothShading";
			editorTemplate -suppress "castsShadows";
			editorTemplate -suppress "receiveShadows";
			editorTemplate -suppress "motionBlur";
			editorTemplate -suppress "primaryVisibility";
			editorTemplate -suppress "visibleInReflections";
			editorTemplate -suppress "visibleInRefractions";
			editorTemplate -suppress "doubleSided";
        	editorTemplate -suppress "opposite";
			editorTemplate -suppress "geometryAntialiasingOverride";
			editorTemplate -suppress "antialiasingLevel";
			editorTemplate -suppress "shadingSamplesOverride";
			editorTemplate -suppress "shadingSamples";
			editorTemplate -suppress "maxShadingSamples";
			editorTemplate -suppress "volumeSamplesOverride";
			editorTemplate -suppress "volumeSamples";
			editorTemplate -suppress "depthJitter";
			editorTemplate -suppress "maxVisibilitySamplesOverride";
			editorTemplate -suppress "maxVisibilitySamples";
			editorTemplate -suppress "boundingBoxScale"; 
			editorTemplate -suppress "featureDisplacement";
			editorTemplate -suppress "initialSampleRate";
			editorTemplate -suppress "extraSampleRate";
			editorTemplate -suppress "textureThreshold";
			editorTemplate -suppress "normalThreshold";
			editorTemplate -suppress "displayImmediate";

		editorTemplate -addExtraControls;

	editorTemplate -endScrollLayout;
}
