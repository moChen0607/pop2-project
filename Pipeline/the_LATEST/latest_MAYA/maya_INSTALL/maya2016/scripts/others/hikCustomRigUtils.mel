// Copyright (C) 1997-2014 Autodesk, Inc., and/or its licensors.
// All rights reserved.
//
// The coded instructions, statements, computer programs, and/or related
// material (collectively the "Data") in these files contain unpublished
// information proprietary to Autodesk, Inc. ("Autodesk") and/or its licensors,
// which is protected by U.S. and Canadian federal copyright law and by
// international treaties.
//
// The Data is provided for use exclusively by You. You have the right to use,
// modify, and incorporate this Data into other products for purposes authorized 
// by the Autodesk software license agreement, without fee.
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND. AUTODESK
// DOES NOT MAKE AND HEREBY DISCLAIMS ANY EXPRESS OR IMPLIED WARRANTIES
// INCLUDING, BUT NOT LIMITED TO, THE WARRANTIES OF NON-INFRINGEMENT,
// MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE, OR ARISING FROM A COURSE 
// OF DEALING, USAGE, OR TRADE PRACTICE. IN NO EVENT WILL AUTODESK AND/OR ITS
// LICENSORS BE LIABLE FOR ANY LOST REVENUES, DATA, OR PROFITS, OR SPECIAL,
// DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES, EVEN IF AUTODESK AND/OR ITS
// LICENSORS HAS BEEN ADVISED OF THE POSSIBILITY OR PROBABILITY OF SUCH DAMAGES.

// 
// hikCustomRigUtils.mel
//
// Description:
//		Utility methods for HIK Custom Rigs. Should not contain
//		any UI code. All code that references UI or triggers UI
//		updates should live in hikCustomRigUI.mel or 
//		hikCustomRigOperations.mel
//


// For the named character, determine the number of connections to attributes with a given prefix.
// This is used to determine the number of spine/neck links on the active character.
// TODO: rename this method
global proc int hikGetCharacterizedLinkCount( string $character, string $prefix )
{
	int $count = 0;

	string $a, $attrs[] = `listAttr $character`;
	for ( $a in $attrs )
		if ( startsWith( $a, $prefix ) && size( `listConnections ( $character + "." + $a )` ) )
			$count++;

	return $count;
}

// Map ids returned by the UI to a name
global proc string hikCustomRigElementNameFromId( string $character, int $id )
{
	if ( $id < 0 )
		return "";

	if ( $id < hikGetNodeCount() ) 
		return GetHIKNodeName( $id );

	// Any ID greater that hikGetNodeCount ( 172 ) has a special meaning and 
	// requires some additional processsing.
	switch( $id )
	{
		case 1000: // ID 1000 always points to the last spine on the current character
			string $prefix = "Spine";
			int $count = hikGetCharacterizedLinkCount( $character, $prefix );
			return ( ( $count > 1 ) ? ( $prefix + ( $count-1 ) ) : ( $prefix ) );

		default:
			return "";
	}
}

//
// Determine the type of the element with a specified id.
//
global proc string hikCustomRigElementTypeFromId( int $id )
{
	int $inx = intArrayFind( $id, 0, `hikCustomRigToolWidget -q -ids` );
	if ( $inx == -1 )
		return "";

	string $types[] = `hikCustomRigToolWidget -q -ts`;
	return ( $types[ $inx ] );
}