// Copyright (C) 1997-2014 Autodesk, Inc., and/or its licensors.
// All rights reserved.
//
// The coded instructions, statements, computer programs, and/or related
// material (collectively the "Data") in these files contain unpublished
// information proprietary to Autodesk, Inc. ("Autodesk") and/or its licensors,
// which is protected by U.S. and Canadian federal copyright law and by
// international treaties.
//
// The Data is provided for use exclusively by You. You have the right to use,
// modify, and incorporate this Data into other products for purposes authorized 
// by the Autodesk software license agreement, without fee.
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND. AUTODESK
// DOES NOT MAKE AND HEREBY DISCLAIMS ANY EXPRESS OR IMPLIED WARRANTIES
// INCLUDING, BUT NOT LIMITED TO, THE WARRANTIES OF NON-INFRINGEMENT,
// MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE, OR ARISING FROM A COURSE 
// OF DEALING, USAGE, OR TRADE PRACTICE. IN NO EVENT WILL AUTODESK AND/OR ITS
// LICENSORS BE LIABLE FOR ANY LOST REVENUES, DATA, OR PROFITS, OR SPECIAL,
// DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES, EVEN IF AUTODESK AND/OR ITS
// LICENSORS HAS BEEN ADVISED OF THE POSSIBILITY OR PROBABILITY OF SUCH DAMAGES.

//
//  Procedure Name:
//      setMayaSoftwareLayers
//
//  Description:
//		Setup the Maya renderer to render only the specified layers
//		and passes.
//      Empty strings means to ignore this option.
//
global proc setMayaSoftwareLayers(string $layers, string $passes)
{
	int $i;
	int $j;
	int $state;
	string $allLayers[] = `listConnections renderLayerManager.renderLayerId`;
	
	// Treat the layers first
	if ($layers != "") {

		if ($layers == "off" || $layers == "false" || $layers == "0") {

			// Set the default layer to renderable, and all others to
			// non-renderable.
			// The subdirectory "defaultRenderLayer" will automatically
			// be created if any render layers (other than the default) exist.
			//
			for( $i=0 ; $i<size($allLayers) ; $i++ ){
				if( $allLayers[$i] == "defaultRenderLayer" ){
					removeRenderLayerAdjustmentAndUnlock ($allLayers[$i]+".renderable");
					catch(`setAttr ($allLayers[$i]+".renderable") true`);
				}else{
					removeRenderLayerAdjustmentAndUnlock ($allLayers[$i]+".renderable");
					catch(`setAttr ($allLayers[$i]+".renderable") false`);
				}
			}
		} else if( !($layers == "on" || $layers == "true" || $layers == "1") ){

			// Assume a list of layers.
			// Turn all layers off, except the ones explicitely named.
			string $selectedLayers[];
			tokenizeList($layers, $selectedLayers);

			// Special case: the internal name for masterLayer is
			// defaultRenderLayer
			for ($j =  0 ; $j<size($selectedLayers) ; $j++)
				if ($selectedLayers[$j] == "masterLayer")
					$selectedLayers[$j] = "defaultRenderLayer";

			for ($i = 0 ; $i<size($allLayers) ; $i++) 
			{
				string $currentLayer = $allLayers[$i];
				removeRenderLayerAdjustmentAndUnlock ($currentLayer+".renderable");

				$state = 0;
				for ($j =  0 ; $j<size($selectedLayers) ; $j++) {
					if ($currentLayer == $selectedLayers[$j]) {
						$state = 1;
						break;
					}
				}
				catch(`setAttr ($currentLayer+".renderable") $state`);
			}
		}
	}

	// Treat the passes
	if ($passes != "") {

		// These will filter down into the last if loop
		if ($passes == "off" || $passes == "false" || $passes == "0") {
			$passes = "beauty";
		}else if( $passes == "all" ){
			$passes = "beauty color ambient diffuse specular shadow";
		}
		if (!($passes == "on" || $passes == "true" || $passes == "1")) {

			// Assume a list of passes.
			// Turn all passes off, except the ones explicitely named.
			string $selectedPasses[];
			tokenizeList($passes, $selectedPasses);
			string $p[] = {"beauty", "color", "ambient",
							"diffuse", "specular", "shadow"};
			for ($i = 0 ; $i<size($p) ; $i++) {
				$state = 0;
				for ($j =  0 ; $j<size($selectedPasses) ; $j++) {
					if ($p[$i] == $selectedPasses[$j]) {
						$state = 1; break;
					}
				}

				for ($j =  0 ; $j<size($allLayers) ; $j++) {
					removeRenderLayerAdjustmentAndUnlock ($allLayers[$j]+"."+$p[$i]);
					catch(`setAttr ($allLayers[$j]+"."+$p[$i]) $state`);
				}
			}
		}
	}
}

