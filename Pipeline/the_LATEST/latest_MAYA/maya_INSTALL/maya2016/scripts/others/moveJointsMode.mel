// Copyright (C) 1997-2014 Autodesk, Inc., and/or its licensors.
// All rights reserved.
//
// The coded instructions, statements, computer programs, and/or related
// material (collectively the "Data") in these files contain unpublished
// information proprietary to Autodesk, Inc. ("Autodesk") and/or its licensors,
// which is protected by U.S. and Canadian federal copyright law and by
// international treaties.
//
// The Data is provided for use exclusively by You. You have the right to use,
// modify, and incorporate this Data into other products for purposes authorized 
// by the Autodesk software license agreement, without fee.
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND. AUTODESK
// DOES NOT MAKE AND HEREBY DISCLAIMS ANY EXPRESS OR IMPLIED WARRANTIES
// INCLUDING, BUT NOT LIMITED TO, THE WARRANTIES OF NON-INFRINGEMENT,
// MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE, OR ARISING FROM A COURSE 
// OF DEALING, USAGE, OR TRADE PRACTICE. IN NO EVENT WILL AUTODESK AND/OR ITS
// LICENSORS BE LIABLE FOR ANY LOST REVENUES, DATA, OR PROFITS, OR SPECIAL,
// DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES, EVEN IF AUTODESK AND/OR ITS
// LICENSORS HAS BEEN ADVISED OF THE POSSIBILITY OR PROBABILITY OF SUCH DAMAGES.

proc templateSkinShape(string $skinCluster, int $state)
{
	string $geoms[] = `skinCluster -q -g $skinCluster`;
	for ($geom in $geoms) {
		toggle -state $state -template $geom;
	}
}

global proc moveJointsMode(int $newState)
{
	string $sel[] = `ls -sl`;
	int $count = 0;
	if ($newState == 0) {
		string $skinClusters[] = `ls -type skinCluster`;
		for ($sc in $skinClusters) {
			skinCluster -e -moveJointsMode 0 $sc;
			templateSkinShape($sc,0);
			$count++;
		}
		if ($count > 0) {
			print( (uiRes("m_moveJointsMode.kSkinningEnabled")));
		}
	} else {
		for ($obj in $sel) {
			string $skinClusters[];
			if ("joint" == nodeType($obj)) {
				$skinClusters = `listConnections -type skinCluster $obj`;
			} else {
				string $relClust = findRelatedSkinCluster($obj);
				if (size($relClust) > 0) {
					$skinClusters[0] = $relClust;
				}
			}
			if (size($skinClusters) == 0) {
				$skinClusters = `ls -type skinCluster`;
			}
			
			for ($sc in $skinClusters) {
				skinCluster -e -moveJointsMode $newState $sc;
				templateSkinShape($sc,1);				
				$count++;
			}
			if ($count > 0) {
				print( (uiRes("m_moveJointsMode.kSkinningDisabled")));
			}
		}
	}
	if (0 == $count) {
		warning( (uiRes("m_moveJointsMode.kNoSkinsFound")));
	}
}
