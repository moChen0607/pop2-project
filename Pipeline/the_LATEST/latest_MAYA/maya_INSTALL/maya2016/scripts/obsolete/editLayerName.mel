// Copyright (C) 1997-2014 Autodesk, Inc., and/or its licensors.
// All rights reserved.
//
// The coded instructions, statements, computer programs, and/or related
// material (collectively the "Data") in these files contain unpublished
// information proprietary to Autodesk, Inc. ("Autodesk") and/or its licensors,
// which is protected by U.S. and Canadian federal copyright law and by
// international treaties.
//
// The Data is provided for use exclusively by You. You have the right to use,
// modify, and incorporate this Data into other products for purposes authorized 
// by the Autodesk software license agreement, without fee.
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND. AUTODESK
// DOES NOT MAKE AND HEREBY DISCLAIMS ANY EXPRESS OR IMPLIED WARRANTIES
// INCLUDING, BUT NOT LIMITED TO, THE WARRANTIES OF NON-INFRINGEMENT,
// MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE, OR ARISING FROM A COURSE 
// OF DEALING, USAGE, OR TRADE PRACTICE. IN NO EVENT WILL AUTODESK AND/OR ITS
// LICENSORS BE LIABLE FOR ANY LOST REVENUES, DATA, OR PROFITS, OR SPECIAL,
// DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES, EVEN IF AUTODESK AND/OR ITS
// LICENSORS HAS BEEN ADVISED OF THE POSSIBILITY OR PROBABILITY OF SUCH DAMAGES.

//
//
// Creation Date:  28 June 1996
//
//
//  Procedure Name:
//      createNewLayer
//
//  Description:
//		This procedure creates a new set, based on the
//		name that the user types in, and adds a menu item
//		the the optionPopup called "layerPopup" that 
//		corresponds to the newly created set/layer.
//
//  Input Arguments:
//      None.
//
//  Return Value:
//      None.
//

proc int isValidName( string $name )
//  Description:
//		This procedure checks if the given string is a valid object
//      name.  It returns true if it is, false otherwise.
//
{
	int $isValid = true;
	// check if name contains invalid characters
	string $regex = "[^0-9a-zA-Z_]";
	string $match = match( $regex, $name );
	if ($match != "") {
		$isValid = false;
		confirmDialog -title "Alert" 
			-button "OK"
			-defaultButton "OK"
			-message "      Name contains illegal characters. Please select another.      ";
	} else {
		// check if name begins with an alphabetic character
		$regex = "[a-zA-Z_][0-9a-zA-Z_]*";
		$match = match( $regex, $name );
		if ($match != $name) {
   			$isValid = false;
			confirmDialog -title "Alert" 
				-button "OK"
				-defaultButton "OK"
			  		-message "      Name is not valid. Please select another.      ";
		}
	}
	return $isValid;
}

global proc editLayerName () {

	// Query the current name of the active layer
	string $currentLayerName = `optionMenu -query -value layerPopup`;

	// If it's not the default universe layer then place dialogue
	if ($currentLayerName != "Universe")
	{
		//
		// Prompt the user for a new layer name
		//
		string $result = `promptDialog 
			-title "Rename Layer"
			-message "Enter New Layer Name:"
			-text $currentLayerName
			-button "OK" 
			-button "Cancel" 
			-defaultButton "OK" 
			-cancelButton "Cancel" 
			-dismissString "Cancel"`;

		//
		// If the result was "OK", then proceed
		//
		if ( $result == "OK" ) {

			//
			// Query the promptDialog for the name the
			// user typed in - note: there is no checking
			// being done for illegal characters, spaces,
			// etc.  This should be added.
			//
			// The set is created in the layer partition 
			// first, then the elements are forced into 
			// the set, so that exclusivity can be maintained,
			// and the set creation won't fail before it's
			// even created.
			//
			string $newLayerName = `promptDialog -q`;

			if ( isValidName($newLayerName) ) {
				if (catch($newLayerName = `rename $currentLayerName $newLayerName`)) {
					//
					// error due to non - unique name for context
					//
					confirmDialog -title "Alert" 
						-button "OK"
						-defaultButton "OK"
						-message "       Error in trying to rename Layer.  Please select another        ";
				}
				else {
					string $layerEntryName = ( $newLayerName + "LayerItem" );
					string $oldLayerEntryName = ( $currentLayerName + "LayerItem" );
		
                    // change the label of the menu item and rename
					// the menu item
                    menuItem -e -l $newLayerName $oldLayerEntryName;
                    renameUI $oldLayerEntryName $layerEntryName;
				}
			}
		}
	} else {
		warning( "Universe layer cannot be renamed" );
	}
}
