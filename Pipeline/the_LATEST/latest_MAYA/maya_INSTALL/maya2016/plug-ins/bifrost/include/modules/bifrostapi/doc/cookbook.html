<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Bifrost Object Model: Cookbook</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bifrost Object Model
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('cookbook.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Cookbook </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#cook_createobjects">How to create Bifrost objects.</a></li>
<li class="level1"><a href="#cook_savebif">How to save to a BIF file</a></li>
<li class="level1"><a href="#cook_loadbif">How to load a BIF file</a></li>
<li class="level1"><a href="#cook_access">How to access the objects loaded from a BIF file</a></li>
<li class="level1"><a href="#cook_createtiletree">How to create and populate a new tile tree</a></li>
<li class="level1"><a href="#cook_refine_sphere">Tile tree created with refinement.</a></li>
<li class="level1"><a href="#cook_iteratetiletree">Iterating a tile tree sequentially</a></li>
<li class="level1"><a href="#cook_iterate_children_tiles">Iterating over tile children.</a></li>
<li class="level1"><a href="#cook_iteratetiletree_parallel">High performance iteration of a tile tree</a></li>
<li class="level1"><a href="#cook_interpolation">Tile interpolation</a></li>
<li class="level1"><a href="#cook_addelements">Adding particle elements</a></li>
<li class="level1"><a href="#cook_removeelements">Removing particle elements</a></li>
<li class="level1"><a href="#cook_dictionary">Creating and accessing dictionary objects</a></li>
</ul>
</div>
<div class="textblock"><p>This section provides code snippets to illustrate the use of the Bifrost API and how to perform common tasks.</p>
<h1><a class="anchor" id="cook_createobjects"></a>
How to create Bifrost objects.</h1>
<p>The following demonstrates the use of the StateServer class to create Bifrost objects such as Channels and Layouts. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__object_8h.html">bifrostapi/bifrost_object.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__component_8h.html">bifrostapi/bifrost_component.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__pointchannel_8h.html">bifrostapi/bifrost_pointchannel.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__voxelchannel_8h.html">bifrostapi/bifrost_voxelchannel.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__layout_8h.html">bifrostapi/bifrost_layout.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__types_8h.html">bifrostapi/bifrost_types.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__status_8h.html">bifrostapi/bifrost_status.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Create a StateServer object. A state server acts as an object factory and object repository.</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ss = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#a278173e8be1475c461e314d35d67c73f">createStateServer</a>( );</div>
<div class="line">    </div>
<div class="line"><span class="comment">// Create an instance of type Object.</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object.html">Object</a> <span class="keywordtype">object</span> = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#aadb8d149abf90146165a93d79d25e85d">createObject</a>( <span class="stringliteral">&quot;MyObjectType&quot;</span>, <span class="stringliteral">&quot;MyObject&quot;</span> );</div>
<div class="line"></div>
<div class="line"><span class="comment">// Create an instance of type Layout.</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html">Layout</a> layout = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a80ac3f765880dd27c17cf158f31f02bc">createLayout</a>( <span class="stringliteral">&quot;MyLayout&quot;</span> );</div>
<div class="line"></div>
<div class="line"><span class="comment">// Create an instance of type Point component.</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> point = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#ab183fe1fae6661fd2b295eeb5893e79b">createComponent</a>( <a class="code" href="group__types.html#gad10ada2cc38f12bc0877ba2255830a55">PointComponentType</a>, <span class="stringliteral">&quot;MyPoint&quot;</span>, layout );</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add component &#39;MyPoint&#39; to object &#39;MyObject</span></div>
<div class="line"><span class="keywordtype">object</span>.addComponent( point );</div>
<div class="line"></div>
<div class="line"><span class="comment">// Create an instance of type Voxel component.</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> voxel = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#ab183fe1fae6661fd2b295eeb5893e79b">createComponent</a>( <a class="code" href="group__types.html#gaa48d105af85aac2d1ed2c722dee14c68">VoxelComponentType</a>, <span class="stringliteral">&quot;MyVoxel&quot;</span>, layout );</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add component &#39;MyVoxel&#39; to object &#39;MyObject</span></div>
<div class="line"><span class="keywordtype">object</span>.addComponent( voxel );</div>
<div class="line"></div>
<div class="line"><span class="comment">// Create an instance of type Channel FloatV3Type parented to a point component.</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_point_channel.html">PointChannel</a> v3fch = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a96c1496e423a15722bd2af37e860132a">createChannel</a>( point, <a class="code" href="namespace_bifrost_1_1_a_p_i.html#a09825962d4b39d95f8e2e7132a7c9390a40c543739f58fada36b52f02b28fd249">FloatV3Type</a>, <span class="stringliteral">&quot;MyV3FloatChannel&quot;</span> );</div>
<div class="line"></div>
<div class="line"><span class="comment">// Create an instance of type Channel FloatType parented to a voxel component.</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_voxel_channel.html">VoxelChannel</a> fch = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a96c1496e423a15722bd2af37e860132a">createChannel</a>( voxel, <a class="code" href="namespace_bifrost_1_1_a_p_i.html#a09825962d4b39d95f8e2e7132a7c9390adbad07899df7b3551edf86cae15a9e86">FloatType</a>, <span class="stringliteral">&quot;MyFloatChannel&quot;</span> );</div>
</div><!-- fragment --><h1><a class="anchor" id="cook_savebif"></a>
How to save to a BIF file</h1>
<p>To save a component in a <a class="el" href="namespace_b_i_f.html" title="The BIF namespace defines a region where all types, functions and classes related to BIF file operati...">BIF</a> file you call the save method on the <a class="el" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html" title="The FileIO class provides methods for saving and loading BIF files. Instances of FileIO are created w...">Bifrost::API::FileIO</a> class. </p><div class="fragment"><div class="line"><span class="comment">// Example to illustrate how to save a component to a BIF file.</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__fileio_8h.html">bifrostapi/bifrost_fileio.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__component_8h.html">bifrostapi/bifrost_component.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__channel_8h.html">bifrostapi/bifrost_channel.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__types_8h.html">bifrostapi/bifrost_types.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__status_8h.html">bifrostapi/bifrost_status.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__array_8h.html">bifrostapi/bifrost_array.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__string_8h.html">bifrostapi/bifrost_string.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__ref_8h.html">bifrostapi/bifrost_ref.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// create the component and channel to save</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ss = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#a278173e8be1475c461e314d35d67c73f">createStateServer</a>();</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> comp = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#ab183fe1fae6661fd2b295eeb5893e79b">createComponent</a>( <a class="code" href="group__types.html#gaa48d105af85aac2d1ed2c722dee14c68">VoxelComponentType</a>, <span class="stringliteral">&quot;voxel&quot;</span> );</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_channel.html">Channel</a> ch = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a96c1496e423a15722bd2af37e860132a">createChannel</a>( comp, <a class="code" href="namespace_bifrost_1_1_a_p_i.html#a09825962d4b39d95f8e2e7132a7c9390adbad07899df7b3551edf86cae15a9e86">FloatType</a>, <span class="stringliteral">&quot;voxel-channel&quot;</span> );</div>
<div class="line"></div>
<div class="line"><span class="comment">// get the FileIO object</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html">FileIO</a> fio = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#aa9fe3c951ce3b237e810caaa8b0fb900">createFileIO</a>( <span class="stringliteral">&quot;test.@@@@.bif&quot;</span> );</div>
<div class="line"></div>
<div class="line"><span class="comment">// Save with level1 compression at frame 5</span></div>
<div class="line"><span class="comment">// Note: the content will be saved under &#39;test.0005.bif&#39;</span></div>
<div class="line">fio.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html#adfa8ca71d809fd1ec2e51fce1bc2f9f5">save</a>( comp, <a class="code" href="namespace_bifrost_1_1_a_p_i_1_1_b_i_f.html#ab56d14b2966fefa047dbb0315f4294c5a07c54a9cc746c2f1dde57533ef6256ee">BIF::Compression::Level1</a>, 5 );  </div>
</div><!-- fragment --><h1><a class="anchor" id="cook_loadbif"></a>
How to load a BIF file</h1>
<p>To load a <a class="el" href="namespace_b_i_f.html" title="The BIF namespace defines a region where all types, functions and classes related to BIF file operati...">BIF</a> file you call the load method on the <a class="el" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html" title="The FileIO class provides methods for saving and loading BIF files. Instances of FileIO are created w...">Bifrost::API::FileIO</a> class. The load method returns a <a class="el" href="class_bifrost_1_1_a_p_i_1_1_state_server.html" title="The StateServer class. The Bifrost State Server is a specialized storage service. It provides ways of...">Bifrost::API::StateServer</a> object which you can use to browse the objects contained in the file. </p><div class="fragment"><div class="line"><span class="comment">// Create a new state server populated with the objects loaded from a BIF file.</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__fileio_8h.html">bifrostapi/bifrost_fileio.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__component_8h.html">bifrostapi/bifrost_component.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__layout_8h.html">bifrostapi/bifrost_layout.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__types_8h.html">bifrostapi/bifrost_types.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__status_8h.html">bifrostapi/bifrost_status.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__array_8h.html">bifrostapi/bifrost_array.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__string_8h.html">bifrostapi/bifrost_string.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__ref_8h.html">bifrostapi/bifrost_ref.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html">FileIO</a> fio = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#aa9fe3c951ce3b237e810caaa8b0fb900">createFileIO</a>( <span class="stringliteral">&quot;whale_dad_jump-volume.1.bif&quot;</span> );</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ss = fio.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html#a62c66b6e15787b2e9b13d24b826ac0b5">load</a>( );</div>
<div class="line"><span class="keywordflow">if</span> ( ss ) {</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html">RefArray</a> components = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#afd7248d0153c30e113804798e3a74712">components</a>();</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> component = components[0];</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html">Layout</a> layout = component.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html#a1a0e8b6b0864023caa8b2dd789c1fcdb">layout</a>();</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html">RefArray</a> channels = component.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html#a48d0717095f69926e5b529a0fe9cd4d8">channels</a>();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Component count: &quot;</span> &lt;&lt; components.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html#ab9d55aa60c1457911682c881aa6540a2">count</a>();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Component: &quot;</span> &lt;&lt; component.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_base.html#affd8e8c1fd5ec5ad9844868bbe5ecf0e">name</a>();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Layout: &quot;</span> &lt;&lt; layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_base.html#affd8e8c1fd5ec5ad9844868bbe5ecf0e">name</a>();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Channel count: &quot;</span> &lt;&lt; channels.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html#ab9d55aa60c1457911682c881aa6540a2">count</a>();</div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> i=0; i&lt;channels.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html#ab9d55aa60c1457911682c881aa6540a2">count</a>(); i++ ) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Channel: &quot;</span> &lt;&lt; <a class="code" href="class_bifrost_1_1_a_p_i_1_1_base.html">Base</a>(channels[i]).<a class="code" href="class_bifrost_1_1_a_p_i_1_1_base.html#affd8e8c1fd5ec5ad9844868bbe5ecf0e">name</a>() &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="cook_access"></a>
How to access the objects loaded from a BIF file</h1>
<p>This snippet shows how you can access the tile data of a channel loaded from a <a class="el" href="namespace_b_i_f.html" title="The BIF namespace defines a region where all types, functions and classes related to BIF file operati...">BIF</a> file. The tile tree is iterated with the <a class="el" href="class_bifrost_1_1_a_p_i_1_1_layout.html" title="The Layout class. All the Channels in a Component have the same Layout. A Layout indicates exactly ho...">Bifrost::API::Layout</a> object. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__channel_8h.html">bifrostapi/bifrost_channel.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__component_8h.html">bifrostapi/bifrost_component.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__layout_8h.html">bifrostapi/bifrost_layout.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__fileio_8h.html">bifrostapi/bifrost_fileio.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__status_8h.html">bifrostapi/bifrost_status.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__array_8h.html">bifrostapi/bifrost_array.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__string_8h.html">bifrostapi/bifrost_string.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__ref_8h.html">bifrostapi/bifrost_ref.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// load a particle BIF file</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html">FileIO</a> fio = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#aa9fe3c951ce3b237e810caaa8b0fb900">createFileIO</a>(<span class="stringliteral">&quot;particles.bif&quot;</span>);</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ss = fio.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html#a62c66b6e15787b2e9b13d24b826ac0b5">load</a>();</div>
<div class="line"><span class="keywordflow">if</span> ( ss ) {</div>
<div class="line">    <span class="comment">// iterate over the position channel found in the file</span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> component = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#afd7248d0153c30e113804798e3a74712">components</a>()[0];</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_channel.html">Channel</a> ch = component.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html#a65765bc3aa8120046758d7864e2c0769">findChannel</a>( <span class="stringliteral">&quot;voxel_liquid-particle/position&quot;</span> );</div>
<div class="line"></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;position channel data type: &quot;</span> &lt;&lt; ch.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_channel.html#ae5942282a974fbb40b3cd4ffd45423e0">dataType</a>() &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// iterate over the tile tree at each level</span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html">Layout</a> layout = component.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html#a1a0e8b6b0864023caa8b2dd789c1fcdb">layout</a>();</div>
<div class="line">    <span class="keywordtype">size_t</span> depthCount = layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#a488887ff71dc4fc465896431af999216">depthCount</a>();</div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> d=0; d&lt;depthCount; d++ ) {</div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> t=0; t&lt;layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#abbedeb446d504fceee2a8fc90ac1634b">tileCount</a>(d); t++ ) {</div>
<div class="line">            <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html">TreeIndex</a> tindex(t,d);</div>
<div class="line">            <span class="keywordflow">if</span> ( !ch.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_channel.html#a2d539ea40e77d415c292179785d3deb1">elementCount</a>( tindex ) ) {</div>
<div class="line">                <span class="comment">// nothing there</span></div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;tile:&quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot; depth:&quot;</span> &lt;&lt; d &lt;&lt; std::endl;</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data.html">TileData&lt;amino::Math::vec3f&gt;</a>&amp; f3 = ch.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_channel.html#ac6f9314b893e9a2bb769d21bb7af35a0">tileData</a>&lt;amino::Math::vec3f&gt;( tindex );</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;f3.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data.html#af220aead23f03df859936cd6a4b1a8e1">count</a>(); i++ ) {</div>
<div class="line">                <span class="keyword">const</span> amino::Math::vec3f&amp; val = f3[i];</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; val[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; val[1] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; val[2] &lt;&lt; std::endl;</div>
<div class="line">            }</div>
<div class="line">            std::cout &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="cook_createtiletree"></a>
How to create and populate a new tile tree</h1>
<p>This example illustrates how a tile tree can be created and populated with the <a class="el" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html" title="The TileAccessor class can be used for optimized node access and node creation. Internally it caches ...">Bifrost::API::TileAccessor</a> object. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tileaccessor_8h.html">bifrostapi/bifrost_tileaccessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__layout_8h.html">bifrostapi/bifrost_layout.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__component_8h.html">bifrostapi/bifrost_component.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tileiterator_8h.html">bifrostapi/bifrost_tileiterator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__const_8h.html">bifrostapi/bifrost_const.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tile_8h.html">bifrostapi/bifrost_tile.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// creates a voxel component and its layout</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ss = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#a278173e8be1475c461e314d35d67c73f">createStateServer</a>();</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> vcomp = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#ab183fe1fae6661fd2b295eeb5893e79b">createComponent</a>( <a class="code" href="group__types.html#gaa48d105af85aac2d1ed2c722dee14c68">VoxelComponentType</a>, <span class="stringliteral">&quot;volume&quot;</span> );</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html">Layout</a> layout = vcomp.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html#a1a0e8b6b0864023caa8b2dd789c1fcdb">layout</a>();</div>
<div class="line"></div>
<div class="line"><span class="comment">// create the root of the tile tree </span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html">TileAccessor</a> tacc = layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#adcf8f9c32b5f21041f66d981a69cd01b">tileAccessor</a>();</div>
<div class="line"><a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html">TreeIndex</a> root = tacc.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html#a5c422aa169f9e806b0c5af9f281c31d9">addRoot</a>();</div>
<div class="line"><a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html">TileInfo</a> tinfo = tacc.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html#ac530e2806751c173b59d3388ca92d8f9">tileInfo</a>(root);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Get the tile and voxel width to compute the data</span></div>
<div class="line"><a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html">TileDimInfo</a> dinfo = layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#abea38bd4d31ffb7ed72d70b7686d74e3">tileDimInfo</a>(tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a0df5d700e3f8a156dd238f9fef1340f3">depth</a>);</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> tw = dinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html#a7c53784f8abf4fc37c79c28325b2f820">tileWidth</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Set the tile data and add a child tile at every location of a tile data </span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> lk=0; lk&lt;tw; ++lk) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> lj=0; lj&lt;tw; ++lj) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> li=0; li&lt;tw; ++li) {</div>
<div class="line">            <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html">TreeIndex</a> newTileIndex = tacc.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html#ac7e6cc852accf0f86d0093594f48b789">addTile</a>(  tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a100d0b2515ff65a393605a79a05232f4">i</a> + dinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html#a0c7f30c29bee97c269ee31c56fcb7103">voxelWidth</a>*li, </div>
<div class="line">                                                    tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a2199635a0e3c305a8089bd9693748472">j</a> + dinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html#a0c7f30c29bee97c269ee31c56fcb7103">voxelWidth</a>*lj, </div>
<div class="line">                                                    tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#afc252738c6494090285acf8f25fdd8c3">k</a> + dinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html#a0c7f30c29bee97c269ee31c56fcb7103">voxelWidth</a>*lk, </div>
<div class="line">                                                    tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a0df5d700e3f8a156dd238f9fef1340f3">depth</a>+1 );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="cook_refine_sphere"></a>
Tile tree created with refinement.</h1>
<p>In this example we compute a sphere by using hierarchical refinement starting from the root of a tree. A refinement constant will ensure uniform refinement everywhere.</p>
<p><b>Note:</b> The higher refinement value is the higher the number of tiles created will be.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__object_8h.html">bifrostapi/bifrost_object.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__component_8h.html">bifrostapi/bifrost_component.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__voxelchannel_8h.html">bifrostapi/bifrost_voxelchannel.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tile_8h.html">bifrostapi/bifrost_tile.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tileaccessor_8h.html">bifrostapi/bifrost_tileaccessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tiledataaccessor_8h.html">bifrostapi/bifrost_tiledataaccessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__layout_8h.html">bifrostapi/bifrost_layout.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__types_8h.html">bifrostapi/bifrost_types.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__const_8h.html">bifrostapi/bifrost_const.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__status_8h.html">bifrostapi/bifrost_status.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>Sphere {</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_object.html">Object</a> _object;</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> _component;</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_voxel_channel.html">VoxelChannel</a> _channel;</div>
<div class="line"></div>
<div class="line">    Sphere()</div>
<div class="line">    {}</div>
<div class="line"></div>
<div class="line">    ~Sphere()</div>
<div class="line">    {}</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> refine( <span class="keywordtype">float</span> radius, <span class="keyword">const</span> amino::Math::vec3f&amp; pos, <span class="keywordtype">float</span> refinement )</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line">        <a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ss = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#a278173e8be1475c461e314d35d67c73f">createStateServer</a>();</div>
<div class="line"></div>
<div class="line">        _object = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#aadb8d149abf90146165a93d79d25e85d">createObject</a>(<span class="stringliteral">&quot;sphere-levelset&quot;</span>, <span class="stringliteral">&quot;sphere&quot;</span>);</div>
<div class="line">        _component = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#ab183fe1fae6661fd2b295eeb5893e79b">createComponent</a>(<a class="code" href="group__types.html#gaa48d105af85aac2d1ed2c722dee14c68">VoxelComponentType</a>, <span class="stringliteral">&quot;sphere-component&quot;</span> );</div>
<div class="line">        _object.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object.html#a72efbab4e199f71f599f9b62b255296d">addComponent</a>(_component);</div>
<div class="line">        _channel = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a96c1496e423a15722bd2af37e860132a">createChannel</a>( _component, <a class="code" href="namespace_bifrost_1_1_a_p_i.html#a09825962d4b39d95f8e2e7132a7c9390adbad07899df7b3551edf86cae15a9e86">FloatType</a>, <span class="stringliteral">&quot;voxel-channel&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html">Layout</a> layout = _component.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html#a1a0e8b6b0864023caa8b2dd789c1fcdb">layout</a>();</div>
<div class="line">        layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#ac1e28573bb200ca4eab222521e6be29d">setVoxelScale</a>(1.0f);</div>
<div class="line">        <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html">TileDimInfo</a> dinfo = layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#abea38bd4d31ffb7ed72d70b7686d74e3">tileDimInfo</a>(0);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">float</span> scale = 10;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">float</span> dx = 0.01f*scale; </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">float</span> maxDistance = dinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html#adec9519efdd90c80525e690032a06eaa">depthWidth</a>*dx*sqrt(3.0f); </div>
<div class="line">        _channel.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_channel.html#aed1c59a9b03956799493ec74d9428667">setBackgroundValue</a>( maxDistance );</div>
<div class="line">        _channel.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_voxel_channel.html#a127751807d32bdad9de2fa61ec012368">setOffsetType</a>( <a class="code" href="namespace_bifrost_1_1_a_p_i.html#a062a1f606e617bd32c50dad435b24ecea7e31643fef48ff218e3ec5648b85b07c">VoxelOffsetType::Center</a> );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Convert from world space (but keep scale)</span></div>
<div class="line">        <span class="keyword">const</span> amino::Math::vec3f center = _component.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html#a403e925189fcf73bf171da2949631c4a">world</a>().<a class="code" href="class_bifrost_1_1_math_1_1_similarity.html#a90b1ba3dc8ae46688416e1ed7b2a4170">inverseApply</a>( pos );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// start refinement</span></div>
<div class="line">        <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html">TileAccessor</a> tacc = layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#adcf8f9c32b5f21041f66d981a69cd01b">tileAccessor</a>();</div>
<div class="line">        <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html">TreeIndex</a> rootIndex = tacc.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html#a5c422aa169f9e806b0c5af9f281c31d9">addRoot</a>();</div>
<div class="line">        <span class="keywordtype">size_t</span> maxDepth = layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#a226774cb9306c74094c13a25bb08421f">maxDepth</a>();</div>
<div class="line">        refineSphere( center, radius, refinement, layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#a351edc5b8e623fff2d7d4e1f6dd40090">voxelScale</a>(), maxDepth, tacc, rootIndex );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> refineSphere(  <span class="keyword">const</span> amino::Math::vec3f &amp;center,</div>
<div class="line">                        <span class="keywordtype">float</span> radius,</div>
<div class="line">                        <span class="keywordtype">float</span> refinementConstant,</div>
<div class="line">                        <span class="keywordtype">float</span> dx,</div>
<div class="line">                        <span class="keywordtype">size_t</span> maxDepth,</div>
<div class="line">                        <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html">TileAccessor</a>&amp; tacc,</div>
<div class="line">                        <span class="keyword">const</span> <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html">TreeIndex</a>&amp; treeIndex )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!treeIndex.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html#a82967c437983e8e1fd94d1651f619fcf">valid</a>()) {</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html">TileInfo</a> tinfo = tacc.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html#ac530e2806751c173b59d3388ca92d8f9">tileInfo</a>( treeIndex );</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> tw = tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a21823d83d1f5cbf2bc8b363ff22007a4">dimInfo</a>.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html#a7c53784f8abf4fc37c79c28325b2f820">tileWidth</a>;</div>
<div class="line">        <span class="keyword">const</span> amino::Math::vec3f&amp; offset = _channel.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_voxel_channel.html#a7e9a7f4e0a6a8ed6f1ebdd4f139f1d7c">offsetValue</a>();</div>
<div class="line">        <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data.html">TileData&lt;float&gt;</a> tile = _channel.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_channel.html#ac6f9314b893e9a2bb769d21bb7af35a0">tileData</a>&lt;<span class="keywordtype">float</span>&gt;(treeIndex);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// base case - have we reached maximum refinement in the tree?</span></div>
<div class="line">        <span class="keywordflow">if</span> ( tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a0df5d700e3f8a156dd238f9fef1340f3">depth</a> == maxDepth ) {</div>
<div class="line">            <span class="comment">// Here we compute distance in all voxels</span></div>
<div class="line">            amino::Math::vec3f baseX((tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a100d0b2515ff65a393605a79a05232f4">i</a>+offset[0])*dx, (tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a2199635a0e3c305a8089bd9693748472">j</a>+offset[1])*dx, (tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#afc252738c6494090285acf8f25fdd8c3">k</a>+offset[2])*dx);</div>
<div class="line">            amino::Math::vec3f x;</div>
<div class="line">                </div>
<div class="line">            <span class="keywordtype">int</span> li, lj, lk; </div>
<div class="line">            <span class="keywordflow">for</span>(lk=0,x[2]=baseX[2]; lk&lt;tw; ++lk, x[2]+=dx) {</div>
<div class="line">                <span class="keywordflow">for</span>(lj=0,x[1]=baseX[1]; lj&lt;tw; ++lj, x[1]+=dx) {</div>
<div class="line">                    <span class="keywordflow">for</span>(li=0,x[0]=baseX[0]; li&lt;tw; ++li, x[0]+=dx) {</div>
<div class="line">                        <span class="keywordtype">float</span> sd = amino::Math::dist(x, center) - radius;</div>
<div class="line">                        tile(li,lj,lk) = sd;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// loop through tile&#39;s children, refining according to our refinement criterion            </span></div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">float</span> vw = tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a21823d83d1f5cbf2bc8b363ff22007a4">dimInfo</a>.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html#a0c7f30c29bee97c269ee31c56fcb7103">voxelWidth</a>*dx;</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">float</span> refinementCriterion = refinementConstant * vw;</div>
<div class="line">            amino::Math::vec3f baseX(tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a100d0b2515ff65a393605a79a05232f4">i</a>*dx+offset[0]*vw, tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a2199635a0e3c305a8089bd9693748472">j</a>*dx+offset[1]*vw, tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#afc252738c6494090285acf8f25fdd8c3">k</a>*dx+offset[2]*vw);</div>
<div class="line">            amino::Math::vec3f x;</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">int</span> li, lj, lk;</div>
<div class="line">            <span class="keywordflow">for</span>(lk=0,x[2]=baseX[2]; lk&lt;tw; ++lk, x[2]+=vw) {</div>
<div class="line">                <span class="keywordflow">for</span>(lj=0,x[1]=baseX[1]; lj&lt;tw; ++lj, x[1]+=vw) {</div>
<div class="line">                    <span class="keywordflow">for</span>(li=0,x[0]=baseX[0]; li&lt;tw; ++li, x[0]+=vw) {</div>
<div class="line">                        <span class="keywordtype">float</span> sd = amino::Math::dist(x, center) - radius;</div>
<div class="line">                        tile(li,lj,lk) = sd;</div>
<div class="line"></div>
<div class="line">                        <span class="keywordflow">if</span> (fabs(sd) &lt;= refinementCriterion) {</div>
<div class="line">                            <span class="comment">// Add the child tile</span></div>
<div class="line">                            <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html">TreeIndex</a> childIndex = tacc.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html#ac7e6cc852accf0f86d0093594f48b789">addTile</a>(    tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a100d0b2515ff65a393605a79a05232f4">i</a>+tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a21823d83d1f5cbf2bc8b363ff22007a4">dimInfo</a>.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html#a0c7f30c29bee97c269ee31c56fcb7103">voxelWidth</a>*li, </div>
<div class="line">                                                                    tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a2199635a0e3c305a8089bd9693748472">j</a>+tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a21823d83d1f5cbf2bc8b363ff22007a4">dimInfo</a>.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html#a0c7f30c29bee97c269ee31c56fcb7103">voxelWidth</a>*lj, </div>
<div class="line">                                                                    tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#afc252738c6494090285acf8f25fdd8c3">k</a>+tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a21823d83d1f5cbf2bc8b363ff22007a4">dimInfo</a>.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html#a0c7f30c29bee97c269ee31c56fcb7103">voxelWidth</a>*lk, </div>
<div class="line">                                                                    tinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a0df5d700e3f8a156dd238f9fef1340f3">depth</a>+1 );</div>
<div class="line"></div>
<div class="line">                            <span class="comment">// Call recursively</span></div>
<div class="line">                            refineSphere( center, radius, refinementConstant, dx, maxDepth, tacc, childIndex );</div>
<div class="line">                            </div>
<div class="line">                            <span class="comment">// We need to update references in each iteration due to the recursive calls</span></div>
<div class="line">                            <span class="comment">// that may invalidate the references due to storage re-allocations</span></div>
<div class="line">                            tinfo = tacc.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html#ac530e2806751c173b59d3388ca92d8f9">tileInfo</a>( treeIndex );</div>
<div class="line">                            tile = _channel.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_channel.html#ac6f9314b893e9a2bb769d21bb7af35a0">tileData</a>&lt;<span class="keywordtype">float</span>&gt;( treeIndex );</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">Sphere sphere;</div>
<div class="line">sphere.refine( 30.0f, amino::Math::vec3f(10.0f), 1.0f );</div>
<div class="line">        </div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html">Layout</a> layout = sphere._component.layout();</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#a226774cb9306c74094c13a25bb08421f">maxDepth</a>()+1; ++i) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;number of tiles at depth &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#abbedeb446d504fceee2a8fc90ac1634b">tileCount</a>(i) &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="cook_iteratetiletree"></a>
Iterating a tile tree sequentially</h1>
<p>This example demonstrates how to iterate a tile tree with the <a class="el" href="class_bifrost_1_1_a_p_i_1_1_tile_iterator.html" title="The TileIterator class is a utility for iterating over tiles of a tile tree. ">Bifrost::API::TileIterator</a> class. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tileaccessor_8h.html">bifrostapi/bifrost_tileaccessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__layout_8h.html">bifrostapi/bifrost_layout.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__component_8h.html">bifrostapi/bifrost_component.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tileiterator_8h.html">bifrostapi/bifrost_tileiterator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__const_8h.html">bifrostapi/bifrost_const.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tile_8h.html">bifrostapi/bifrost_tile.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// load a particle BIF file</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html">FileIO</a> fio = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#aa9fe3c951ce3b237e810caaa8b0fb900">createFileIO</a>(<span class="stringliteral">&quot;particles.bif&quot;</span>);</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ss = fio.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html#a62c66b6e15787b2e9b13d24b826ac0b5">load</a>();</div>
<div class="line"></div>
<div class="line"><span class="comment">// get the layout for iterating the tiles</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html">RefArray</a> components = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#afd7248d0153c30e113804798e3a74712">components</a>();</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> component = components[0];</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html">Layout</a> layout = component.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html#a1a0e8b6b0864023caa8b2dd789c1fcdb">layout</a>();</div>
<div class="line"></div>
<div class="line"><span class="comment">// Log information on each tile and neighbours of the following coordinates</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_iterator.html">TileIterator</a> it = layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#a6caf1d957140ead1284521efd48444eb">tileIterator</a>( 0, layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#a226774cb9306c74094c13a25bb08421f">maxDepth</a>(), <a class="code" href="namespace_bifrost_1_1_a_p_i.html#a50a6cf5d5cfb66050792e777f17a1113a26aefa5f4062c5e98b1f4b2388a74aef">BreadthFirst</a>);</div>
<div class="line">std::vector&lt;Bifrost::API::TileCoord&gt; coords(8);</div>
<div class="line">coords[0] = <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_coord.html">Bifrost::API::TileCoord</a>( 0, 0, 0 );</div>
<div class="line">coords[1] = <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_coord.html">Bifrost::API::TileCoord</a>( 1, 0, 0 );</div>
<div class="line">coords[2] = <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_coord.html">Bifrost::API::TileCoord</a>( 1, 1, 0 );</div>
<div class="line">coords[3] = <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_coord.html">Bifrost::API::TileCoord</a>( 1, 1, 1 );</div>
<div class="line">coords[4] = <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_coord.html">Bifrost::API::TileCoord</a>( 0, 1, 1 );</div>
<div class="line">coords[5] = <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_coord.html">Bifrost::API::TileCoord</a>( 0, 0, 1 );</div>
<div class="line">coords[6] = <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_coord.html">Bifrost::API::TileCoord</a>( 0, 1, 0 );</div>
<div class="line">coords[7] = <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_coord.html">Bifrost::API::TileCoord</a>( 1, 0, 1 );</div>
<div class="line"><span class="keywordflow">while</span> ( it ) {</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile.html">Tile</a> tile = *it;</div>
<div class="line">    <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html">TileInfo</a> info = tile.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile.html#a7bf78c84b1b745376b818d0a8a810517">info</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// log the tile info</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;tile id: &quot;</span> &lt;&lt; info.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a6e8510a3f6b8a1e6fa4b211a73606e8e">id</a> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;  tile is valid: &quot;</span> &lt;&lt; info.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a96236c49e0601219687a896b894971b9">valid</a> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;  tile space coordinates: &quot;</span> &lt;&lt; info.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a100d0b2515ff65a393605a79a05232f4">i</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; info.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a2199635a0e3c305a8089bd9693748472">j</a>  &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; info.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#afc252738c6494090285acf8f25fdd8c3">k</a> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;  tile index: &quot;</span> &lt;&lt; info.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#abb2a7b0dcb687858b740a5d4e181272f">tile</a> &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; info.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a0df5d700e3f8a156dd238f9fef1340f3">depth</a> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;  tile parent: &quot;</span> &lt;&lt; info.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#ad0abe1de978cca3077cd08a2a92ca57e">parent</a> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;  tile has children: &quot;</span> &lt;&lt; info.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a7131176edcedfd9c696625caa30ba852">hasChildren</a> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;coords.size(); i++ ) {</div>
<div class="line">        <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_coord.html">TileCoord</a> tc = coords[i];</div>
<div class="line">        <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html">TreeIndex</a> tindex = it.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_iterator.html#afcc450c121952ad1cd890dc09c6979f7">neighbourIndex</a>( tc );     </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  tile neighbour &quot;</span> &lt;&lt; tc.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_coord.html#a231aa7e40c37d90f08f0a116f2f45933">i</a> &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; tc.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_coord.html#a741e664b1aaaf1ff026d25a64ed4dac4">j</a> &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; tc.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_coord.html#a4d698baedf34b62adfdacc79c604489c">k</a> &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; tindex.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html#ab5c9c8389fba54b2d42a2cf272f00f2e">tile</a> &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; tindex.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html#a2dd24231018bc0af9cdfe9f6c8d1279e">depth</a> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// next</span></div>
<div class="line">    ++it;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="cook_iterate_children_tiles"></a>
Iterating over tile children.</h1>
<p>This example demonstrates how to iterate over the children of tiles. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tile_8h.html">bifrostapi/bifrost_tile.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tileiterator_8h.html">bifrostapi/bifrost_tileiterator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tileaccessor_8h.html">bifrostapi/bifrost_tileaccessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__layout_8h.html">bifrostapi/bifrost_layout.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__fileio_8h.html">bifrostapi/bifrost_fileio.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__array_8h.html">bifrostapi/bifrost_array.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__ref_8h.html">bifrostapi/bifrost_ref.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// load a BIF files with tile objects</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html">FileIO</a> fileio = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#aa9fe3c951ce3b237e810caaa8b0fb900">createFileIO</a>( <span class="stringliteral">&quot;particles.bif&quot;</span> );</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ss = fileio.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html#a62c66b6e15787b2e9b13d24b826ac0b5">load</a>( );</div>
<div class="line"><span class="keywordflow">if</span> ( ss ) {</div>
<div class="line">    <span class="comment">// traverse the tree and iterate tile children</span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html">RefArray</a> layouts = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a1c2101d319849ff5b09d6639214dac6a">layouts</a>();    </div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html">Layout</a> layout = layouts[0];</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html">TileAccessor</a> tacc = layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#adcf8f9c32b5f21041f66d981a69cd01b">tileAccessor</a>();</div>
<div class="line">    <span class="keywordtype">size_t</span> depth = layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#a226774cb9306c74094c13a25bb08421f">maxDepth</a>();</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_iterator.html">TileIterator</a> it = layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#a6caf1d957140ead1284521efd48444eb">tileIterator</a>(depth,depth, <a class="code" href="namespace_bifrost_1_1_a_p_i.html#a50a6cf5d5cfb66050792e777f17a1113a26aefa5f4062c5e98b1f4b2388a74aef">BreadthFirst</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>( it ) {</div>
<div class="line">        <span class="comment">// Get tile info to access children</span></div>
<div class="line">        <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile.html">Tile</a> tile = *it;</div>
<div class="line">        <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html">TreeIndex</a> itIndex = it.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_iterator.html#aca872ec2fdf8c4d4dafbd7cfa1bb4f66">index</a>();</div>
<div class="line">        <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html">TreeIndex</a> tindex = tile.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile.html#a22bfcc72c08b4dc039fc149ae2db2aeb">index</a>();</div>
<div class="line">        <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html">TileInfo</a> info = tile.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile.html#a7bf78c84b1b745376b818d0a8a810517">info</a>();</div>
<div class="line"></div>
<div class="line">        <span class="comment">// access children with i,j,k coordinates</span></div>
<div class="line">        <span class="keywordflow">if</span> ( info.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a7131176edcedfd9c696625caa30ba852">hasChildren</a> ) {</div>
<div class="line">            <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html">TileDimInfo</a> dinfo = tile.dimInfo();</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;dinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html#a7c53784f8abf4fc37c79c28325b2f820">tileWidth</a>; i++ ) {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;dinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html#a7c53784f8abf4fc37c79c28325b2f820">tileWidth</a>; j++ ) {</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;dinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_dim_info.html#a7c53784f8abf4fc37c79c28325b2f820">tileWidth</a>; k++ ) {                            </div>
<div class="line">                        <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html">TreeIndex</a> cindex = tile.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile.html#aadf92afbff9cb4a82b326a5cfa86f550">child</a>( i, j, k );</div>
<div class="line"></div>
<div class="line">                        <span class="comment">// log the child tile info</span></div>
<div class="line">                        <span class="keywordflow">if</span> (cindex.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html#a82967c437983e8e1fd94d1651f619fcf">valid</a>()) {</div>
<div class="line">                            <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile.html">Tile</a> child = tacc.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html#adbc0b2ba14834410fd211014b1033ea0">tile</a>( cindex );                           </div>
<div class="line">                            <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html">TileInfo</a> cinfo = child.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile.html#a7bf78c84b1b745376b818d0a8a810517">info</a>();</div>
<div class="line"></div>
<div class="line">                            std::cout &lt;&lt; <span class="stringliteral">&quot;tile id: &quot;</span> &lt;&lt; cinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a6e8510a3f6b8a1e6fa4b211a73606e8e">id</a> &lt;&lt; std::endl;</div>
<div class="line">                            std::cout &lt;&lt; <span class="stringliteral">&quot;  tile is valid: &quot;</span> &lt;&lt; cinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a96236c49e0601219687a896b894971b9">valid</a> &lt;&lt; std::endl;</div>
<div class="line">                            std::cout &lt;&lt; <span class="stringliteral">&quot;  tile space coordinates: &quot;</span> &lt;&lt; cinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a100d0b2515ff65a393605a79a05232f4">i</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; cinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a2199635a0e3c305a8089bd9693748472">j</a>  &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; cinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#afc252738c6494090285acf8f25fdd8c3">k</a> &lt;&lt; std::endl;</div>
<div class="line">                            std::cout &lt;&lt; <span class="stringliteral">&quot;  tile index: &quot;</span> &lt;&lt; cinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#abb2a7b0dcb687858b740a5d4e181272f">tile</a> &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; cinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a0df5d700e3f8a156dd238f9fef1340f3">depth</a> &lt;&lt; std::endl;</div>
<div class="line">                            std::cout &lt;&lt; <span class="stringliteral">&quot;  tile parent: &quot;</span> &lt;&lt; cinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#ad0abe1de978cca3077cd08a2a92ca57e">parent</a> &lt;&lt; std::endl;</div>
<div class="line">                            std::cout &lt;&lt; <span class="stringliteral">&quot;  tile has children: &quot;</span> &lt;&lt; cinfo.<a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tile_info.html#a7131176edcedfd9c696625caa30ba852">hasChildren</a> &lt;&lt; std::endl;</div>
<div class="line">                        }                           </div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }           </div>
<div class="line">        }</div>
<div class="line">        ++it;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="cook_iteratetiletree_parallel"></a>
High performance iteration of a tile tree</h1>
<p>Tile trees can also be iterated with the use of the <a class="el" href="class_bifrost_1_1_a_p_i_1_1_visitor.html" title="The Visitor class defines the protocol for iterating over a Bifrost tile tree using the visitor desig...">Bifrost::API::Visitor</a> class. This class encapsulates the visitor pattern design which can be used to visit each tile systematically in an efficient manner. Several traversal modes are available for iterating a tile tree with the visitor pattern such as BreadthFirst and ParallelBreadthFirst.</p>
<p>Here's a simple example to demonstrate the use of the visitor pattern to scale all values of a position channel with parallel computation. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__visitor_8h.html">bifrostapi/bifrost_visitor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__pointchannel_8h.html">bifrostapi/bifrost_pointchannel.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tiledataaccessor_8h.html">bifrostapi/bifrost_tiledataaccessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__layout_8h.html">bifrostapi/bifrost_layout.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__fileio_8h.html">bifrostapi/bifrost_fileio.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__array_8h.html">bifrostapi/bifrost_array.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__ref_8h.html">bifrostapi/bifrost_ref.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__status_8h.html">bifrostapi/bifrost_status.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// PositionScaler extends the Visitor class to scale all values contained in a position channel.</span></div>
<div class="line"><span class="keyword">class </span>PositionScaler : <span class="keyword">public</span> <a class="code" href="class_bifrost_1_1_a_p_i_1_1_visitor.html">Visitor</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// the tile data accessor containing the data to scale</span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data_accessor.html">TileDataAccessor</a> _accessor;</div>
<div class="line">    <span class="keywordtype">float</span> _value;</div>
<div class="line"></div>
<div class="line">    PositionScaler() : _value(1.0f)</div>
<div class="line">    {</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    PositionScaler( <span class="keyword">const</span> <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data_accessor.html">TileDataAccessor</a>&amp; accessor, <span class="keywordtype">float</span> value ) : _accessor(accessor), _value(value)</div>
<div class="line">    {</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ~PositionScaler()</div>
<div class="line">    {</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> beginTile( <span class="keyword">const</span> <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html">TileAccessor</a>&amp; accessor, <span class="keyword">const</span> <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html">TreeIndex</a>&amp; index ) </div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// rescale all particle positions in the tile</span></div>
<div class="line">        <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data.html">TileData&lt;amino::Math::vec3f&gt;</a> data = _accessor.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data_accessor.html#a97622fc70309894c69b72d327cdaa0c6">tileData</a>&lt;amino::Math::vec3f&gt;( index );</div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> i=0; i&lt;data.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data.html#af220aead23f03df859936cd6a4b1a8e1">count</a>(); i++ ) {</div>
<div class="line">            data[i] *= _value;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">virtual</span> <a class="code" href="class_bifrost_1_1_a_p_i_1_1_visitor.html">Visitor</a>* copy( )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="comment">// Required for parallel computation</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">new</span> PositionScaler( _accessor, _value );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// load a BIF particle file for this example</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html">FileIO</a> fio = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#aa9fe3c951ce3b237e810caaa8b0fb900">createFileIO</a>(<span class="stringliteral">&quot;particles.bif&quot;</span>);</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ss = fio.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html#a62c66b6e15787b2e9b13d24b826ac0b5">load</a>();</div>
<div class="line"><span class="keywordflow">if</span> ( ss ) {</div>
<div class="line">    <span class="comment">// Get the layout for traversing the tree</span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html">RefArray</a> layouts = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a1c2101d319849ff5b09d6639214dac6a">layouts</a>();</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html">Layout</a> layout = layouts[0];</div>
<div class="line"></div>
<div class="line">    <span class="comment">// The position channel to scale</span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_point_channel.html">PointChannel</a> posChannel = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a890edfbe62e63a99352c2ade5c6bbd03">findChannel</a>(<span class="stringliteral">&quot;voxel_liquid-particle/position&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create the PositionScaler visitor with a scale value of 2</span></div>
<div class="line">    PositionScaler scaler;</div>
<div class="line">    scaler._value = 2.0f;</div>
<div class="line">    scaler._accessor = posChannel.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_point_channel.html#a271f4554240288b3d5fa8d625c3a1397">tileDataAccessor</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Traverse the tree in ParallelBreadthFirst mode to process all positions </span></div>
<div class="line">    layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#a5eafc5a3b7b459dbe27497ce09ff3276">traverse</a>( scaler, <a class="code" href="namespace_bifrost_1_1_a_p_i.html#a50a6cf5d5cfb66050792e777f17a1113a694b159abd426bf483ccf213e70b819d">TraversalMode::ParallelBreadthFirst</a> );</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="cook_interpolation"></a>
Tile interpolation</h1>
<p>The Bifrost API offers several tools for sampling values at specific location in the tile coordinate space. <br />
 </p><ul>
<li><a class="el" href="group__types.html#ga2f7f28cba544f95390fa9a1bd46dcc01">Bifrost::API::VoxelSamplerLinearType</a> </li>
<li><a class="el" href="group__types.html#ga8c9671f93c981fdae7c24cc3c4c5a791">Bifrost::API::VoxelSamplerQBSplineType</a> </li>
<li><a class="el" href="group__types.html#ga146b74f355175848f0b1204d001b4f7d">Bifrost::API::VoxelSamplerWENOType</a></li>
</ul>
<p>The example below shows how to use a linear voxel sampler to update the positions of a particle channel. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__voxelchannel_8h.html">bifrostapi/bifrost_voxelchannel.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__voxelsampler_8h.html">bifrostapi/bifrost_voxelsampler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__component_8h.html">bifrostapi/bifrost_component.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__layout_8h.html">bifrostapi/bifrost_layout.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tileiterator_8h.html">bifrostapi/bifrost_tileiterator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tiledataaccessor_8h.html">bifrostapi/bifrost_tiledataaccessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__fileio_8h.html">bifrostapi/bifrost_fileio.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tile_8h.html">bifrostapi/bifrost_tile.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__array_8h.html">bifrostapi/bifrost_array.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__ref_8h.html">bifrostapi/bifrost_ref.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// load the BIF files for this example</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html">FileIO</a> fio = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#aa9fe3c951ce3b237e810caaa8b0fb900">createFileIO</a>(<span class="stringliteral">&quot;particles.bif&quot;</span>);</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ssp = fio.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html#a62c66b6e15787b2e9b13d24b826ac0b5">load</a>( );</div>
<div class="line"></div>
<div class="line">fio.setFilename(<span class="stringliteral">&quot;volumes.bif&quot;</span>);</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ssv = fio.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html#a62c66b6e15787b2e9b13d24b826ac0b5">load</a>( );</div>
<div class="line"><span class="keywordflow">if</span> ( ssp &amp;&amp; ssv ) {</div>
<div class="line">    <span class="comment">// Get the layout for iterating the tree (note: the example assumes that layout is the same for both state servers)</span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html">RefArray</a> layouts = ssp.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a1c2101d319849ff5b09d6639214dac6a">layouts</a>();</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html">Layout</a> layout = layouts[0];</div>
<div class="line"></div>
<div class="line">    <span class="comment">// The component that holds the position channel we want to process</span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html">RefArray</a> components = ssp.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#afd7248d0153c30e113804798e3a74712">components</a>();</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> pcomp = components[0];</div>
<div class="line"></div>
<div class="line">    <span class="comment">// The channel to process</span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_channel.html">Channel</a> position = ssp.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a890edfbe62e63a99352c2ade5c6bbd03">findChannel</a>(<span class="stringliteral">&quot;voxel_liquid-particle/position&quot;</span>);</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_voxel_channel.html">VoxelChannel</a> distance = ssv.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a890edfbe62e63a99352c2ade5c6bbd03">findChannel</a>(<span class="stringliteral">&quot;voxel_liquid-volume/distance&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create the objects and data we need for computation</span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_voxel_sampler.html">VoxelSampler</a> distanceSampler = distance.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_voxel_channel.html#a4ef73e6fff7b90bfc58a83c4cea0463e">createSampler</a>( <a class="code" href="group__types.html#ga2f7f28cba544f95390fa9a1bd46dcc01">VoxelSamplerLinearType</a>, <a class="code" href="namespace_bifrost_1_1_a_p_i.html#aac4f75a8d56c49861b9e99efa323caaaa02b744743f96cb05dbcf7131e8f152da">SamplerSpace::WorldSpace</a> );</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="class_bifrost_1_1_math_1_1_similarity.html">Bifrost::Math::Similarity</a>&amp; world = pcomp.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html#a403e925189fcf73bf171da2949631c4a">world</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> dx = layout.voxelScaling();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> dxInv = 1.0f/dx;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// start iterating the tile tree</span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data_accessor.html">TileDataAccessor</a> posAccessor = position.tileDataAccessor();</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_iterator.html">TileIterator</a> it = layout.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html#a6caf1d957140ead1284521efd48444eb">tileIterator</a>( <a class="code" href="namespace_bifrost_1_1_a_p_i.html#a50a6cf5d5cfb66050792e777f17a1113a26aefa5f4062c5e98b1f4b2388a74aef">TraversalMode::BreadthFirst</a> );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> (it) {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile.html">Bifrost::API::Tile</a>&amp; tile = *it;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// update the positions with sampled values</span></div>
<div class="line">        <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data.html">TileData&lt;amino::Math::vec3f&gt;</a> pos = posAccessor.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data_accessor.html#a97622fc70309894c69b72d327cdaa0c6">tileData</a>&lt;amino::Math::vec3f&gt;( tile.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile.html#a22bfcc72c08b4dc039fc149ae2db2aeb">index</a>() );</div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> i=0; i&lt;pos.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data.html#af220aead23f03df859936cd6a4b1a8e1">count</a>(); i++ ) {</div>
<div class="line">            amino::Math::vec3f wp = world.<a class="code" href="class_bifrost_1_1_math_1_1_similarity.html#a37bf5234c78eb808d1ba4c40df268d9f">apply</a>( dx * pos[i]);          </div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">float</span> dist = distanceSampler.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_voxel_sampler.html#abdeb12c45c6be7ce99c71cc02f104839">sample</a>&lt;<span class="keywordtype">float</span>&gt;(wp);</div>
<div class="line">            amino::Math::vec3f normal;</div>
<div class="line">            distanceSampler.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_voxel_sampler.html#a2832202ca2a87f77f4e1c0f4b9235b1e">sampleGradient</a>&lt;<span class="keywordtype">float</span>&gt;( wp, normal );</div>
<div class="line">            wp -= normal * dist;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// update the position</span></div>
<div class="line">            pos[i] = dxInv * world.<a class="code" href="class_bifrost_1_1_math_1_1_similarity.html#a90b1ba3dc8ae46688416e1ed7b2a4170">inverseApply</a>( wp );</div>
<div class="line">        }</div>
<div class="line">        ++it;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="cook_addelements"></a>
Adding particle elements</h1>
<p>This example demonstrates how to add elements to a tile with the TileDataAccessor class. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tiledataaccessor_8h.html">bifrostapi/bifrost_tiledataaccessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__pointchannel_8h.html">bifrostapi/bifrost_pointchannel.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__types_8h.html">bifrostapi/bifrost_types.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__fileio_8h.html">bifrostapi/bifrost_fileio.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tile_8h.html">bifrostapi/bifrost_tile.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__status_8h.html">bifrostapi/bifrost_status.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html">FileIO</a> fileio = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#aa9fe3c951ce3b237e810caaa8b0fb900">createFileIO</a>( <span class="stringliteral">&quot;particles.bif&quot;</span> );</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ss = fileio.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html#a62c66b6e15787b2e9b13d24b826ac0b5">load</a>( );</div>
<div class="line"><span class="keywordflow">if</span> ( ss ) {</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="class_bifrost_1_1_a_p_i_1_1_point_channel.html">PointChannel</a>&amp; v = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a890edfbe62e63a99352c2ade5c6bbd03">findChannel</a>( <span class="stringliteral">&quot;voxel_liquid-particle/velocity&quot;</span> );</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data_accessor.html">TileDataAccessor</a> vacc = v.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_point_channel.html#a271f4554240288b3d5fa8d625c3a1397">tileDataAccessor</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// add new elements at tile 10, depth 7</span></div>
<div class="line">    <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html">TreeIndex</a> tindex(10,7);</div>
<div class="line">    vacc.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data_accessor.html#a011c1a48dd10a9ae59a7c214a7976053">addElement</a>&lt;amino::Math::vec3f&gt;( tindex, amino::Math::vec3f(1,1,1) );</div>
<div class="line">    vacc.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data_accessor.html#a011c1a48dd10a9ae59a7c214a7976053">addElement</a>&lt;amino::Math::vec3f&gt;( tindex, amino::Math::vec3f(100,100,100) );</div>
<div class="line">    <span class="comment">// update the tile</span></div>
<div class="line">    vacc.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data_accessor.html#a540572fa7df7562017a2de8930ee77e4">update</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="cook_removeelements"></a>
Removing particle elements</h1>
<p>The following example use a more elaborated solution for removing particle elements. The example uses a visitor for removing the elements that fall within a range of Z coordinates. The tiles are processed with a parallel reduce algorithm. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tiledataaccessor_8h.html">bifrostapi/bifrost_tiledataaccessor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__tile_8h.html">bifrostapi/bifrost_tile.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__pointchannel_8h.html">bifrostapi/bifrost_pointchannel.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__types_8h.html">bifrostapi/bifrost_types.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__math_8h.html">bifrostapi/bifrost_math.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__visitor_8h.html">bifrostapi/bifrost_visitor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__fileio_8h.html">bifrostapi/bifrost_fileio.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__status_8h.html">bifrostapi/bifrost_status.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Visitor implementation to process the particles to remove</span></div>
<div class="line"><span class="keyword">class </span>ParticleRemover : <span class="keyword">public</span> <a class="code" href="class_bifrost_1_1_a_p_i_1_1_visitor.html">Visitor</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// the tile data accessor containing the particles to remove        </span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data_accessor.html">TileDataAccessor</a> _accessor;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// a Z coordinate range </span></div>
<div class="line">    amino::Math::vec2f _zrange;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// number of total elements removed </span></div>
<div class="line">    <span class="keywordtype">size_t</span> _elementsRemoved;</div>
<div class="line"></div>
<div class="line">    ParticleRemover( ) : _elementsRemoved(0)</div>
<div class="line">    {</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ParticleRemover( <span class="keyword">const</span> amino::Math::vec2f&amp; zrange ) </div>
<div class="line">        : _zrange(zrange)</div>
<div class="line">        , _elementsRemoved(0)</div>
<div class="line">    {</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ParticleRemover( <span class="keyword">const</span> <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data_accessor.html">TileDataAccessor</a>&amp; accessor, <span class="keyword">const</span> amino::Math::vec2f&amp; zrange ) </div>
<div class="line">        : _accessor(accessor)</div>
<div class="line">        , _zrange(zrange)</div>
<div class="line">        , _elementsRemoved(0)</div>
<div class="line">    {</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ~ParticleRemover()</div>
<div class="line">    {</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> beginTile( <span class="keyword">const</span> <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_accessor.html">TileAccessor</a>&amp;, <span class="keyword">const</span> <a class="code" href="struct_bifrost_1_1_a_p_i_1_1_tree_index.html">TreeIndex</a>&amp; index ) </div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Tag the particles to delete which are falling within our Z coordinates range </span></div>
<div class="line">        <a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data.html">TileData&lt;amino::Math::vec3f&gt;</a> data = _accessor.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data_accessor.html#a97622fc70309894c69b72d327cdaa0c6">tileData</a>&lt;amino::Math::vec3f&gt;( index );</div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> i=0; i&lt;data.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data.html#af220aead23f03df859936cd6a4b1a8e1">count</a>(); i++ ) {</div>
<div class="line">            <span class="keywordflow">if</span> ( data[i][2] &gt; _zrange[0] &amp;&amp; data[i][2] &lt; _zrange[1] ) {</div>
<div class="line">                _accessor.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_tile_data_accessor.html#af9d4d335e1f8bcc587b090c23be7b4b6">removeElement</a>( index, i );</div>
<div class="line">                _elementsRemoved++;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">virtual</span> <a class="code" href="class_bifrost_1_1_a_p_i_1_1_visitor.html">Visitor</a>* copy( )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="comment">// Required for parallel computation</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">new</span> ParticleRemover( _accessor, _zrange );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> join( <span class="keyword">const</span> <a class="code" href="class_bifrost_1_1_a_p_i_1_1_visitor.html">Visitor</a>&amp; other ) </div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// gather data from other visitor instances</span></div>
<div class="line">        <span class="keyword">const</span> ParticleRemover&amp; remover = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>ParticleRemover&amp;<span class="keyword">&gt;</span>(other);</div>
<div class="line">        _elementsRemoved += remover._elementsRemoved;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// Code to traverse the tile tree to remove the particle elements.</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html">FileIO</a> fio = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#aa9fe3c951ce3b237e810caaa8b0fb900">createFileIO</a>(<span class="stringliteral">&quot;particles.bif&quot;</span>);</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ss = fio.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html#a62c66b6e15787b2e9b13d24b826ac0b5">load</a>( );</div>
<div class="line"><span class="keywordflow">if</span> ( ss ) {</div>
<div class="line">    <span class="comment">// The position channel with the particles to delete</span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_point_channel.html">PointChannel</a> channel = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a890edfbe62e63a99352c2ade5c6bbd03">findChannel</a>( <span class="stringliteral">&quot;voxel_liquid-particle/position&quot;</span> );</div>
<div class="line">    <span class="keywordtype">size_t</span> previousElementCount = channel.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_channel.html#a2d539ea40e77d415c292179785d3deb1">elementCount</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Setup the particle remover to remove particles within a [0.0,0.5] Z coordinates range</span></div>
<div class="line">    ParticleRemover remover( channel.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_point_channel.html#a271f4554240288b3d5fa8d625c3a1397">tileDataAccessor</a>(), amino::Math::vec2f( 0.0f, 0.5f ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Traverse the tree with a parallel reduce traverser</span></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_layout.html">Layout</a> layout = channel.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_channel.html#a1ef58c0f2e32da765513e381b5886471">layout</a>();</div>
<div class="line">    layout.traverse( remover, <a class="code" href="namespace_bifrost_1_1_a_p_i.html#a50a6cf5d5cfb66050792e777f17a1113a8f4ab1e951f7af14099289aaceb164e4">TraversalMode::ParallelReduceBreadthFirst</a> );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// delete particles</span></div>
<div class="line">    remover._accessor.update();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// validate our assumptions</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Previous number of particles: &quot;</span> &lt;&lt; previousElementCount &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Current number of particles: &quot;</span> &lt;&lt; channel.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_channel.html#a2d539ea40e77d415c292179785d3deb1">elementCount</a>() &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Number of particles deleted: &quot;</span> &lt;&lt; remover._elementsRemoved &lt;&lt; std::endl;      </div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="cook_dictionary"></a>
Creating and accessing dictionary objects</h1>
<p>Dictionary objects are convenient for attaching user defined data to a particular Bifrost object such as Channel and Object. The following examples illustrates how to create, access and persist Dictionary objects.</p>
<div class="fragment"><div class="line"><span class="comment">// This example demonstrates how to access and use a dictionary from a component object.</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__component_8h.html">bifrostapi/bifrost_component.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__types_8h.html">bifrostapi/bifrost_types.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__const_8h.html">bifrostapi/bifrost_const.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__dictionary_8h.html">bifrostapi/bifrost_dictionary.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__status_8h.html">bifrostapi/bifrost_status.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ss = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#a278173e8be1475c461e314d35d67c73f">createStateServer</a>();</div>
<div class="line"></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> comp = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#ab183fe1fae6661fd2b295eeb5893e79b">createComponent</a>( <a class="code" href="group__types.html#gaa48d105af85aac2d1ed2c722dee14c68">VoxelComponentType</a>, <span class="stringliteral">&quot;vcomp&quot;</span> );</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html">Dictionary</a> d = comp.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html#a085a160f9c684243650a6dbb471c6980">dictionary</a>();</div>
<div class="line"></div>
<div class="line"><span class="comment">// add a few entries</span></div>
<div class="line">d.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html#a5c0db4e76e108a6565264fd892daa5a6">setValue</a>( <span class="stringliteral">&quot;myfloat&quot;</span>, 45.0f );</div>
<div class="line">d.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html#a5c0db4e76e108a6565264fd892daa5a6">setValue</a>( <span class="stringliteral">&quot;myint&quot;</span>, 345 );</div>
<div class="line">d.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html#a5c0db4e76e108a6565264fd892daa5a6">setValue</a>( <span class="stringliteral">&quot;mystring&quot;</span>, <a class="code" href="class_bifrost_1_1_a_p_i_1_1_string.html">String</a>(<span class="stringliteral">&quot;mystring&quot;</span>) );</div>
<div class="line">d.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html#a5c0db4e76e108a6565264fd892daa5a6">setValue</a>( <span class="stringliteral">&quot;mybool&quot;</span>, <span class="keyword">true</span> );</div>
<div class="line"></div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;myfloat: &quot;</span> &lt;&lt; d.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html#aa802349598707505ac4a548a2b52a4c1">value</a>&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;myfloat&quot;</span>) &lt;&lt; std::endl;        </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;myint: &quot;</span> &lt;&lt; d.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html#aa802349598707505ac4a548a2b52a4c1">value</a>&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;myint&quot;</span>) &lt;&lt; std::endl;        </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;mystring: &quot;</span> &lt;&lt; d.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html#aa802349598707505ac4a548a2b52a4c1">value</a>&lt;<a class="code" href="class_bifrost_1_1_a_p_i_1_1_string.html">String</a>&gt;(<span class="stringliteral">&quot;mystring&quot;</span>) &lt;&lt; std::endl;        </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;mybool: &quot;</span> &lt;&lt; d.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html#aa802349598707505ac4a548a2b52a4c1">value</a>&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;mybool&quot;</span>) &lt;&lt; std::endl;      </div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// This example demonstrates how to add multiple directories on an Object instance.</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__om_8h.html">bifrostapi/bifrost_om.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__stateserver_8h.html">bifrostapi/bifrost_stateserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__component_8h.html">bifrostapi/bifrost_component.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__types_8h.html">bifrostapi/bifrost_types.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__const_8h.html">bifrostapi/bifrost_const.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__dictionary_8h.html">bifrostapi/bifrost_dictionary.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__status_8h.html">bifrostapi/bifrost_status.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__object_8h.html">bifrostapi/bifrost_object.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__fileio_8h.html">bifrostapi/bifrost_fileio.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__array_8h.html">bifrostapi/bifrost_array.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__string_8h.html">bifrostapi/bifrost_string.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__ref_8h.html">bifrostapi/bifrost_ref.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bifrost__fileutils_8h.html">bifrostapi/bifrost_fileutils.h</a>&gt;</span></div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_bifrost_1_1_a_p_i.html">Bifrost::API</a>;</div>
<div class="line"></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html">ObjectModel</a> om;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> ss = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#a278173e8be1475c461e314d35d67c73f">createStateServer</a>();</div>
<div class="line"></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_object.html">Object</a> obj = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#aadb8d149abf90146165a93d79d25e85d">createObject</a>( <span class="stringliteral">&quot;myobject-type&quot;</span>, <span class="stringliteral">&quot;myobject&quot;</span> );</div>
<div class="line"></div>
<div class="line"><span class="comment">// Objects come with a default dictionary</span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html">Dictionary</a> defaultDict = obj.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object.html#a8c178d99d77a00aa69b05a9385221067">dictionary</a>();</div>
<div class="line"></div>
<div class="line"><span class="comment">// Bifrost uses internally the ObjectDictionary component type for creating the Object default dictionary. You can </span></div>
<div class="line"><span class="comment">// also use the ObjectDictionary type for adding multiple directories to an Object. </span></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> comp1 = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#ab183fe1fae6661fd2b295eeb5893e79b">createComponent</a>( <a class="code" href="group__types.html#ga9be9a0f91f96bae3eeb0aa324c819fad">ObjectDictionaryType</a>, <span class="stringliteral">&quot;myobject-dictionary1&quot;</span> );</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> comp2 = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#ab183fe1fae6661fd2b295eeb5893e79b">createComponent</a>( <a class="code" href="group__types.html#ga9be9a0f91f96bae3eeb0aa324c819fad">ObjectDictionaryType</a>, <span class="stringliteral">&quot;myobject-dictionary2&quot;</span> );</div>
<div class="line"></div>
<div class="line"><span class="comment">// Make sure the dictionary components are added to the object</span></div>
<div class="line">obj.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object.html#a72efbab4e199f71f599f9b62b255296d">addComponent</a>( comp1 );</div>
<div class="line">obj.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object.html#a72efbab4e199f71f599f9b62b255296d">addComponent</a>( comp2 );</div>
<div class="line"></div>
<div class="line"><span class="comment">// add a few entries to each dictionary</span></div>
<div class="line">obj.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object.html#a8c178d99d77a00aa69b05a9385221067">dictionary</a>().<a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html#a5c0db4e76e108a6565264fd892daa5a6">setValue</a>( <span class="stringliteral">&quot;myfloat&quot;</span>, 10.0f );</div>
<div class="line">comp1.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html#a085a160f9c684243650a6dbb471c6980">dictionary</a>().<a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html#a5c0db4e76e108a6565264fd892daa5a6">setValue</a>( <span class="stringliteral">&quot;myfloat&quot;</span>, 20.0f );</div>
<div class="line">comp2.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html#a085a160f9c684243650a6dbb471c6980">dictionary</a>().<a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html#a5c0db4e76e108a6565264fd892daa5a6">setValue</a>( <span class="stringliteral">&quot;myfloat&quot;</span>, 30.0f );</div>
<div class="line"></div>
<div class="line"><span class="comment">// Dictionary objects can be stored in BIF files by saving their component owners</span></div>
<div class="line">File::TempFolder tempfolder;</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_string.html">String</a> bifDir = tempfolder.path();</div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html">StringArray</a> bifFiles;</div>
<div class="line"></div>
<div class="line"><a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html">RefArray</a> compArray = obj.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object.html#a496c10b1075711aec1554e722c269a1c">components</a>();</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;compArray.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html#ab9d55aa60c1457911682c881aa6540a2">count</a>(); i++ ) {</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> comp = compArray[i];</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_string.html">String</a> bif = bifDir + comp.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_base.html#affd8e8c1fd5ec5ad9844868bbe5ecf0e">name</a>() + <span class="stringliteral">&quot;.bif&quot;</span>;</div>
<div class="line">    bifFiles.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html#ab3b4dcde8126928c231e678b403b3a60">add</a>( bif );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html">FileIO</a> fsave = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#aa9fe3c951ce3b237e810caaa8b0fb900">createFileIO</a>(bif);</div>
<div class="line">    fsave.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html#adfa8ca71d809fd1ec2e51fce1bc2f9f5">save</a>( comp, <a class="code" href="namespace_bifrost_1_1_a_p_i_1_1_b_i_f.html#ab56d14b2966fefa047dbb0315f4294c5a52a7b0ff208bfb54fa8d41f3947bcb4a">BIF::Compression::Level0</a> );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// reload the BIF files to get the dictionary objects back in &quot;myobject&quot;</span></div>
<div class="line"><span class="comment">// note: for the purpose of the demonstration we remove the object from its state server. Loading the BIF</span></div>
<div class="line"><span class="comment">// files will recreate &quot;myobject&quot; and will add it back to the state server.</span></div>
<div class="line">ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a2678e8ecc458ac61fd527388f91ff2a0">removeObject</a>( obj.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_base.html#affd8e8c1fd5ec5ad9844868bbe5ecf0e">name</a>() );</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> i=0; i&lt;bifFiles.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html#ab9d55aa60c1457911682c881aa6540a2">count</a>(); i++ ) {</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html">FileIO</a> fload = om.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object_model.html#aa9fe3c951ce3b237e810caaa8b0fb900">createFileIO</a>(bifFiles[i]);</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html">StateServer</a> loadss = fload.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_file_i_o.html#a62c66b6e15787b2e9b13d24b826ac0b5">load</a>( );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// merge state servers</span></div>
<div class="line">    ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a6ad92c6c1c587bba37eea609167e87a3">merge</a>( loadss );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Get &quot;myobject&quot; and iterate over its components to access each dictionary object</span></div>
<div class="line">obj = ss.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_state_server.html#a66abe00c5942f63bbd76660c452c5c5f">findObject</a>( <span class="stringliteral">&quot;myobject&quot;</span> );</div>
<div class="line"><span class="comment">// Retrieve all 3 dictionaries</span></div>
<div class="line">compArray = obj.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_object.html#a8aecfca3a8a32cf1cb69ee2159654a93">findComponentsByType</a>(<a class="code" href="group__types.html#ga9be9a0f91f96bae3eeb0aa324c819fad">ObjectDictionaryType</a>);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;compArray.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_array.html#ab9d55aa60c1457911682c881aa6540a2">count</a>(); i++ ) {</div>
<div class="line">    <a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html">Component</a> comp = compArray[i];</div>
<div class="line">    std::cout &lt;&lt; comp.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_base.html#affd8e8c1fd5ec5ad9844868bbe5ecf0e">name</a>() &lt;&lt; <span class="stringliteral">&quot; myfloat: &quot;</span> &lt;&lt; comp.<a class="code" href="class_bifrost_1_1_a_p_i_1_1_component.html#a085a160f9c684243650a6dbb471c6980">dictionary</a>().<a class="code" href="class_bifrost_1_1_a_p_i_1_1_dictionary.html#aa802349598707505ac4a548a2b52a4c1">value</a>&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;myfloat&quot;</span>) &lt;&lt; std::endl; </div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Feb 26 2015 17:01:49 for Bifrost Object Model by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
