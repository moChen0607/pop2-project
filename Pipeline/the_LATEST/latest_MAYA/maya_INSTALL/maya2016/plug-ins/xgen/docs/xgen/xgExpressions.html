<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
  <meta http-equiv="Content-Type"
 content="text/html; charset=iso-8859-1">
  <meta name="Author" content="Ernest Petti">
  <meta name="Domain1" content="Product::xgen">
  <meta name="Domain2" content="Tool::xgen">
  <meta name="DocumentType" content="User Guide">
  <meta name="Owner" content="Tom.Thompson">
  <meta name="Clearance" content="General">
  <meta name="Index" content="Yes">
  <meta name="GENERATOR"
 content="Mozilla/4.78 [en] (X11; U; Linux 2.4.9-13 i686) [Netscape]">
  <title>XGen: Expressions</title>
</head>
<body>

<center>
<h2>Expressions</h2>
</center>

Many attributes in XGen are expressions. An expression is an extremely
flexible way to specify how an attribute should be evaluated based on
a combination of function calls and arithmetic operations. The
simplest expression is a constant floating point value. Slightly more
complex are mathematical expressions that evaluate to a floating point
value.

<h4>Operators</h4>

The arithmetic operators that are understood by expressions
are:

<blockquote>+, -, *, /, % (fmod) and ^ (power)<br>
  <br>
  <table border="0" style="width: 100%;" cellpadding="2" cellspacing="2">
    <tbody>
      <tr>
        <td><tt>[x,y,z]</tt></td>
        <td> vector constructor</td>
      </tr>
      <tr>
        <td><tt>V[n] </tt></td>
        <td> vector component access</td>
      </tr>
      <tr>
        <td><tt>x ? y : z </tt></td>
        <td> conditional operator (if x then y else z)</td>
      </tr>
      <tr>
        <td><tt>x &amp;&amp; y </tt></td>
        <td> AND comparison</td>
      </tr>
      <tr>
        <td><tt>x || y </tt></td>
        <td> OR comparison</td>
      </tr>
      <tr>
        <td><tt>x == y </tt></td>
        <td> equality test</td>
      </tr>
      <tr>
        <td><tt>x != y </tt></td>
        <td> inequality test</td>
      </tr>
      <tr>
        <td><tt>x &gt; y </tt></td>
        <td> comparison</td>
      </tr>
      <tr>
        <td><tt>x &lt; y </tt></td>
        <td> comparison</td>
      </tr>
      <tr>
        <td><tt>x &gt;= y </tt></td>
        <td> comparison</td>
      </tr>
      <tr>
        <td><tt>x &lt;= y </tt></td>
        <td> comparison</td>
      </tr>
      <tr>
        <td><tt>!x </tt></td>
        <td> logical negation</td>
      </tr>
    </tbody>
  </table>
  <tt></tt></blockquote>

Any level of parentheses may be used to clarify order of evaluation.<p>

<center>
<table bgcolor=#eeeeee width=50% cellspacing=10>
<tr><td>
<b>TIP:</b> An expression can be followed by the pound sign (e.g. "#") to signal its end. Therefore, you can put comments, or alternate versions of your expression, after the pound sign.
</td></tr></table>
</center>

<h4>Variables</h4>

<p>There are a set of variables describing underlying patch information
that can be used in expressions. The vector forms may be used as vectors or individual components can be referenced. For example, $N refers to the surface
normal vector, and $N[0] refers to the x component of the normal vector.<br>
</p>

&nbsp;&nbsp;&nbsp;<b>Floats</b><br>
<ul>
  <li>
    <b>$u</b> - The u parameter of the underlying surface.</li>
  <li>
    <b>$v</b> - The v parameter of the underlying surface.</li>
  <li>
    <b>$cLength</b> - The final, computed length of the current primitive
  <li>
    <b>$cWidth</b> - The final, computed width of the current primitive
  <li>
    <b>$cDepth</b> - The final, computed depth of the current primitive
without displacement.</li>
  <li>
    <b>$frame</b> - The current frame being evaluated. This value should be used carefully as it is not advisable for some things to change across frames (length and density amoung them) as this would make motion blur not possible.</li>
  <li>
    <b>$faceId</b> - The current face id.</li>
  <li>
    <b>$aCount</b> - The number of archive used by the current archive primitive.</li>
  <li>
    <b>$id</b> - The current primitive's ID (useful for fx modules).</li>
  <li>
    <b>$patchId</b> - The current patch's ID.</li>
  <li>
    <b>$descId</b> - The current description's ID.</li>
  <li>
    <b>$objectId</b> - Alias for $patchId.</li>
</ul>

&nbsp;&nbsp;&nbsp;<b>Vectors</b><br>
<ul>
  <li>
    <b>$P</b> - The surface point at which the primitive is being evaluated. </li>
  <li>
    <b>$Pg</b> - The surface point without displacement.</li>
  <li>
    <b>$Pref</b> - The reference surface point at which the primitive is being evaluated.</li>
  <li>
    <b>$Prefg</b> - The reference surface point without displacement.</li>
  <li>
    <b>$Pw</b> - The surface point at which the primitive is being evaluated. World space.</li>
  <li>
    <b>$Pgw</b> - The surface point without displacement. World space.</li>
  <li>
    <b>$Prefw</b> - The reference surface point at which the primitive is being evaluated. World space.</li>
  <li>
    <b>$Prefgw</b> - The reference surface point without displacement. World space.</li>
  <li>
    <b>$N</b> - The surface normal at which the primitive is being evaluated.</li>
  <li>
    <b>$Ng</b> - The surface normal without displacement.</li>
  <li>
    <b>$Nref</b> - The reference surface normal at which the primitive is being evaluated.</li>
  <li>
    <b>$Nrefg</b> - The reference surface normal without displacement.</li>
  <li>
    <b>$dPdu</b> - The surface dPdu at which the primitive is being evaluated.</li>
  <li>
    <b>$dPdug</b> - The surface dPdu without dispalcement.</li>
  <li>
    <b>$dPduref</b> - The reference surface dPdu at which the primitive is being evaluated.</li>
  <li>
    <b>$dPdurefg</b> - The reference surface dPdu without displacement.</li>
  <li>
    <b>$dPdv</b> - The surface dPdv at which the primitive is being evaluated.</li>
  <li>
    <b>$dPdvg</b> - The surface dPdv without displacement.</li>
  <li>
    <b>$dPdvref</b> - The reference surface dPdv at which the primitive is being evaluated.</li>
  <li>
    <b>$dPdvrefg</b> - The reference surface dPdv.</li>
  <li>
    <b>$Cs</b> - Color surface for the current primitive.</li>
</ul>
<center>
<table bgcolor=#eeeeee width=70% cellspacing=10>
<tr><td>
<b>NOTE:</b> Since the value of the displaced variables, such as <b>P</b>
and
<b>N</b>,
depend on the displacement, offset and bump expressions values, those
variables
cannot be used within those expressions. If you wish to use point based
noise, or any other expression that needs to use values from the
underlying
surface, you should use the
<b><i>g</i></b> variety, such as <b>Prefg</b>
and <b>Nrefg</b>.
</td></tr></table>
</center>

<h4>Functions</h4>

<p>There is a set of function calls that may be used in
expressions. All arguments can be sub-expressions. If an expression
expects vector arguement the input value will be given in upper
case. If a scalar is passed to a function expecting a vector then a
vector with all three channels equal will be used (e.g. length(2) ==
length([2,2,2])).

<p>When a vector is passed to a scalar operation the
operation will be performed component wise (e.g. cos(X) =
[cos(X[0]),cos(X[1]),cos(X[2])]). This includes arithematic operations
(e.g. X*Y = [X[0]*Y[0],X[1]*Y[1],X[2]*Y[2]]). Comparison and
conditionals use the [0] component only. Equality tests (==,!=)
compare all three components. Any scalar result from a function will
be the [0] component.

<p>The square brackets in the definitions below indicate optional
parameters. The current set is as follows, with more functions likely
to be added in the future:

</p>
<ul>
  <li>
    <b>abs( x )</b> - Absolute value of x.</li>
  <br>
  <li><b>acos( x )</b> - Arc cosine of x, in the range 0 to pi
radians.</li>
  <br>
  <li><b>acosd( x )</b> - Arc cosine of x, in the range 0 to
180 degrees.</li>
  <br>
  <li><b>acosh( x )</b> - Hyperbolic cosine of x.</li>
  <br>
  <li><b>alignU( [X] ), alignV ( [X] ), alignN( [X] )</b> - Align the primitive with a given vector. These three expressions should be placed into offU, offV, and offN. If no parameter is passed then a default of [0,1,0] will be used with the result being "grow up". When a parameter is passed it makes most sense to pass the same parameter to all three expressions. The parameter can be an expression and need not be normalized.</li>
  <br>
  <li><b>angle( X, Y )</b> - Angle between vectors (in radians)</li>
  <br>
  <li><b>asin( x )</b> - Arc sine of x, in the range -pi/2 to
pi/2 radians.</li>
  <br>
  <li><b>asind( x )</b> - Arc sine of x, in the range -90 to 90
degrees.</li>
  <br>
  <li><b>asinh( x )</b> - Hyperbolic sine of x, in the range.</li>
  <br>
  <li><b>atan( x )</b> - Arc tangent of x, in the range -pi/2
to pi/2 radians.</li>
  <br>
  <li><b>atand( x )</b> - Arc tangent of x, in the range -90 to
90 degrees.</li>
  <br>
  <li><b>atan2( x, y )</b> - Arc tangent of x/y, in the
range -pi/2 to pi/2.</li>
  <br>
  <li><b>atanh( x )</b> - Hyperbolic
arc tangent</li>
  <br>
  <li><b>bias( x, b )</b> - Helper for contrast that is a variation of gamma.</li>
  <br>
  <li><b>boxstep( x, val )</b> - Produces zero when the
expression
evaluates less than val and one otherwise. Subtracting a boxstep from
a boxstep will produce a <i>box function</i> where the value will be
zero when less than the first boxsteps val, one when between the vals,
and zero when greater than the second boxstep val. Make sure to
subtract the later occuring boxstep from the earlier, otherwise you
will have an inverted box function.</li>
  <br>
  <li><b>cbrt( x ) </b>- Cube root of x.</li>
  <br>
  <li><b>ceil( x ) </b>- Smallest integer not less than x
(round up). See <b>floor</b>, <b>round</b> and <b>trunc</b>.</li>
  <br>
  <li><b>clamp( x, min, max )</b> - Clamps x between <b>min</b>
and <b>max</b>.</li>
  <br>
  <li><b>component( x, y, z )</b> - Allows
expressions to set values of the individual components of a vector or
color.<br>
  </li>
  <br>
  <li><b>contrast( x, c )</b> - Contrast function for
x.&nbsp; c &lt; 0.5 decreases
contrast, c &gt; 0.5 increases contrast.</li>
  <br>
  <li><b>cos( x )</b> - Cosine of x (x in radians).</li>
  <br>
  <li><b>cosd( x )</b> - Cosine in degrees.</li>
  <br>
  <li><b>cosh( x )</b> - Hyperbolic cosine of x.</li>
  <br>
  <li><b>cross( V, W )</b> - Cross
product of vectors</li>
  <br>
  <li><b>deg( r )</b> - Convert radians to degrees. See alse <b>rad</b>.</li>
  <br>
  <li><b>dot( V, W )</b> - dot product
of vectors</li>
  <br>
  <li><b>dist( x1, y1, z1, x2, y2, z2 )</b> - distance between to points</li>
  <br>
  <li><b>exp( x )</b> - <i>e</i> raised to the power of x.</li>
  <br>
  <li><b>fit( x, a1, b1, a2, b2 )</b> - Linear transfer of [a1..x..b1] into [a2..result..b2].</li>
  <br>
  <li><b>floor( x )</b> - Largest integer not greater than x
(round down). See also <b>ceil</b>, <b>round</b> and <b>trunc</b>.</li>
  <br>
  <li><b>fmod( x, y )</b> - Real remainder of x divided
by y. Same as x%y.</li>
  <br>
  <li><b>gamma( x, g )</b> - Gamma correction of
x.&nbsp; Same as pow( x, 1/g).</li>
  <br>
  <li><b>gaussstep( x, a, b )</b> - Produces a gaussian
transition
from zero to one. The result will be zero when <b>x</b> equals
    <b>a</b> and one when <b>x</b> equals <b>b</b>. When out side
that
range the result will be continuous, past <b>a</b> will produce all
zeros and past <b>b</b> will produce all ones. If <b>a</b> is less
than <b>b</b> the the function will ramp up, otherwise it is a ramp
down.</li>
  <br>
  <li><b>guidesAttr( N )</b> - Get the Maya attribute value for the attribute named N on the current guide at the current frame. The Maya attribute has to be part of the patch cache for rendering. Convert the guides to curves and add these curves to the patch cache.</li>
  <br>
  <li><b>hypot( x, y )</b> - Square root of (x*x + y*y).</li>
  <br>
  <li><b>length( V )</b> - Length of
vector</li>
  <br>
  <li><b>linearstep( x, a, b )</b> - Produces a linear
transition
from zero to one. The result will be zero when <b>x</b> equals
    <b>a</b> and one when <b>x</b> equals <b>b</b>. When out side
that
range the result will be continuous, past <b>a</b> will produce all
zeros and past <b>b</b> will produce all ones. If <b>a</b> is less
than <b>b</b> the the function will ramp up, otherwise it is a ramp
down.</li>
  <br>
  <li><b>log( x )</b> - Natural logarithm of x.</li>
  <br>
  <li><b>log10( x )</b> - Base 10 logarithm of x.</li>
  <br>
  <li><b>map( "mapname" [,s, t] [, channel] )</b> -
Evaluates the <b>mapname</b> at the current (u,v) or the provided (s,t). The mapname can be supplied as just a path to the ptex files. You only need to specify the file pattern if you plan on using a regular expression to modify the default $g.ptx that would be used. An optional channel can be specified to indicate which channel of the image to read. You can use the variable ${DESC} for the description name. You can also use the builtin $PAL macro to reference maps. An example might be<br>
<pre>    map( "baseCoat_${PAL,myPick}" ) </pre>
where a palette expression named myPick would be evaulated and have its result inserted with %04d formatting.
  </li>
  <br>
  <li><b>max( x, y )</b> - Return the larger of the two
values. See alse <b>min</b>.</li>
  <br>
  <li><b>min( x, y )</b> - Return the lesser of the two
values. See also <b>max</b>.</li>
  <br>
  <li><b>noise( [x] [,y] [,z] )</b> - Evaluates
the Perlin noise function.&nbsp;
With no parameters it is evaluated at the current (u,v).&nbsp; One,
two,
or three parameters can be used for noise in one, two, or three
dimensions.
The return value is always a floating point number between -1 and 1.</li>
  <br>
  <li><b>norm( V )</b> - Normalize vector V.</li>
  <br>
  <li><b>ortho( X, Y )</b> - Orthogonal vector (equiv to <b>norm</b>(<b>cross</b>(X,Y))).</li>
  <br>
  <li><b>patchAttr( N )</b> - Get the Maya attribute value for the attribute named N on the current patch at the current frame. The Maya attribute has to be part of the patch cache for rendering.</li>
  <br>
  <li><b>pow( x, y )</b> - Raise x to the power of
y.&nbsp; Same as x^y.</li>
  <br>
  <li><b>rad( d )</b> - Convert degrees to radians. See also <b>deg</b>.</li>
  <br>
  <li><b>rand( [min, max] [,seed] )</b> - Generates a random
number.&nbsp;
With no parameters, the number generated is between 0 and 1.&nbsp;
Optionally, two parameters can be passed in to give a range for the
random number. In either case a seed value can be given that will
ensure that the number returned is random, but predictable (always "x"
when passed "y").</li>
  <br>
  <li> <b>remap( x, source, range, falloff, interpolation )</b>
-
Remaps x between 0 and 1 such that the result equals 1 when x is
within range distance from the source. Once outside that region, the
result falls off to 0 over the falloff distance. The interpolation
scheme can be specified by name or an integer key: <i>linear</i>=0,
    <i>smooth</i>=1, <i>gaussian</i>=2, <i>boxstep</i>=3. When using
boxstep interpolation a falloff value of 0.0 will be used.</li>
  <br>
  <li><b>round( x ) </b>- Integer value produced by rounding x
towards zero when the decimal portion is less than 0.5 and away from
zero otherwise. See also <b>floor</b>, <b>ceil</b> and
    <b>trunc</b>.</li>
  <br>
  <li><b>shadow( x )</b> - Evaluates the passed in
    expression only during the shadow pass of a render.&nbsp;
Useful for changing length, width, density, etc. between the color and
shadow passes of a render. When not in the shadow pass this function
evaluates to 1.0, so it should be used as a multiplier.</li>
  <br>
  <li><b>sin( x ) </b>- Sine of x (x in radians).</li>
  <br>
  <li><b>sind( x )</b> - Sine of x in degrees.</li>
  <br>
  <li><b>sinh( x )</b> - Hyperbolic sine of x.</li>
  <br>
  <li><b>smoothstep( x, a, b )</b> - Produces a smooth
(quadratic)
transition from zero to one. The result will be zero when <b>x</b>
equals <b>a</b> and one when <b>x</b> equals <b>b</b>. When out side
that range the result will be continuous, past <b>a</b> will produce
all zeros and past <b>b</b> will produce all ones. If <b>a</b> is
less
than <b>b</b> the the function will ramp up, otherwise it is a ramp
down.</li>
  <br>
  <li><b>sqrt( x )</b> - Square root of x.</li>
  <br>
  <li><b>tan( x )</b> - Tangent of x (x in radians).</li>
  <br>
  <li><b>tanh( x )</b> - Hyperbolic tangent of x.</li>
  <br>
  <li><b>trunc( x )</b> - Simple dropping of the decimal
portion of x (round towards zero). See also <b>ceil</b>, <b>floor</b>, and <b>round</b>.</li>
  <br>
  <li><b><i>other</i>()</b> - Palette expressions are called as functions. If you have a palette expression named <b>myPick</b> then you would call it in another expression by the syntax <b>myPick()</b>. Useful for connecting attributes, such as giving an association between length and width. This is also useful for driving attributes in separate descriptions, such as setting a palette wide width value. The name you give your palette expression should not overlap any predefined XGen functions or your palette expression will not be accessible.</li>
  <br>
</ul>
The following constants are valid:<br>
<ul>
  <li><tt>PI</tt> - The ratio of the circumference of a circle to its diameter (3.14159265358979323846).</li>
  <li><tt>E</tt> - The base of natural logarithms (2.7182818284590452354).</li>
</ul>
<br>
</tt>
<center>
<table bgcolor=#eeeeee width=40% cellspacing=10>
<tr><td>
<b>NOTE:</b> If an expression is invalid, it will display an error message and
evaluate to 0.001.
</td></tr></table>
</center>

</body>
</html>
